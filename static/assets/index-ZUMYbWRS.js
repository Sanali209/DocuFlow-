(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const ls=!1;var Xn=Array.isArray,ji=Array.prototype.indexOf,Jn=Array.from,Ai=Object.defineProperty,za=Object.getOwnPropertyDescriptor,_r=Object.getOwnPropertyDescriptors,Pi=Object.prototype,Ci=Array.prototype,ws=Object.getPrototypeOf,Ws=Object.isExtensible;function fn(t){return typeof t=="function"}function Ri(t){return t()}function os(t){for(var e=0;e<t.length;e++)t[e]()}function gr(){var t,e,n=new Promise((r,s)=>{t=r,e=s});return{promise:n,resolve:t,reject:e}}function xn(t,e){if(Array.isArray(t))return t;if(!(Symbol.iterator in t))return Array.from(t);const n=[];for(const r of t)if(n.push(r),n.length===e)break;return n}const $t=2,$n=4,jn=8,mr=1<<24,ja=16,Aa=32,Ha=64,ks=128,la=512,Xt=1024,Zt=2048,Pa=4096,aa=8192,Sa=16384,xs=32768,Oa=65536,Hs=1<<17,br=1<<18,un=1<<19,yr=1<<20,xa=1<<25,Ya=32768,cs=1<<21,Ss=1<<22,Ma=1<<23,_a=Symbol("$state"),wr=Symbol("legacy props"),zi=Symbol(""),sn=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function kr(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Mi(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ni(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Di(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Oi(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Ii(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Li(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function $i(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Fi(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Bi(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Ui(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Gi=1,Yi=2,xr=4,Xi=8,Ji=16,Wi=1,Hi=2,Zi=4,Vi=8,Qi=16,Ki=1,el=2,Lt=Symbol(),tl="http://www.w3.org/1999/xhtml";function al(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function nl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Sr(t){return t===this.v}function sl(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Tr(t){return!sl(t,this.v)}let dn=!1,rl=!1;function il(){dn=!0}let Tt=null;function rn(t){Tt=t}function ot(t,e=!1,n){Tt={p:Tt,i:!1,c:null,e:null,s:t,x:null,l:dn&&!e?{s:null,u:null,$:[]}:null}}function ct(t){var e=Tt,n=e.e;if(n!==null){e.e=null;for(var r of n)Br(r)}return t!==void 0&&(e.x=t),e.i=!0,Tt=e.p,t??{}}function An(){return!dn||Tt!==null&&Tt.l===null}let Fa=[];function qr(){var t=Fa;Fa=[],os(t)}function ga(t){if(Fa.length===0&&!bn){var e=Fa;queueMicrotask(()=>{e===Fa&&qr()})}Fa.push(t)}function ll(){for(;Fa.length>0;)qr()}function Er(t){var e=st;if(e===null)return We.f|=Ma,t;if((e.f&xs)===0){if((e.f&ks)===0)throw t;e.b.error(t)}else ln(t,e)}function ln(t,e){for(;e!==null;){if((e.f&ks)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const ol=-7169;function Dt(t,e){t.f=t.f&ol|e}function Ts(t){(t.f&la)!==0||t.deps===null?Dt(t,Xt):Dt(t,Pa)}function jr(t){if(t!==null)for(const e of t)(e.f&$t)===0||(e.f&Ya)===0||(e.f^=Ya,jr(e.deps))}function Ar(t,e,n){(t.f&Zt)!==0?e.add(t):(t.f&Pa)!==0&&n.add(t),jr(t.deps),Dt(t,Xt)}const Nn=new Set;let nt=null,Fn=null,fa=null,ta=[],Wn=null,vs=!1,bn=!1;class Na{committed=!1;current=new Map;previous=new Map;#t=new Set;#i=new Set;#e=0;#s=0;#r=null;#n=new Set;#a=new Set;skipped_effects=new Set;is_fork=!1;#l=!1;is_deferred(){return this.is_fork||this.#s>0}process(e){ta=[],this.apply();var n=[],r=[];for(const s of e)this.#o(s,n,r);if(this.is_deferred())this.#c(r),this.#c(n);else{for(const s of this.#t)s();this.#t.clear(),this.#e===0&&this.#v(),Fn=this,nt=null,Zs(r),Zs(n),Fn=null,this.#r?.resolve()}fa=null}#o(e,n,r){e.f^=Xt;for(var s=e.first,i=null;s!==null;){var c=s.f,d=(c&(Aa|Ha))!==0,v=d&&(c&Xt)!==0,p=v||(c&aa)!==0||this.skipped_effects.has(s);if(!p&&s.fn!==null){d?s.f^=Xt:i!==null&&(c&($n|jn|mr))!==0?i.b.defer_effect(s):(c&$n)!==0?n.push(s):zn(s)&&((c&ja)!==0&&this.#n.add(s),Sn(s));var f=s.first;if(f!==null){s=f;continue}}var _=s.parent;for(s=s.next;s===null&&_!==null;)_===i&&(i=null),s=_.next,_=_.parent}}#c(e){for(var n=0;n<e.length;n+=1)Ar(e[n],this.#n,this.#a)}capture(e,n){n!==Lt&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Ma)===0&&(this.current.set(e,e.v),fa?.set(e,e.v))}activate(){nt=this,this.apply()}deactivate(){nt===this&&(nt=null,fa=null)}flush(){if(this.activate(),ta.length>0){if(Pr(),nt!==null&&nt!==this)return}else this.#e===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#i)e(this);this.#i.clear()}#v(){if(Nn.size>1){this.previous.clear();var e=fa,n=!0;for(const s of Nn){if(s===this){n=!1;continue}const i=[];for(const[d,v]of this.current){if(s.current.has(d))if(n&&v!==s.current.get(d))s.current.set(d,v);else continue;i.push(d)}if(i.length===0)continue;const c=[...s.current.keys()].filter(d=>!this.current.has(d));if(c.length>0){var r=ta;ta=[];const d=new Set,v=new Map;for(const p of i)Cr(p,c,d,v);if(ta.length>0){nt=s,s.apply();for(const p of ta)s.#o(p,[],[]);s.deactivate()}ta=r}}nt=null,fa=e}this.committed=!0,Nn.delete(this)}increment(e){this.#e+=1,e&&(this.#s+=1)}decrement(e){this.#e-=1,e&&(this.#s-=1),!this.#l&&(this.#l=!0,ga(()=>{this.#l=!1,this.is_deferred()?ta.length>0&&this.flush():this.revive()}))}revive(){for(const e of this.#n)this.#a.delete(e),Dt(e,Zt),Ea(e);for(const e of this.#a)Dt(e,Pa),Ea(e);this.flush()}oncommit(e){this.#t.add(e)}ondiscard(e){this.#i.add(e)}settled(){return(this.#r??=gr()).promise}static ensure(){if(nt===null){const e=nt=new Na;Nn.add(nt),bn||ga(()=>{nt===e&&e.flush()})}return nt}apply(){}}function cl(t){var e=bn;bn=!0;try{for(var n;;){if(ll(),ta.length===0&&(nt?.flush(),ta.length===0))return Wn=null,n;Pr()}}finally{bn=e}}function Pr(){vs=!0;var t=null;try{for(var e=0;ta.length>0;){var n=Na.ensure();if(e++>1e3){var r,s;vl()}n.process(ta),Da.clear()}}finally{vs=!1,Wn=null}}function vl(){try{Ii()}catch(t){ln(t,Wn)}}let ka=null;function Zs(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(Sa|aa))===0&&zn(r)&&(ka=new Set,Sn(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Jr(r):r.fn=null),ka?.size>0)){Da.clear();for(const s of ka){if((s.f&(Sa|aa))!==0)continue;const i=[s];let c=s.parent;for(;c!==null;)ka.has(c)&&(ka.delete(c),i.push(c)),c=c.parent;for(let d=i.length-1;d>=0;d--){const v=i[d];(v.f&(Sa|aa))===0&&Sn(v)}}ka.clear()}}ka=null}}function Cr(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const s of t.reactions){const i=s.f;(i&$t)!==0?Cr(s,e,n,r):(i&(Ss|ja))!==0&&(i&Zt)===0&&Rr(s,e,r)&&(Dt(s,Zt),Ea(s))}}function Rr(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const s of t.deps){if(e.includes(s))return!0;if((s.f&$t)!==0&&Rr(s,e,n))return n.set(s,!0),!0}return n.set(t,!1),!1}function Ea(t){for(var e=Wn=t;e.parent!==null;){e=e.parent;var n=e.f;if(vs&&e===st&&(n&ja)!==0&&(n&br)===0)return;if((n&(Ha|Aa))!==0){if((n&Xt)===0)return;e.f^=Xt}}ta.push(e)}function ul(t){let e=0,n=Xa(0),r;return()=>{Ps()&&(a(n),Zn(()=>(e===0&&(r=Za(()=>t(()=>yn(n)))),e+=1,()=>{ga(()=>{e-=1,e===0&&(r?.(),r=void 0,yn(n))})})))}}var dl=Oa|un|ks;function fl(t,e,n){new pl(t,e,n)}class pl{parent;is_pending=!1;#t;#i=null;#e;#s;#r;#n=null;#a=null;#l=null;#o=null;#c=null;#v=0;#d=0;#p=!1;#f=!1;#h=new Set;#_=new Set;#u=null;#w=ul(()=>(this.#u=Xa(this.#v),()=>{this.#u=null}));constructor(e,n,r){this.#t=e,this.#e=n,this.#s=r,this.parent=st.b,this.is_pending=!!this.#e.pending,this.#r=Rn(()=>{st.b=this;{var s=this.#b();try{this.#n=ia(()=>r(s))}catch(i){this.error(i)}this.#d>0?this.#m():this.is_pending=!1}return()=>{this.#c?.remove()}},dl)}#k(){try{this.#n=ia(()=>this.#s(this.#t))}catch(e){this.error(e)}}#x(){const e=this.#e.pending;e&&(this.#a=ia(()=>e(this.#t)),ga(()=>{var n=this.#b();this.#n=this.#g(()=>(Na.ensure(),ia(()=>this.#s(n)))),this.#d>0?this.#m():(Ua(this.#a,()=>{this.#a=null}),this.is_pending=!1)}))}#b(){var e=this.#t;return this.is_pending&&(this.#c=Ta(),this.#t.before(this.#c),e=this.#c),e}defer_effect(e){Ar(e,this.#h,this.#_)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#e.pending}#g(e){var n=st,r=We,s=Tt;ma(this.#r),Qt(this.#r),rn(this.#r.ctx);try{return e()}catch(i){return Er(i),null}finally{ma(n),Qt(r),rn(s)}}#m(){const e=this.#e.pending;this.#n!==null&&(this.#o=document.createDocumentFragment(),this.#o.append(this.#c),Zr(this.#n,this.#o)),this.#a===null&&(this.#a=ia(()=>e(this.#t)))}#y(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#y(e);return}if(this.#d+=e,this.#d===0){this.is_pending=!1;for(const n of this.#h)Dt(n,Zt),Ea(n);for(const n of this.#_)Dt(n,Pa),Ea(n);this.#h.clear(),this.#_.clear(),this.#a&&Ua(this.#a,()=>{this.#a=null}),this.#o&&(this.#t.before(this.#o),this.#o=null)}}update_pending_count(e){this.#y(e),this.#v+=e,!(!this.#u||this.#p)&&(this.#p=!0,ga(()=>{this.#p=!1,this.#u&&on(this.#u,this.#v)}))}get_effect_pending(){return this.#w(),a(this.#u)}error(e){var n=this.#e.onerror;let r=this.#e.failed;if(this.#f||!n&&!r)throw e;this.#n&&(Kt(this.#n),this.#n=null),this.#a&&(Kt(this.#a),this.#a=null),this.#l&&(Kt(this.#l),this.#l=null);var s=!1,i=!1;const c=()=>{if(s){nl();return}s=!0,i&&Ui(),Na.ensure(),this.#v=0,this.#l!==null&&Ua(this.#l,()=>{this.#l=null}),this.is_pending=this.has_pending_snippet(),this.#n=this.#g(()=>(this.#f=!1,ia(()=>this.#s(this.#t)))),this.#d>0?this.#m():this.is_pending=!1};var d=We;try{Qt(null),i=!0,n?.(e,c),i=!1}catch(v){ln(v,this.#r&&this.#r.parent)}finally{Qt(d)}r&&ga(()=>{this.#l=this.#g(()=>{Na.ensure(),this.#f=!0;try{return ia(()=>{r(this.#t,()=>e,()=>c)})}catch(v){return ln(v,this.#r.parent),null}finally{this.#f=!1}})})}}function hl(t,e,n,r){const s=An()?Pn:qs;var i=t.filter(h=>!h.settled);if(n.length===0&&i.length===0){r(e.map(s));return}var c=nt,d=st,v=_l(),p=i.length===1?i[0].promise:i.length>1?Promise.all(i.map(h=>h.promise)):null;function f(h){v();try{r(h)}catch(m){(d.f&Sa)===0&&ln(m,d)}c?.deactivate(),us()}if(n.length===0){p.then(()=>f(e.map(s)));return}function _(){v(),Promise.all(n.map(h=>gl(h))).then(h=>f([...e.map(s),...h])).catch(h=>ln(h,d))}p?p.then(_):_()}function _l(){var t=st,e=We,n=Tt,r=nt;return function(i=!0){ma(t),Qt(e),rn(n),i&&r?.activate()}}function us(){ma(null),Qt(null),rn(null)}function Pn(t){var e=$t|Zt,n=We!==null&&(We.f&$t)!==0?We:null;return st!==null&&(st.f|=un),{ctx:Tt,deps:null,effects:null,equals:Sr,f:e,fn:t,reactions:null,rv:0,v:Lt,wv:0,parent:n??st,ac:null}}function gl(t,e,n){let r=st;r===null&&Mi();var s=r.b,i=void 0,c=Xa(Lt),d=!We,v=new Map;return jl(()=>{var p=gr();i=p.promise;try{Promise.resolve(t()).then(p.resolve,p.reject).then(()=>{f===nt&&f.committed&&f.deactivate(),us()})}catch(m){p.reject(m),us()}var f=nt;if(d){var _=s.is_rendered();s.update_pending_count(1),f.increment(_),v.get(f)?.reject(sn),v.delete(f),v.set(f,p)}const h=(m,x=void 0)=>{if(f.activate(),x)x!==sn&&(c.f|=Ma,on(c,x));else{(c.f&Ma)!==0&&(c.f^=Ma),on(c,m);for(const[S,w]of v){if(v.delete(S),S===f)break;w.reject(sn)}}d&&(s.update_pending_count(-1),f.decrement(_))};p.promise.then(h,m=>h(null,m||"unknown"))}),Cs(()=>{for(const p of v.values())p.reject(sn)}),new Promise(p=>{function f(_){function h(){_===i?p(c):f(i)}_.then(h,h)}f(i)})}function Ze(t){const e=Pn(t);return Vr(e),e}function qs(t){const e=Pn(t);return e.equals=Tr,e}function zr(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Kt(e[n])}}function ml(t){for(var e=t.parent;e!==null;){if((e.f&$t)===0)return(e.f&Sa)===0?e:null;e=e.parent}return null}function Es(t){var e,n=st;ma(ml(t));try{t.f&=~Ya,zr(t),e=ti(t)}finally{ma(n)}return e}function Mr(t){var e=Es(t);if(!t.equals(e)&&(t.wv=Kr(),(!nt?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){Dt(t,Xt);return}Ia||(fa!==null?(Ps()||nt?.is_fork)&&fa.set(t,e):Ts(t))}let ds=new Set;const Da=new Map;let Nr=!1;function Xa(t,e){var n={f:0,v:t,reactions:null,equals:Sr,rv:0,wv:0};return n}function y(t,e){const n=Xa(t);return Vr(n),n}function bl(t,e=!1,n=!0){const r=Xa(t);return e||(r.equals=Tr),dn&&n&&Tt!==null&&Tt.l!==null&&(Tt.l.s??=[]).push(r),r}function u(t,e,n=!1){We!==null&&(!pa||(We.f&Hs)!==0)&&An()&&(We.f&($t|ja|Ss|Hs))!==0&&!qa?.includes(t)&&Bi();let r=n?Ne(e):e;return on(t,r)}function on(t,e){if(!t.equals(e)){var n=t.v;Ia?Da.set(t,e):Da.set(t,n),t.v=e;var r=Na.ensure();if(r.capture(t,n),(t.f&$t)!==0){const s=t;(t.f&Zt)!==0&&Es(s),Ts(s)}t.wv=Kr(),Dr(t,Zt),An()&&st!==null&&(st.f&Xt)!==0&&(st.f&(Aa|Ha))===0&&(ra===null?Pl([t]):ra.push(t)),!r.is_fork&&ds.size>0&&!Nr&&yl()}return e}function yl(){Nr=!1;for(const t of ds)(t.f&Xt)!==0&&Dt(t,Pa),zn(t)&&Sn(t);ds.clear()}function tn(t,e=1){var n=a(t),r=e===1?n++:n--;return u(t,n),r}function yn(t){u(t,t.v+1)}function Dr(t,e){var n=t.reactions;if(n!==null)for(var r=An(),s=n.length,i=0;i<s;i++){var c=n[i],d=c.f;if(!(!r&&c===st)){var v=(d&Zt)===0;if(v&&Dt(c,e),(d&$t)!==0){var p=c;fa?.delete(p),(d&Ya)===0&&(d&la&&(c.f|=Ya),Dr(p,Pa))}else v&&((d&ja)!==0&&ka!==null&&ka.add(c),Ea(c))}}}function Ne(t){if(typeof t!="object"||t===null||_a in t)return t;const e=ws(t);if(e!==Pi&&e!==Ci)return t;var n=new Map,r=Xn(t),s=y(0),i=Ga,c=d=>{if(Ga===i)return d();var v=We,p=Ga;Qt(null),er(i);var f=d();return Qt(v),er(p),f};return r&&n.set("length",y(t.length)),new Proxy(t,{defineProperty(d,v,p){(!("value"in p)||p.configurable===!1||p.enumerable===!1||p.writable===!1)&&$i();var f=n.get(v);return f===void 0?f=c(()=>{var _=y(p.value);return n.set(v,_),_}):u(f,p.value,!0),!0},deleteProperty(d,v){var p=n.get(v);if(p===void 0){if(v in d){const f=c(()=>y(Lt));n.set(v,f),yn(s)}}else u(p,Lt),yn(s);return!0},get(d,v,p){if(v===_a)return t;var f=n.get(v),_=v in d;if(f===void 0&&(!_||za(d,v)?.writable)&&(f=c(()=>{var m=Ne(_?d[v]:Lt),x=y(m);return x}),n.set(v,f)),f!==void 0){var h=a(f);return h===Lt?void 0:h}return Reflect.get(d,v,p)},getOwnPropertyDescriptor(d,v){var p=Reflect.getOwnPropertyDescriptor(d,v);if(p&&"value"in p){var f=n.get(v);f&&(p.value=a(f))}else if(p===void 0){var _=n.get(v),h=_?.v;if(_!==void 0&&h!==Lt)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return p},has(d,v){if(v===_a)return!0;var p=n.get(v),f=p!==void 0&&p.v!==Lt||Reflect.has(d,v);if(p!==void 0||st!==null&&(!f||za(d,v)?.writable)){p===void 0&&(p=c(()=>{var h=f?Ne(d[v]):Lt,m=y(h);return m}),n.set(v,p));var _=a(p);if(_===Lt)return!1}return f},set(d,v,p,f){var _=n.get(v),h=v in d;if(r&&v==="length")for(var m=p;m<_.v;m+=1){var x=n.get(m+"");x!==void 0?u(x,Lt):m in d&&(x=c(()=>y(Lt)),n.set(m+"",x))}if(_===void 0)(!h||za(d,v)?.writable)&&(_=c(()=>y(void 0)),u(_,Ne(p)),n.set(v,_));else{h=_.v!==Lt;var S=c(()=>Ne(p));u(_,S)}var w=Reflect.getOwnPropertyDescriptor(d,v);if(w?.set&&w.set.call(f,p),!h){if(r&&typeof v=="string"){var k=n.get("length"),z=Number(v);Number.isInteger(z)&&z>=k.v&&u(k,z+1)}yn(s)}return!0},ownKeys(d){a(s);var v=Reflect.ownKeys(d).filter(_=>{var h=n.get(_);return h===void 0||h.v!==Lt});for(var[p,f]of n)f.v!==Lt&&!(p in d)&&v.push(p);return v},setPrototypeOf(){Fi()}})}function Vs(t){try{if(t!==null&&typeof t=="object"&&_a in t)return t[_a]}catch{}return t}function wl(t,e){return Object.is(Vs(t),Vs(e))}var fs,Or,Ir,Lr;function kl(){if(fs===void 0){fs=window,Or=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Ir=za(e,"firstChild").get,Lr=za(e,"nextSibling").get,Ws(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Ws(n)&&(n.__t=void 0)}}function Ta(t=""){return document.createTextNode(t)}function Ra(t){return Ir.call(t)}function Cn(t){return Lr.call(t)}function l(t,e){return Ra(t)}function je(t,e=!1){{var n=Ra(t);return n instanceof Comment&&n.data===""?Cn(n):n}}function o(t,e=1,n=!1){let r=t;for(;e--;)r=Cn(r);return r}function xl(t){t.textContent=""}function $r(){return!1}function js(t,e){{const n=document.body;t.autofocus=!0,ga(()=>{document.activeElement===n&&t.focus()})}}let Qs=!1;function Sl(){Qs||(Qs=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Hn(t){var e=We,n=st;Qt(null),ma(null);try{return t()}finally{Qt(e),ma(n)}}function As(t,e,n,r=n){t.addEventListener(e,()=>Hn(n));const s=t.__on_r;s?t.__on_r=()=>{s(),r(!0)}:t.__on_r=()=>r(!0),Sl()}function Fr(t){st===null&&(We===null&&Oi(),Di()),Ia&&Ni()}function Tl(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function ba(t,e,n){var r=st;r!==null&&(r.f&aa)!==0&&(t|=aa);var s={ctx:Tt,deps:null,nodes:null,f:t|Zt|la,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{Sn(s),s.f|=xs}catch(d){throw Kt(s),d}else e!==null&&Ea(s);var i=s;if(n&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&un)===0&&(i=i.first,(t&ja)!==0&&(t&Oa)!==0&&i!==null&&(i.f|=Oa)),i!==null&&(i.parent=r,r!==null&&Tl(i,r),We!==null&&(We.f&$t)!==0&&(t&Ha)===0)){var c=We;(c.effects??=[]).push(i)}return s}function Ps(){return We!==null&&!pa}function Cs(t){const e=ba(jn,null,!1);return Dt(e,Xt),e.teardown=t,e}function Ft(t){Fr();var e=st.f,n=!We&&(e&Aa)!==0&&(e&xs)===0;if(n){var r=Tt;(r.e??=[]).push(t)}else return Br(t)}function Br(t){return ba($n|yr,t,!1)}function ql(t){return Fr(),ba(jn|yr,t,!0)}function El(t){Na.ensure();const e=ba(Ha|un,t,!0);return(n={})=>new Promise(r=>{n.outro?Ua(e,()=>{Kt(e),r(void 0)}):(Kt(e),r(void 0))})}function Ur(t){return ba($n,t,!1)}function jl(t){return ba(Ss|un,t,!0)}function Zn(t,e=0){return ba(jn|e,t,!0)}function G(t,e=[],n=[],r=[]){hl(r,e,n,s=>{ba(jn,()=>t(...s.map(a)),!0)})}function Rn(t,e=0){var n=ba(ja|e,t,!0);return n}function ia(t){return ba(Aa|un,t,!0)}function Gr(t){var e=t.teardown;if(e!==null){const n=Ia,r=We;Ks(!0),Qt(null);try{e.call(null)}finally{Ks(n),Qt(r)}}}function Yr(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const s=n.ac;s!==null&&Hn(()=>{s.abort(sn)});var r=n.next;(n.f&Ha)!==0?n.parent=null:Kt(n,e),n=r}}function Al(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Aa)===0&&Kt(e),e=n}}function Kt(t,e=!0){var n=!1;(e||(t.f&br)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(Xr(t.nodes.start,t.nodes.end),n=!0),Yr(t,e&&!n),Bn(t,0),Dt(t,Sa);var r=t.nodes&&t.nodes.t;if(r!==null)for(const i of r)i.stop();Gr(t);var s=t.parent;s!==null&&s.first!==null&&Jr(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function Xr(t,e){for(;t!==null;){var n=t===e?null:Cn(t);t.remove(),t=n}}function Jr(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Ua(t,e,n=!0){var r=[];Wr(t,r,!0);var s=()=>{n&&Kt(t),e&&e()},i=r.length;if(i>0){var c=()=>--i||s();for(var d of r)d.out(c)}else s()}function Wr(t,e,n){if((t.f&aa)===0){t.f^=aa;var r=t.nodes&&t.nodes.t;if(r!==null)for(const d of r)(d.is_global||n)&&e.push(d);for(var s=t.first;s!==null;){var i=s.next,c=(s.f&Oa)!==0||(s.f&Aa)!==0&&(t.f&ja)!==0;Wr(s,e,c?n:!1),s=i}}}function Rs(t){Hr(t,!0)}function Hr(t,e){if((t.f&aa)!==0){t.f^=aa,(t.f&Xt)===0&&(Dt(t,Zt),Ea(t));for(var n=t.first;n!==null;){var r=n.next,s=(n.f&Oa)!==0||(n.f&Aa)!==0;Hr(n,s?e:!1),n=r}var i=t.nodes&&t.nodes.t;if(i!==null)for(const c of i)(c.is_global||e)&&c.in()}}function Zr(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var s=n===r?null:Cn(n);e.append(n),n=s}}let In=!1,Ia=!1;function Ks(t){Ia=t}let We=null,pa=!1;function Qt(t){We=t}let st=null;function ma(t){st=t}let qa=null;function Vr(t){We!==null&&(qa===null?qa=[t]:qa.push(t))}let Vt=null,ea=0,ra=null;function Pl(t){ra=t}let Qr=1,Ba=0,Ga=Ba;function er(t){Ga=t}function Kr(){return++Qr}function zn(t){var e=t.f;if((e&Zt)!==0)return!0;if(e&$t&&(t.f&=~Ya),(e&Pa)!==0){for(var n=t.deps,r=n.length,s=0;s<r;s++){var i=n[s];if(zn(i)&&Mr(i),i.wv>t.wv)return!0}(e&la)!==0&&fa===null&&Dt(t,Xt)}return!1}function ei(t,e,n=!0){var r=t.reactions;if(r!==null&&!qa?.includes(t))for(var s=0;s<r.length;s++){var i=r[s];(i.f&$t)!==0?ei(i,e,!1):e===i&&(n?Dt(i,Zt):(i.f&Xt)!==0&&Dt(i,Pa),Ea(i))}}function ti(t){var e=Vt,n=ea,r=ra,s=We,i=qa,c=Tt,d=pa,v=Ga,p=t.f;Vt=null,ea=0,ra=null,We=(p&(Aa|Ha))===0?t:null,qa=null,rn(t.ctx),pa=!1,Ga=++Ba,t.ac!==null&&(Hn(()=>{t.ac.abort(sn)}),t.ac=null);try{t.f|=cs;var f=t.fn,_=f(),h=t.deps;if(Vt!==null){var m;if(Bn(t,ea),h!==null&&ea>0)for(h.length=ea+Vt.length,m=0;m<Vt.length;m++)h[ea+m]=Vt[m];else t.deps=h=Vt;if(Ps()&&(t.f&la)!==0)for(m=ea;m<h.length;m++)(h[m].reactions??=[]).push(t)}else h!==null&&ea<h.length&&(Bn(t,ea),h.length=ea);if(An()&&ra!==null&&!pa&&h!==null&&(t.f&($t|Pa|Zt))===0)for(m=0;m<ra.length;m++)ei(ra[m],t);if(s!==null&&s!==t){if(Ba++,s.deps!==null)for(let x=0;x<n;x+=1)s.deps[x].rv=Ba;if(e!==null)for(const x of e)x.rv=Ba;ra!==null&&(r===null?r=ra:r.push(...ra))}return(t.f&Ma)!==0&&(t.f^=Ma),_}catch(x){return Er(x)}finally{t.f^=cs,Vt=e,ea=n,ra=r,We=s,qa=i,rn(c),pa=d,Ga=v}}function Cl(t,e){let n=e.reactions;if(n!==null){var r=ji.call(n,t);if(r!==-1){var s=n.length-1;s===0?n=e.reactions=null:(n[r]=n[s],n.pop())}}if(n===null&&(e.f&$t)!==0&&(Vt===null||!Vt.includes(e))){var i=e;(i.f&la)!==0&&(i.f^=la,i.f&=~Ya),Ts(i),zr(i),Bn(i,0)}}function Bn(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)Cl(t,n[r])}function Sn(t){var e=t.f;if((e&Sa)===0){Dt(t,Xt);var n=st,r=In;st=t,In=!0;try{(e&(ja|mr))!==0?Al(t):Yr(t),Gr(t);var s=ti(t);t.teardown=typeof s=="function"?s:null,t.wv=Qr;var i;ls&&rl&&(t.f&Zt)!==0&&t.deps}finally{In=r,st=n}}}async function Rl(){await Promise.resolve(),cl()}function a(t){var e=t.f,n=(e&$t)!==0;if(We!==null&&!pa){var r=st!==null&&(st.f&Sa)!==0;if(!r&&!qa?.includes(t)){var s=We.deps;if((We.f&cs)!==0)t.rv<Ba&&(t.rv=Ba,Vt===null&&s!==null&&s[ea]===t?ea++:Vt===null?Vt=[t]:Vt.push(t));else{(We.deps??=[]).push(t);var i=t.reactions;i===null?t.reactions=[We]:i.includes(We)||i.push(We)}}}if(Ia&&Da.has(t))return Da.get(t);if(n){var c=t;if(Ia){var d=c.v;return((c.f&Xt)===0&&c.reactions!==null||ni(c))&&(d=Es(c)),Da.set(c,d),d}var v=(c.f&la)===0&&!pa&&We!==null&&(In||(We.f&la)!==0),p=c.deps===null;zn(c)&&(v&&(c.f|=la),Mr(c)),v&&!p&&ai(c)}if(fa?.has(t))return fa.get(t);if((t.f&Ma)!==0)throw t.v;return t.v}function ai(t){if(t.deps!==null){t.f|=la;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&$t)!==0&&(e.f&la)===0&&ai(e)}}function ni(t){if(t.v===Lt)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Da.has(e)||(e.f&$t)!==0&&ni(e))return!0;return!1}function Za(t){var e=pa;try{return pa=!0,t()}finally{pa=e}}function zl(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(_a in t)ps(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&_a in n&&ps(n)}}}function ps(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ps(t[r],e)}catch{}const n=ws(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=_r(n);for(let s in r){const i=r[s].get;if(i)try{i.call(t)}catch{}}}}}const Ml=["touchstart","touchmove"];function Nl(t){return Ml.includes(t)}const si=new Set,hs=new Set;function Dl(t,e,n,r={}){function s(i){if(r.capture||_n.call(e,i),!i.cancelBubble)return Hn(()=>n?.call(this,i))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?ga(()=>{e.addEventListener(t,s,r)}):e.addEventListener(t,s,r),s}function ha(t,e,n,r,s){var i={capture:r,passive:s},c=Dl(t,e,n,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Cs(()=>{e.removeEventListener(t,c,i)})}function gt(t){for(var e=0;e<t.length;e++)si.add(t[e]);for(var n of hs)n(t)}let tr=null;function _n(t){var e=this,n=e.ownerDocument,r=t.type,s=t.composedPath?.()||[],i=s[0]||t.target;tr=t;var c=0,d=tr===t&&t.__root;if(d){var v=s.indexOf(d);if(v!==-1&&(e===document||e===window)){t.__root=e;return}var p=s.indexOf(e);if(p===-1)return;v<=p&&(c=v)}if(i=s[c]||t.target,i!==e){Ai(t,"currentTarget",{configurable:!0,get(){return i||n}});var f=We,_=st;Qt(null),ma(null);try{for(var h,m=[];i!==null;){var x=i.assignedSlot||i.parentNode||i.host||null;try{var S=i["__"+r];S!=null&&(!i.disabled||t.target===i)&&S.call(i,t)}catch(w){h?m.push(w):h=w}if(t.cancelBubble||x===e||x===null)break;i=x}if(h){for(let w of m)queueMicrotask(()=>{throw w});throw h}}finally{t.__root=e,delete t.currentTarget,Qt(f),ma(_)}}}function ri(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Tn(t,e){var n=st;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function b(t,e){var n=(e&Ki)!==0,r=(e&el)!==0,s,i=!t.startsWith("<!>");return()=>{s===void 0&&(s=ri(i?t:"<!>"+t),n||(s=Ra(s)));var c=r||Or?document.importNode(s,!0):s.cloneNode(!0);if(n){var d=Ra(c),v=c.lastChild;Tn(d,v)}else Tn(c,c);return c}}function ii(t=""){{var e=Ta(t+"");return Tn(e,e),e}}function lt(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Ta();return t.append(e,n),Tn(e,n),t}function g(t,e){t!==null&&t.before(e)}function q(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Ol(t,e){return Il(t,e)}const an=new Map;function Il(t,{target:e,anchor:n,props:r={},events:s,context:i,intro:c=!0}){kl();var d=new Set,v=_=>{for(var h=0;h<_.length;h++){var m=_[h];if(!d.has(m)){d.add(m);var x=Nl(m);e.addEventListener(m,_n,{passive:x});var S=an.get(m);S===void 0?(document.addEventListener(m,_n,{passive:x}),an.set(m,1)):an.set(m,S+1)}}};v(Jn(si)),hs.add(v);var p=void 0,f=El(()=>{var _=n??e.appendChild(Ta());return fl(_,{pending:()=>{}},h=>{if(i){ot({});var m=Tt;m.c=i}s&&(r.$$events=s),p=t(h,r)||{},i&&ct()}),()=>{for(var h of d){e.removeEventListener(h,_n);var m=an.get(h);--m===0?(document.removeEventListener(h,_n),an.delete(h)):an.set(h,m)}hs.delete(v),_!==n&&_.parentNode?.removeChild(_)}});return Ll.set(p,f),p}let Ll=new WeakMap;class zs{anchor;#t=new Map;#i=new Map;#e=new Map;#s=new Set;#r=!0;constructor(e,n=!0){this.anchor=e,this.#r=n}#n=()=>{var e=nt;if(this.#t.has(e)){var n=this.#t.get(e),r=this.#i.get(n);if(r)Rs(r),this.#s.delete(n);else{var s=this.#e.get(n);s&&(this.#i.set(n,s.effect),this.#e.delete(n),s.fragment.lastChild.remove(),this.anchor.before(s.fragment),r=s.effect)}for(const[i,c]of this.#t){if(this.#t.delete(i),i===e)break;const d=this.#e.get(c);d&&(Kt(d.effect),this.#e.delete(c))}for(const[i,c]of this.#i){if(i===n||this.#s.has(i))continue;const d=()=>{if(Array.from(this.#t.values()).includes(i)){var p=document.createDocumentFragment();Zr(c,p),p.append(Ta()),this.#e.set(i,{effect:c,fragment:p})}else Kt(c);this.#s.delete(i),this.#i.delete(i)};this.#r||!r?(this.#s.add(i),Ua(c,d,!1)):d()}}};#a=e=>{this.#t.delete(e);const n=Array.from(this.#t.values());for(const[r,s]of this.#e)n.includes(r)||(Kt(s.effect),this.#e.delete(r))};ensure(e,n){var r=nt,s=$r();if(n&&!this.#i.has(e)&&!this.#e.has(e))if(s){var i=document.createDocumentFragment(),c=Ta();i.append(c),this.#e.set(e,{effect:ia(()=>n(c)),fragment:i})}else this.#i.set(e,ia(()=>n(this.anchor)));if(this.#t.set(r,e),s){for(const[d,v]of this.#i)d===e?r.skipped_effects.delete(v):r.skipped_effects.add(v);for(const[d,v]of this.#e)d===e?r.skipped_effects.delete(v.effect):r.skipped_effects.add(v.effect);r.oncommit(this.#n),r.ondiscard(this.#a)}else this.#n()}}function L(t,e,n=!1){var r=new zs(t),s=n?Oa:0;function i(c,d){r.ensure(c,d)}Rn(()=>{var c=!1;e((d,v=!0)=>{c=!0,i(v,d)}),c||i(!1,null)},s)}function Fe(t,e){return e}function $l(t,e,n){for(var r=[],s=e.length,i,c=e.length,d=0;d<s;d++){let _=e[d];Ua(_,()=>{if(i){if(i.pending.delete(_),i.done.add(_),i.pending.size===0){var h=t.outrogroups;_s(Jn(i.done)),h.delete(i),h.size===0&&(t.outrogroups=null)}}else c-=1},!1)}if(c===0){var v=r.length===0&&n!==null;if(v){var p=n,f=p.parentNode;xl(f),f.append(p),t.items.clear()}_s(e,!v)}else i={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(i)}function _s(t,e=!0){for(var n=0;n<t.length;n++)Kt(t[n],e)}var ar;function Ae(t,e,n,r,s,i=null){var c=t,d=new Map,v=(e&xr)!==0;if(v){var p=t;c=p.appendChild(Ta())}var f=null,_=qs(()=>{var k=n();return Xn(k)?k:k==null?[]:Jn(k)}),h,m=!0;function x(){w.fallback=f,Fl(w,h,c,e,r),f!==null&&(h.length===0?(f.f&xa)===0?Rs(f):(f.f^=xa,gn(f,null,c)):Ua(f,()=>{f=null}))}var S=Rn(()=>{h=a(_);for(var k=h.length,z=new Set,E=nt,P=$r(),M=0;M<k;M+=1){var D=h[M],H=r(D,M),Y=m?null:d.get(H);Y?(Y.v&&on(Y.v,D),Y.i&&on(Y.i,M),P&&E.skipped_effects.delete(Y.e)):(Y=Bl(d,m?c:ar??=Ta(),D,H,M,s,e,n),m||(Y.e.f|=xa),d.set(H,Y)),z.add(H)}if(k===0&&i&&!f&&(m?f=ia(()=>i(c)):(f=ia(()=>i(ar??=Ta())),f.f|=xa)),!m)if(P){for(const[R,X]of d)z.has(R)||E.skipped_effects.add(X.e);E.oncommit(x),E.ondiscard(()=>{})}else x();a(_)}),w={effect:S,items:d,outrogroups:null,fallback:f};m=!1}function Fl(t,e,n,r,s){var i=(r&Xi)!==0,c=e.length,d=t.items,v=t.effect.first,p,f=null,_,h=[],m=[],x,S,w,k;if(i)for(k=0;k<c;k+=1)x=e[k],S=s(x,k),w=d.get(S).e,(w.f&xa)===0&&(w.nodes?.a?.measure(),(_??=new Set).add(w));for(k=0;k<c;k+=1){if(x=e[k],S=s(x,k),w=d.get(S).e,t.outrogroups!==null)for(const X of t.outrogroups)X.pending.delete(w),X.done.delete(w);if((w.f&xa)!==0)if(w.f^=xa,w===v)gn(w,null,n);else{var z=f?f.next:v;w===t.effect.last&&(t.effect.last=w.prev),w.prev&&(w.prev.next=w.next),w.next&&(w.next.prev=w.prev),Ca(t,f,w),Ca(t,w,z),gn(w,z,n),f=w,h=[],m=[],v=f.next;continue}if((w.f&aa)!==0&&(Rs(w),i&&(w.nodes?.a?.unfix(),(_??=new Set).delete(w))),w!==v){if(p!==void 0&&p.has(w)){if(h.length<m.length){var E=m[0],P;f=E.prev;var M=h[0],D=h[h.length-1];for(P=0;P<h.length;P+=1)gn(h[P],E,n);for(P=0;P<m.length;P+=1)p.delete(m[P]);Ca(t,M.prev,D.next),Ca(t,f,M),Ca(t,D,E),v=E,f=D,k-=1,h=[],m=[]}else p.delete(w),gn(w,v,n),Ca(t,w.prev,w.next),Ca(t,w,f===null?t.effect.first:f.next),Ca(t,f,w),f=w;continue}for(h=[],m=[];v!==null&&v!==w;)(p??=new Set).add(v),m.push(v),v=v.next;if(v===null)continue}(w.f&xa)===0&&h.push(w),f=w,v=w.next}if(t.outrogroups!==null){for(const X of t.outrogroups)X.pending.size===0&&(_s(Jn(X.done)),t.outrogroups?.delete(X));t.outrogroups.size===0&&(t.outrogroups=null)}if(v!==null||p!==void 0){var H=[];if(p!==void 0)for(w of p)(w.f&aa)===0&&H.push(w);for(;v!==null;)(v.f&aa)===0&&v!==t.fallback&&H.push(v),v=v.next;var Y=H.length;if(Y>0){var R=(r&xr)!==0&&c===0?n:null;if(i){for(k=0;k<Y;k+=1)H[k].nodes?.a?.measure();for(k=0;k<Y;k+=1)H[k].nodes?.a?.fix()}$l(t,H,R)}}i&&ga(()=>{if(_!==void 0)for(w of _)w.nodes?.a?.apply()})}function Bl(t,e,n,r,s,i,c,d){var v=(c&Gi)!==0?(c&Ji)===0?bl(n,!1,!1):Xa(n):null,p=(c&Yi)!==0?Xa(s):null;return{v,i:p,e:ia(()=>(i(e,v??n,p??s,d),()=>{t.delete(r)}))}}function gn(t,e,n){if(t.nodes)for(var r=t.nodes.start,s=t.nodes.end,i=e&&(e.f&xa)===0?e.nodes.start:n;r!==null;){var c=Cn(r);if(i.before(r),r===s)return;r=c}}function Ca(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function Ul(t,e,n=!1,r=!1,s=!1){var i=t,c="";G(()=>{var d=st;if(c!==(c=e()??"")&&(d.nodes!==null&&(Xr(d.nodes.start,d.nodes.end),d.nodes=null),c!=="")){var v=c+"";n?v=`<svg>${v}</svg>`:r&&(v=`<math>${v}</math>`);var p=ri(v);if((n||r)&&(p=Ra(p)),Tn(Ra(p),p.lastChild),n||r)for(;Ra(p);)i.before(Ra(p));else i.before(p)}})}function Gl(t,e,...n){var r=new zs(t);Rn(()=>{const s=e()??null;r.ensure(s,s&&(i=>s(i,...n)))},Oa)}function Yl(t,e,n){var r=new zs(t);Rn(()=>{var s=e()??null;r.ensure(s,s&&(i=>n(i,s)))},Oa)}const nr=[...` 	
\r\f \v\uFEFF`];function Xl(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var s in n)if(n[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,c=0;(c=r.indexOf(s,c))>=0;){var d=c+i;(c===0||nr.includes(r[c-1]))&&(d===r.length||nr.includes(r[d]))?r=(c===0?"":r.substring(0,c))+r.substring(d+1):c=d}}return r===""?null:r}function Jl(t,e){return t==null?null:String(t)}function $e(t,e,n,r,s,i){var c=t.__className;if(c!==n||c===void 0){var d=Xl(n,r,i);d==null?t.removeAttribute("class"):t.className=d,t.__className=n}else if(i&&s!==i)for(var v in i){var p=!!i[v];(s==null||p!==!!s[v])&&t.classList.toggle(v,p)}return i}function cn(t,e,n,r){var s=t.__style;if(s!==e){var i=Jl(e);i==null?t.removeAttribute("style"):t.style.cssText=i,t.__style=e}return r}function vn(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Xn(e))return al();for(var r of t.options)r.selected=e.includes(wn(r));return}for(r of t.options){var s=wn(r);if(wl(s,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function qn(t){var e=new MutationObserver(()=>{vn(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Cs(()=>{e.disconnect()})}function Et(t,e,n=e){var r=new WeakSet,s=!0;As(t,"change",i=>{var c=i?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(c),wn);else{var v=t.querySelector(c)??t.querySelector("option:not([disabled])");d=v&&wn(v)}n(d),nt!==null&&r.add(nt)}),Ur(()=>{var i=e();if(t===document.activeElement){var c=Fn??nt;if(r.has(c))return}if(vn(t,i,s),s&&i===void 0){var d=t.querySelector(":checked");d!==null&&(i=wn(d),n(i))}t.__value=i,s=!1}),qn(t)}function wn(t){return"__value"in t?t.__value:t.value}const Wl=Symbol("is custom element"),Hl=Symbol("is html");function nn(t,e){var n=Ms(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function ns(t,e){var n=Ms(t);n.checked!==(n.checked=e??void 0)&&(t.checked=e)}function Qe(t,e,n,r){var s=Ms(t);s[e]!==(s[e]=n)&&(e==="loading"&&(t[zi]=n),n==null?t.removeAttribute(e):typeof n!="string"&&Zl(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function Ms(t){return t.__attributes??={[Wl]:t.nodeName.includes("-"),[Hl]:t.namespaceURI===tl}}var sr=new Map;function Zl(t){var e=t.getAttribute("is")||t.nodeName,n=sr.get(e);if(n)return n;sr.set(e,n=[]);for(var r,s=t,i=Element.prototype;i!==s;){r=_r(s);for(var c in r)r[c].set&&n.push(c);s=ws(s)}return n}function Ce(t,e,n=e){var r=new WeakSet;As(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=ss(t)?rs(i):i,n(i),nt!==null&&r.add(nt),await Rl(),i!==(i=e())){var c=t.selectionStart,d=t.selectionEnd,v=t.value.length;if(t.value=i??"",d!==null){var p=t.value.length;c===d&&d===v&&p>v?(t.selectionStart=p,t.selectionEnd=p):(t.selectionStart=c,t.selectionEnd=Math.min(d,p))}}}),Za(e)==null&&t.value&&(n(ss(t)?rs(t.value):t.value),nt!==null&&r.add(nt)),Zn(()=>{var s=e();if(t===document.activeElement){var i=Fn??nt;if(r.has(i))return}ss(t)&&s===rs(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Vl(t,e,n=e){As(t,"change",r=>{var s=r?t.defaultChecked:t.checked;n(s)}),Za(e)==null&&n(t.checked),Zn(()=>{var r=e();t.checked=!!r})}function ss(t){var e=t.type;return e==="number"||e==="range"}function rs(t){return t===""?null:+t}function rr(t,e){return t===e||t?.[_a]===e}function Ns(t={},e,n,r){return Ur(()=>{var s,i;return Zn(()=>{s=i,i=[],Za(()=>{t!==n(...i)&&(e(t,...i),s&&rr(n(...s),t)&&e(null,...s))})}),()=>{ga(()=>{i&&rr(n(...i),t)&&e(null,...i)})}}),t}function Ql(t=!1){const e=Tt,n=e.l.u;if(!n)return;let r=()=>zl(e.s);if(t){let s=0,i={};const c=Pn(()=>{let d=!1;const v=e.s;for(const p in v)v[p]!==i[p]&&(i[p]=v[p],d=!0);return d&&s++,s});r=()=>a(c)}n.b.length&&ql(()=>{ir(e,r),os(n.b)}),Ft(()=>{const s=Za(()=>n.m.map(Ri));return()=>{for(const i of s)typeof i=="function"&&i()}}),n.a.length&&Ft(()=>{ir(e,r),os(n.a)})}function ir(t,e){if(t.l.s)for(const n of t.l.s)a(n);e()}let Dn=!1;function Kl(t){var e=Dn;try{return Dn=!1,[t(),Dn]}finally{Dn=e}}const eo={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(fn(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let s=t.props[r];fn(s)&&(s=s());const i=za(s,e);if(i&&i.set)return i.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(fn(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const s=za(r,e);return s&&!s.configurable&&(s.configurable=!0),s}}},has(t,e){if(e===_a||e===wr)return!1;for(let n of t.props)if(fn(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(fn(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function to(...t){return new Proxy({props:t},eo)}function bt(t,e,n,r){var s=!dn||(n&Hi)!==0,i=(n&Vi)!==0,c=(n&Qi)!==0,d=r,v=!0,p=()=>(v&&(v=!1,d=c?Za(r):r),d),f;if(i){var _=_a in t||wr in t;f=za(t,e)?.set??(_&&e in t?E=>t[e]=E:void 0)}var h,m=!1;i?[h,m]=Kl(()=>t[e]):h=t[e],h===void 0&&r!==void 0&&(h=p(),f&&(s&&Li(),f(h)));var x;if(s?x=()=>{var E=t[e];return E===void 0?p():(v=!0,E)}:x=()=>{var E=t[e];return E!==void 0&&(d=void 0),E===void 0?d:E},s&&(n&Zi)===0)return x;if(f){var S=t.$$legacy;return(function(E,P){return arguments.length>0?((!s||!P||S||m)&&f(P?x():E),E):x()})}var w=!1,k=((n&Wi)!==0?Pn:qs)(()=>(w=!1,x()));i&&a(k);var z=st;return(function(E,P){if(arguments.length>0){const M=P?a(k):s&&i?Ne(E):E;return u(k,M),w=!0,d!==void 0&&(d=M),E}return Ia&&w||(z.f&Sa)!==0?k.v:a(k)})}function Jt(t){Tt===null&&kr(),dn&&Tt.l!==null?so(Tt).m.push(t):Ft(()=>{const e=Za(t);if(typeof e=="function")return e})}function ao(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function no(){const t=Tt;return t===null&&kr(),(e,n,r)=>{const s=t.s.$$events?.[e];if(s){const i=Xn(s)?s.slice():[s],c=ao(e,n,r);for(const d of i)d.call(t.x,c);return!c.defaultPrevented}return!0}}function so(t){var e=t.l;return e.u??={a:[],b:[],m:[]}}const ro="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(ro);il();function Ja(t){window.history.pushState({},"",t),window.dispatchEvent(new Event("popstate"))}let gs=Ne({path:window.location.pathname});if(typeof window<"u"){const t=history.pushState;history.pushState=function(...e){t.apply(this,e),gs.path=window.location.pathname,window.dispatchEvent(new Event("popstate"))},window.addEventListener("popstate",()=>{gs.path=window.location.pathname})}const ya={get path(){return gs.path}};var io=b("<p>404 Not Found</p>");function lo(t,e){ot(e,!0);let n=y(Ne(window.location.pathname)),r=y(null);function s(){u(n,window.location.pathname,!0)}Ft(()=>{let f=a(n),_=null;if(!e.routes)return;const h=Object.keys(e.routes).sort((m,x)=>x.length-m.length);for(const m of h){if(m===f){_=e.routes[m];break}if(f.startsWith(m)&&m!=="/"){_=e.routes[m];break}}_||(_=e.routes["/"]||null),u(r,_,!0)});let i=Ze(()=>{if(typeof window>"u")return{};const f=new URLSearchParams(window.location.search),_={};for(const[h,m]of f.entries())_[h]=m;return _});Jt(()=>(window.addEventListener("popstate",s),()=>{window.removeEventListener("popstate",s)}));var c=lt(),d=je(c);{var v=f=>{var _=lt(),h=je(_);Yl(h,()=>a(r),(m,x)=>{x(m,to(()=>a(i)))}),g(f,_)},p=f=>{var _=io();g(f,_)};L(d,f=>{a(r)?f(v):f(p,!1)})}g(t,c),ct()}const Re="";function ze(t={}){return{"X-User-Role":localStorage.getItem("user_role")||"admin",...t}}async function Ds(t){const e=new FormData;e.append("file",t);const n=await fetch(`${Re}/upload`,{method:"POST",headers:ze(),body:e});if(!n.ok)throw new Error("Upload failed");return await n.json()}async function li(t="",e="",n="",r="registration_date",s="desc",i="",c="",d="",v="registration_date",p="",f=""){const _=new URLSearchParams;return t&&_.append("search",t),e&&_.append("type",e),n&&_.append("status",n),i&&_.append("tag",i),c&&_.append("start_date",c),d&&_.append("end_date",d),v&&_.append("date_field",v),r&&_.append("sort_by",r),s&&_.append("sort_order",s),p&&_.append("assignee",p),f&&_.append("part_search",f),await(await fetch(`${Re}/documents/?${_.toString()}`,{headers:ze()})).json()}async function oo(){const t=await fetch(`${Re}/dashboard/stats`,{headers:ze()});if(!t.ok)throw new Error("Failed to fetch dashboard stats");return await t.json()}async function co(){return await(await fetch(`${Re}/tags`,{headers:ze()})).json()}async function va(t){const e=await fetch(`${Re}/settings/${t}`,{headers:ze()});if(!e.ok)throw new Error("Failed to fetch setting");return await e.json()}async function $a(t,e){const n=await fetch(`${Re}/settings/`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({key:t,value:e})});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.detail||`Failed to update setting (${n.status})`)}return await n.json()}async function vo(t){return await(await fetch(`${Re}/settings/test-path`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({path:t})})).json()}async function uo(t){const e=await fetch(`${Re}/documents/`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)});if(!e.ok){const n=await e.json().catch(()=>({}));throw new Error(n.detail||`Failed to create document (${e.status})`)}return await e.json()}async function fo(t,e){return await(await fetch(`${Re}/documents/${t}`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({status:e})})).json()}async function po(t,e){const n=await fetch(`${Re}/documents/${t}`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(e)});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.detail||`Failed to update document (${n.status})`)}return await n.json()}async function ho(t,e){const n=await fetch(`${Re}/documents/${t}/download-zip`,{headers:ze()});if(!n.ok)throw new Error("Download failed");const r=await n.blob(),s=window.URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download=`${e}_source.zip`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)}async function _o(t){return await(await fetch(`${Re}/documents/${t}`,{method:"DELETE",headers:ze()})).json()}async function go(t="",e="",n=""){const r=new URLSearchParams;return t&&r.append("type",t),e&&r.append("status",e),n&&r.append("document_id",n),await(await fetch(`${Re}/journal/?${r.toString()}`,{headers:ze()})).json()}async function oi(t){return await(await fetch(`${Re}/journal/`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)})).json()}async function Os(t,e){return await(await fetch(`${Re}/journal/${t}`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(e)})).json()}async function mo(t){return await(await fetch(`${Re}/journal/${t}`,{method:"DELETE",headers:ze()})).json()}async function bo(t){return await(await fetch(`${Re}/documents/${t}/tasks`,{headers:ze()})).json()}async function yo(t,e){return await(await fetch(`${Re}/documents/${t}/tasks`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(e)})).json()}async function wo(t,e,n){const r=await fetch(`${Re}/documents/save-as-new-order`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({name:t,sheets:e,original_document_id:n})});if(!r.ok){const s=await r.json().catch(()=>({}));throw new Error(s.detail||`Failed to create order (${r.status})`)}return await r.json()}async function Ln(t,e){return await(await fetch(`${Re}/tasks/${t}`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(e)})).json()}async function ko(t){return await(await fetch(`${Re}/tasks/${t}`,{method:"DELETE",headers:ze()})).json()}async function xo(t){return await(await fetch(`${Re}/attachments/${t}`,{method:"DELETE",headers:ze()})).json()}async function So(){return await(await fetch(`${Re}/filter-presets`,{headers:ze()})).json()}async function Va(){return await(await fetch(`${Re}/materials`,{headers:ze()})).json()}async function To(t){return await(await fetch(`${Re}/materials`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)})).json()}async function qo(t,e){const n=await fetch(`${Re}/documents/order`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({name:e,parts:t})});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.detail||`Failed to create order (${n.status})`)}return await n.json()}async function Eo(t,e){return await(await fetch(`${Re}/materials/${t}?name=${encodeURIComponent(e)}`,{method:"PUT",headers:ze({"Content-Type":"application/json"})})).json()}async function jo(t){return await(await fetch(`${Re}/materials/${t}`,{method:"DELETE",headers:ze()})).json()}async function Ao(t=0,e=100,n={}){const r=new URLSearchParams({skip:String(t),limit:String(e)});return n.search&&r.append("search",n.search),n.material_id&&r.append("material_id",n.material_id),n.min_width&&r.append("min_width",n.min_width),n.max_width&&r.append("max_width",n.max_width),n.min_height&&r.append("min_height",n.min_height),n.max_height&&r.append("max_height",n.max_height),await(await fetch(`${Re}/parts?${r.toString()}`,{headers:ze()})).json()}async function Po(){return await(await fetch(`${Re}/stock`,{headers:ze()})).json()}async function Co(t){return await(await fetch(`${Re}/stock`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)})).json()}async function Ro(t){return await(await fetch(`${Re}/stock/${t}`,{method:"DELETE",headers:ze()})).json()}async function zo(t){const e=new FormData;e.append("file",t);const n=await fetch(`${Re}/gnc/parse`,{method:"POST",headers:ze(),body:e});if(!n.ok){const r=await n.json().catch(()=>({}));throw new Error(r.detail||"Failed to parse GNC file")}return await n.json()}async function Mo(t,e,n=!0){const r=await fetch(`${Re}/gnc/save`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({sheet:t,filename:e,overwrite:n})});if(!r.ok){const s=await r.json().catch(()=>({}));throw new Error(s.detail||"Failed to save GNC file")}return await r.json()}async function No(t){const e=await fetch(`${Re}/parts/scan`,{method:"POST",headers:ze()});if(!e.ok)throw new Error("Failed to start scan");const n=e.body.getReader(),r=new TextDecoder;for(;;){const{done:s,value:i}=await n.read();if(s)break;const d=r.decode(i).split(`
`).filter(v=>v.trim());for(const v of d)try{const p=JSON.parse(v);t(p)}catch{console.error("Failed to parse progress:",v)}}}async function Do(t,e){const n=await fetch(`${Re}/parts/${t}`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(e)});if(!n.ok)throw new Error("Failed to update part");return await n.json()}async function lr(t){const e=await fetch(`${Re}/parts/${t}/gnc`,{headers:ze()});if(!e.ok)throw new Error("Failed to fetch part GNC");return await e.json()}async function En(){return await(await fetch(`${Re}/assignees/`,{headers:ze()})).json()}async function Oo(t){return await(await fetch(`${Re}/assignees/`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)})).json()}async function Io(t,e){return await(await fetch(`${Re}/assignees/${t}`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify({name:e})})).json()}async function Lo(t){return await(await fetch(`${Re}/assignees/${t}`,{method:"DELETE",headers:ze()})).json()}async function $o(){return await(await fetch(`${Re}/api/gnc/library-parts`,{headers:ze()})).json()}async function Fo(t){return await(await fetch(`${Re}/api/gnc/orders/${t}/tasks`,{headers:ze()})).json()}async function Bo(t){return await(await fetch(`${Re}/api/gnc/save-order-nesting`,{method:"POST",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)})).json()}async function Uo(t){const e=await fetch(`${Re}/api/gnc/orders/${t}/project`,{headers:ze()});if(!e.ok){const n=await e.json().catch(()=>({}));throw new Error(n.detail||"Failed to fetch nesting project")}return await e.json()}async function Go(){const t=await fetch(`${Re}/settings/database-config`,{headers:ze()});if(!t.ok)throw new Error("Failed to fetch database config");return await t.json()}async function Yo(t){const e=await fetch(`${Re}/settings/database-config`,{method:"PUT",headers:ze({"Content-Type":"application/json"}),body:JSON.stringify(t)});if(!e.ok){const n=await e.json().catch(()=>({}));throw new Error(n.detail||"Failed to update database config")}return await e.json()}const kt=Ne({userRole:(typeof window<"u"?localStorage.getItem("user_role"):"admin")||"admin",configStatus:"unknown",currentDocument:null,settings:{ocrUrl:"",docNameRegex:"",syncMihtavPath:"",syncSidraPath:""},partTray:[],trayVisible:!1,menuActions:[]});function Xo(t){kt.configStatus=t}function Qa(t){kt.menuActions=t}function Ka(){kt.menuActions=[]}function Jo(t){const e=kt.partTray.find(n=>n.part.id===t.id);e?e.quantity+=1:kt.partTray.push({part:t,quantity:1}),kt.trayVisible=!0}function ci(t){kt.partTray=kt.partTray.filter(e=>e.part.id!==t)}function or(t,e){const n=kt.partTray.find(r=>r.part.id===t);n&&(n.quantity+=e,n.quantity<=0&&ci(t))}function cr(){kt.partTray=[]}function is(){kt.trayVisible=!kt.trayVisible}var Wo=b('<div class="loading-container svelte-plcxj0"><div class="spinner svelte-plcxj0"></div> <p>Gathering insights...</p></div>'),Ho=b('<div class="error-container svelte-plcxj0"><span class="error-icon svelte-plcxj0">⚠️</span> <p> </p> <button class="svelte-plcxj0">Retry</button></div>'),Zo=b('<div class="task-bar-item svelte-plcxj0"><div class="bar-header svelte-plcxj0"><span class="status-name svelte-plcxj0"> </span> <span class="status-count svelte-plcxj0"> </span></div> <div class="bar-track svelte-plcxj0"><div></div></div></div>'),Vo=b('<div class="feed-item svelte-plcxj0"><span class="action-icon svelte-plcxj0"> </span> <div class="feed-content svelte-plcxj0"><p class="svelte-plcxj0"><strong> </strong> </p> <span class="feed-time svelte-plcxj0"> </span></div></div>'),Qo=b('<p class="empty-feed">No recent activity detected.</p>'),Ko=b('<div class="assignee-item svelte-plcxj0"><span class="assignee-name svelte-plcxj0"> </span> <span class="assignee-count svelte-plcxj0"> </span></div>'),ec=b('<div class="alert-box error svelte-plcxj0"><span class="alert-count svelte-plcxj0"> </span> <span class="alert-text svelte-plcxj0">Critical Errors</span></div>'),tc=b('<div class="alert-box warning svelte-plcxj0"><span class="alert-count svelte-plcxj0"> </span> <span class="alert-text svelte-plcxj0">System Warnings</span></div>'),ac=b('<div class="bento-item journal-alerts svelte-plcxj0"><h3 class="svelte-plcxj0">⚠️ System Alerts</h3> <div class="alerts-list svelte-plcxj0"><!> <!></div></div>'),nc=b('<header class="dashboard-header svelte-plcxj0"><h1 class="svelte-plcxj0">Workspace Overview</h1> <p class="subtitle svelte-plcxj0">Operational metrics and recent activity</p></header> <div class="bento-grid svelte-plcxj0"><div class="bento-item stats-overview svelte-plcxj0"><div class="stat-main svelte-plcxj0"><span class="stat-value svelte-plcxj0"> </span> <span class="stat-label svelte-plcxj0">Total Documents</span></div> <div class="stat-sub-grid svelte-plcxj0"><div class="stat-sub svelte-plcxj0"><span class="sub-label svelte-plcxj0">In Progress</span> <span class="sub-value progress svelte-plcxj0"> </span></div> <div class="stat-sub svelte-plcxj0"><span class="sub-label svelte-plcxj0">Completed</span> <span class="sub-value done svelte-plcxj0"> </span></div></div></div> <div class="bento-item task-distribution svelte-plcxj0"><h3 class="svelte-plcxj0">Task Allocation</h3> <div class="task-bars svelte-plcxj0"></div></div> <div class="bento-item inventory-card svelte-plcxj0"><h3 class="svelte-plcxj0">📦 Inventory</h3> <div class="inv-metrics svelte-plcxj0"><div class="inv-item svelte-plcxj0"><span class="inv-label svelte-plcxj0">Materials</span> <span class="inv-value svelte-plcxj0"> </span></div> <div class="inv-item svelte-plcxj0"><span class="inv-label svelte-plcxj0">Total Stock</span> <span class="inv-value svelte-plcxj0"> </span></div> <div class="inv-item svelte-plcxj0"><span class="inv-label svelte-plcxj0">Reserved</span> <span class="inv-value highlight svelte-plcxj0"> </span></div></div></div> <div class="bento-item activity-feed svelte-plcxj0"><h3 class="svelte-plcxj0">Activity Stream</h3> <div class="feed-list svelte-plcxj0"></div></div> <div class="bento-item workload-grid svelte-plcxj0"><h3 class="svelte-plcxj0">Assignee Distribution</h3> <div class="assignee-list svelte-plcxj0"></div></div> <!></div>',1),sc=b('<div class="dashboard-wrapper svelte-plcxj0"><!></div>');function rc(t,e){ot(e,!0);let n=y(null),r=y(!0),s=y(null);Jt(()=>(i(),Qa([{label:"Dashboard",items:[{label:"Refresh",action:i}]}]),()=>{Ka()}));async function i(){u(r,!0),u(s,null);try{u(n,await oo(),!0)}catch(m){console.error("Failed to load dashboard data",m),u(s,"Failed to load dashboard statistics. Please try again later.")}finally{u(r,!1)}}function c(m){return m?new Date(m).toLocaleString():""}function d(m){switch(m){case"POST":return"➕";case"PUT":return"📝";case"DELETE":return"🗑️";default:return"⚡"}}function v(m){return m.split("_").map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(" ")}var p=sc(),f=l(p);{var _=m=>{var x=Wo();g(m,x)},h=m=>{var x=lt(),S=je(x);{var w=z=>{var E=Ho(),P=o(l(E),2),M=l(P),D=o(P,2);D.__click=i,G(()=>q(M,a(s))),g(z,E)},k=z=>{var E=lt(),P=je(E);{var M=D=>{var H=nc(),Y=o(je(H),2),R=l(Y),X=l(R),Z=l(X),J=l(Z),O=o(X,2),re=l(O),ie=o(l(re),2),de=l(ie),ve=o(re,2),le=o(l(ve),2),_e=l(le),ge=o(R,2),Pe=o(l(ge),2);Ae(Pe,21,()=>Object.entries(a(n).task_stats.by_status),Fe,(j,B)=>{var W=Ze(()=>xn(a(B),2));let se=()=>a(W)[0],ce=()=>a(W)[1];var ue=Zo(),C=l(ue),T=l(C),Q=l(T),me=o(T,2),Me=l(me),Be=o(C,2),Ge=l(Be);G(()=>{q(Q,se()),q(Me,ce()),$e(Ge,1,`bar-fill ${se()??""}`,"svelte-plcxj0"),cn(Ge,`width: ${ce()/a(n).task_stats.total*100||0}%`)}),g(j,ue)});var ke=o(ge,2),$=o(l(ke),2),A=l($),U=o(l(A),2),ne=l(U),ee=o(A,2),oe=o(l(ee),2),qe=l(oe),ye=o(ee,2),Oe=o(l(ye),2),fe=l(Oe),Se=o(ke,2),pe=o(l(Se),2);Ae(pe,21,()=>a(n).recent_activity,Fe,(j,B)=>{var W=Vo(),se=l(W),ce=l(se),ue=o(se,2),C=l(ue),T=l(C),Q=l(T),me=o(T),Me=o(C,2),Be=l(Me);G((Ge,et,xe,Le)=>{q(ce,Ge),q(Q,a(B).actor),q(me,` ${et??""}
                                    ${xe??""} #${a(B).entity_id??""}`),q(Be,Le)},[()=>d(a(B).action),()=>a(B).action.toLowerCase()==="post"?"created":a(B).action.toLowerCase()==="put"?"updated":"removed",()=>v(a(B).entity),()=>c(a(B).timestamp)]),g(j,W)},j=>{var B=Qo();g(j,B)});var I=o(Se,2),V=o(l(I),2);Ae(V,21,()=>Object.entries(a(n).task_stats.by_assignee),Fe,(j,B)=>{var W=Ze(()=>xn(a(B),2));let se=()=>a(W)[0],ce=()=>a(W)[1];var ue=Ko(),C=l(ue),T=l(C),Q=o(C,2),me=l(Q);G(()=>{q(T,se()),q(me,`${ce()??""} tasks`)}),g(j,ue)});var ae=o(I,2);{var te=j=>{var B=ac(),W=o(l(B),2),se=l(W);{var ce=T=>{var Q=ec(),me=l(Q),Me=l(me);G(()=>q(Me,a(n).journal_summary.error)),g(T,Q)};L(se,T=>{a(n).journal_summary.error&&T(ce)})}var ue=o(se,2);{var C=T=>{var Q=tc(),me=l(Q),Me=l(me);G(()=>q(Me,a(n).journal_summary.warning)),g(T,Q)};L(ue,T=>{a(n).journal_summary.warning&&T(C)})}g(j,B)};L(ae,j=>{(a(n).journal_summary.warning||a(n).journal_summary.error)&&j(te)})}G(()=>{q(J,a(n).document_stats.total),q(de,a(n).document_stats.by_status.in_progress||0),q(_e,a(n).document_stats.by_status.done||0),q(ne,a(n).inventory.total_materials),q(qe,a(n).inventory.total_quantity),q(fe,a(n).inventory.total_reserved)}),g(D,H)};L(P,D=>{a(n)&&D(M)},!0)}g(z,E)};L(S,z=>{a(s)?z(w):z(k,!1)},!0)}g(m,x)};L(f,m=>{a(r)?m(_):m(h,!1)})}g(t,p),ct()}gt(["click"]);var ic=b('<div class="modal-backdrop svelte-5awcn0" role="button" tabindex="0"><div class="modal-content svelte-5awcn0" role="document" tabindex="0"><button class="close-btn svelte-5awcn0">&times;</button> <!></div></div>');function vi(t,e){ot(e,!0);let n=bt(e,"maxWidth",3,"500px");function r(d){d.key==="Escape"&&e.close()}var s=lt(),i=je(s);{var c=d=>{var v=ic();v.__click=function(...h){e.close?.apply(this,h)},v.__keydown=r;var p=l(v);p.__click=h=>h.stopPropagation(),p.__keydown=h=>h.stopPropagation();var f=l(p);f.__click=function(...h){e.close?.apply(this,h)};var _=o(f,2);Gl(_,()=>e.children),G(()=>cn(p,`max-width: ${n()??""}`)),g(d,v)};L(i,d=>{e.isOpen&&d(c)})}g(t,s),ct()}gt(["click","keydown"]);function Is(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var en=Is();function ui(t){en=t}var kn={exec:()=>null};function Ke(t,e=""){let n=typeof t=="string"?t:t.source,r={replace:(s,i)=>{let c=typeof i=="string"?i:i.source;return c=c.replace(Ht.caret,"$1"),n=n.replace(s,c),r},getRegex:()=>new RegExp(n,e)};return r}var lc=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),Ht={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},oc=/^(?:[ \t]*(?:\n|$))+/,cc=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,vc=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Mn=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,uc=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Ls=/(?:[*+-]|\d{1,9}[.)])/,di=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,fi=Ke(di).replace(/bull/g,Ls).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),dc=Ke(di).replace(/bull/g,Ls).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),$s=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,fc=/^[^\n]+/,Fs=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,pc=Ke(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Fs).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),hc=Ke(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Ls).getRegex(),Vn="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Bs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,_c=Ke("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Bs).replace("tag",Vn).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),pi=Ke($s).replace("hr",Mn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Vn).getRegex(),gc=Ke(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",pi).getRegex(),Us={blockquote:gc,code:cc,def:pc,fences:vc,heading:uc,hr:Mn,html:_c,lheading:fi,list:hc,newline:oc,paragraph:pi,table:kn,text:fc},vr=Ke("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Mn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Vn).getRegex(),mc={...Us,lheading:dc,table:vr,paragraph:Ke($s).replace("hr",Mn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",vr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Vn).getRegex()},bc={...Us,html:Ke(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Bs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:kn,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ke($s).replace("hr",Mn).replace("heading",` *#{1,6} *[^
]`).replace("lheading",fi).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},yc=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,wc=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,hi=/^( {2,}|\\)\n(?!\s*$)/,kc=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Qn=/[\p{P}\p{S}]/u,Gs=/[\s\p{P}\p{S}]/u,_i=/[^\s\p{P}\p{S}]/u,xc=Ke(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Gs).getRegex(),gi=/(?!~)[\p{P}\p{S}]/u,Sc=/(?!~)[\s\p{P}\p{S}]/u,Tc=/(?:[^\s\p{P}\p{S}]|~)/u,qc=Ke(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",lc?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),mi=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Ec=Ke(mi,"u").replace(/punct/g,Qn).getRegex(),jc=Ke(mi,"u").replace(/punct/g,gi).getRegex(),bi="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ac=Ke(bi,"gu").replace(/notPunctSpace/g,_i).replace(/punctSpace/g,Gs).replace(/punct/g,Qn).getRegex(),Pc=Ke(bi,"gu").replace(/notPunctSpace/g,Tc).replace(/punctSpace/g,Sc).replace(/punct/g,gi).getRegex(),Cc=Ke("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,_i).replace(/punctSpace/g,Gs).replace(/punct/g,Qn).getRegex(),Rc=Ke(/\\(punct)/,"gu").replace(/punct/g,Qn).getRegex(),zc=Ke(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Mc=Ke(Bs).replace("(?:-->|$)","-->").getRegex(),Nc=Ke("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Mc).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Un=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Dc=Ke(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Un).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),yi=Ke(/^!?\[(label)\]\[(ref)\]/).replace("label",Un).replace("ref",Fs).getRegex(),wi=Ke(/^!?\[(ref)\](?:\[\])?/).replace("ref",Fs).getRegex(),Oc=Ke("reflink|nolink(?!\\()","g").replace("reflink",yi).replace("nolink",wi).getRegex(),ur=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Ys={_backpedal:kn,anyPunctuation:Rc,autolink:zc,blockSkip:qc,br:hi,code:wc,del:kn,emStrongLDelim:Ec,emStrongRDelimAst:Ac,emStrongRDelimUnd:Cc,escape:yc,link:Dc,nolink:wi,punctuation:xc,reflink:yi,reflinkSearch:Oc,tag:Nc,text:kc,url:kn},Ic={...Ys,link:Ke(/^!?\[(label)\]\((.*?)\)/).replace("label",Un).getRegex(),reflink:Ke(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Un).getRegex()},ms={...Ys,emStrongRDelimAst:Pc,emStrongLDelim:jc,url:Ke(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",ur).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:Ke(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",ur).getRegex()},Lc={...ms,br:Ke(hi).replace("{2,}","*").getRegex(),text:Ke(ms.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},On={normal:Us,gfm:mc,pedantic:bc},pn={normal:Ys,gfm:ms,breaks:Lc,pedantic:Ic},$c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},dr=t=>$c[t];function wa(t,e){if(e){if(Ht.escapeTest.test(t))return t.replace(Ht.escapeReplace,dr)}else if(Ht.escapeTestNoEncode.test(t))return t.replace(Ht.escapeReplaceNoEncode,dr);return t}function fr(t){try{t=encodeURI(t).replace(Ht.percentDecode,"%")}catch{return null}return t}function pr(t,e){let n=t.replace(Ht.findPipe,(i,c,d)=>{let v=!1,p=c;for(;--p>=0&&d[p]==="\\";)v=!v;return v?"|":" |"}),r=n.split(Ht.splitPipe),s=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(Ht.slashPipe,"|");return r}function hn(t,e,n){let r=t.length;if(r===0)return"";let s=0;for(;s<r&&t.charAt(r-s-1)===e;)s++;return t.slice(0,r-s)}function Fc(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}function hr(t,e,n,r,s){let i=e.href,c=e.title||null,d=t[1].replace(s.other.outputLinkReplace,"$1");r.state.inLink=!0;let v={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:i,title:c,text:d,tokens:r.inlineTokens(d)};return r.state.inLink=!1,v}function Bc(t,e,n){let r=t.match(n.other.indentCodeCompensation);if(r===null)return e;let s=r[1];return e.split(`
`).map(i=>{let c=i.match(n.other.beginningSpace);if(c===null)return i;let[d]=c;return d.length>=s.length?i.slice(s.length):i}).join(`
`)}var Gn=class{options;rules;lexer;constructor(t){this.options=t||en}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:hn(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],r=Bc(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let r=hn(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:hn(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=hn(e[0],`
`).split(`
`),r="",s="",i=[];for(;n.length>0;){let c=!1,d=[],v;for(v=0;v<n.length;v++)if(this.rules.other.blockquoteStart.test(n[v]))d.push(n[v]),c=!0;else if(!c)d.push(n[v]);else break;n=n.slice(v);let p=d.join(`
`),f=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${p}`:p,s=s?`${s}
${f}`:f;let _=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(f,i,!0),this.lexer.state.top=_,n.length===0)break;let h=i.at(-1);if(h?.type==="code")break;if(h?.type==="blockquote"){let m=h,x=m.raw+`
`+n.join(`
`),S=this.blockquote(x);i[i.length-1]=S,r=r.substring(0,r.length-m.raw.length)+S.raw,s=s.substring(0,s.length-m.text.length)+S.text;break}else if(h?.type==="list"){let m=h,x=m.raw+`
`+n.join(`
`),S=this.list(x);i[i.length-1]=S,r=r.substring(0,r.length-h.raw.length)+S.raw,s=s.substring(0,s.length-m.raw.length)+S.raw,n=x.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:i,text:s}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim(),r=n.length>1,s={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");let i=this.rules.other.listItemRegex(n),c=!1;for(;t;){let v=!1,p="",f="";if(!(e=i.exec(t))||this.rules.block.hr.test(t))break;p=e[0],t=t.substring(p.length);let _=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,S=>" ".repeat(3*S.length)),h=t.split(`
`,1)[0],m=!_.trim(),x=0;if(this.options.pedantic?(x=2,f=_.trimStart()):m?x=e[1].length+1:(x=e[2].search(this.rules.other.nonSpaceChar),x=x>4?1:x,f=_.slice(x),x+=e[1].length),m&&this.rules.other.blankLine.test(h)&&(p+=h+`
`,t=t.substring(h.length+1),v=!0),!v){let S=this.rules.other.nextBulletRegex(x),w=this.rules.other.hrRegex(x),k=this.rules.other.fencesBeginRegex(x),z=this.rules.other.headingBeginRegex(x),E=this.rules.other.htmlBeginRegex(x);for(;t;){let P=t.split(`
`,1)[0],M;if(h=P,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,"  "),M=h):M=h.replace(this.rules.other.tabCharGlobal,"    "),k.test(h)||z.test(h)||E.test(h)||S.test(h)||w.test(h))break;if(M.search(this.rules.other.nonSpaceChar)>=x||!h.trim())f+=`
`+M.slice(x);else{if(m||_.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||k.test(_)||z.test(_)||w.test(_))break;f+=`
`+h}!m&&!h.trim()&&(m=!0),p+=P+`
`,t=t.substring(P.length+1),_=M.slice(x)}}s.loose||(c?s.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(c=!0)),s.items.push({type:"list_item",raw:p,task:!!this.options.gfm&&this.rules.other.listIsTask.test(f),loose:!1,text:f,tokens:[]}),s.raw+=p}let d=s.items.at(-1);if(d)d.raw=d.raw.trimEnd(),d.text=d.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let v of s.items){if(this.lexer.state.top=!1,v.tokens=this.lexer.blockTokens(v.text,[]),v.task){if(v.text=v.text.replace(this.rules.other.listReplaceTask,""),v.tokens[0]?.type==="text"||v.tokens[0]?.type==="paragraph"){v.tokens[0].raw=v.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),v.tokens[0].text=v.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let f=this.lexer.inlineQueue.length-1;f>=0;f--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[f].src)){this.lexer.inlineQueue[f].src=this.lexer.inlineQueue[f].src.replace(this.rules.other.listReplaceTask,"");break}}let p=this.rules.other.listTaskCheckbox.exec(v.raw);if(p){let f={type:"checkbox",raw:p[0]+" ",checked:p[0]!=="[ ]"};v.checked=f.checked,s.loose?v.tokens[0]&&["paragraph","text"].includes(v.tokens[0].type)&&"tokens"in v.tokens[0]&&v.tokens[0].tokens?(v.tokens[0].raw=f.raw+v.tokens[0].raw,v.tokens[0].text=f.raw+v.tokens[0].text,v.tokens[0].tokens.unshift(f)):v.tokens.unshift({type:"paragraph",raw:f.raw,text:f.raw,tokens:[f]}):v.tokens.unshift(f)}}if(!s.loose){let p=v.tokens.filter(_=>_.type==="space"),f=p.length>0&&p.some(_=>this.rules.other.anyLine.test(_.raw));s.loose=f}}if(s.loose)for(let v of s.items){v.loose=!0;for(let p of v.tokens)p.type==="text"&&(p.type="paragraph")}return s}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:r,title:s}}}table(t){let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=pr(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(let c of r)this.rules.other.tableAlignRight.test(c)?i.align.push("right"):this.rules.other.tableAlignCenter.test(c)?i.align.push("center"):this.rules.other.tableAlignLeft.test(c)?i.align.push("left"):i.align.push(null);for(let c=0;c<n.length;c++)i.header.push({text:n[c],tokens:this.lexer.inline(n[c]),header:!0,align:i.align[c]});for(let c of s)i.rows.push(pr(c,i.header.length).map((d,v)=>({text:d,tokens:this.lexer.inline(d),header:!1,align:i.align[v]})));return i}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let i=hn(n.slice(0,-1),"\\");if((n.length-i.length)%2===0)return}else{let i=Fc(e[2],"()");if(i===-2)return;if(i>-1){let c=(e[0].indexOf("!")===0?5:4)+e[1].length+i;e[2]=e[2].substring(0,i),e[0]=e[0].substring(0,c).trim(),e[3]=""}}let r=e[2],s="";if(this.options.pedantic){let i=this.rules.other.pedanticHrefTitle.exec(r);i&&(r=i[1],s=i[3])}else s=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),hr(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[r.toLowerCase()];if(!s){let i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return hr(n,s,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...r[0]].length-1,i,c,d=s,v=0,p=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*t.length+s);(r=p.exec(e))!=null;){if(i=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!i)continue;if(c=[...i].length,r[3]||r[4]){d+=c;continue}else if((r[5]||r[6])&&s%3&&!((s+c)%3)){v+=c;continue}if(d-=c,d>0)continue;c=Math.min(c,c+d+v);let f=[...r[0]][0].length,_=t.slice(0,s+r.index+f+c);if(Math.min(s,c)%2){let m=_.slice(1,-1);return{type:"em",raw:_,text:m,tokens:this.lexer.inlineTokens(m)}}let h=_.slice(2,-2);return{type:"strong",raw:_,text:h,tokens:this.lexer.inlineTokens(h)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,r;return e[2]==="@"?(n=e[1],r="mailto:"+n):(n=e[1],r=n),{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let n,r;if(e[2]==="@")n=e[0],r="mailto:"+n;else{let s;do s=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(s!==e[0]);n=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},ua=class bs{tokens;options;state;inlineQueue;tokenizer;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||en,this.options.tokenizer=this.options.tokenizer||new Gn,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:Ht,block:On.normal,inline:pn.normal};this.options.pedantic?(n.block=On.pedantic,n.inline=pn.pedantic):this.options.gfm&&(n.block=On.gfm,this.options.breaks?n.inline=pn.breaks:n.inline=pn.gfm),this.tokenizer.rules=n}static get rules(){return{block:On,inline:pn}}static lex(e,n){return new bs(n).lex(e)}static lexInline(e,n){return new bs(n).inlineTokens(e)}lex(e){e=e.replace(Ht.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],r=!1){for(this.options.pedantic&&(e=e.replace(Ht.tabCharGlobal,"    ").replace(Ht.spaceLine,""));e;){let s;if(this.options.extensions?.block?.some(c=>(s=c.call({lexer:this},e,n))?(e=e.substring(s.raw.length),n.push(s),!0):!1))continue;if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length);let c=n.at(-1);s.raw.length===1&&c!==void 0?c.raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length);let c=n.at(-1);c?.type==="paragraph"||c?.type==="text"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+s.raw,c.text+=`
`+s.text,this.inlineQueue.at(-1).src=c.text):n.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length);let c=n.at(-1);c?.type==="paragraph"||c?.type==="text"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+s.raw,c.text+=`
`+s.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title},n.push(s));continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),n.push(s);continue}let i=e;if(this.options.extensions?.startBlock){let c=1/0,d=e.slice(1),v;this.options.extensions.startBlock.forEach(p=>{v=p.call({lexer:this},d),typeof v=="number"&&v>=0&&(c=Math.min(c,v))}),c<1/0&&c>=0&&(i=e.substring(0,c+1))}if(this.state.top&&(s=this.tokenizer.paragraph(i))){let c=n.at(-1);r&&c?.type==="paragraph"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+s.raw,c.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):n.push(s),r=i.length!==e.length,e=e.substring(s.raw.length);continue}if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length);let c=n.at(-1);c?.type==="text"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+s.raw,c.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):n.push(s);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){let r=e,s=null;if(this.tokens.links){let v=Object.keys(this.tokens.links);if(v.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)v.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,s.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)i=s[2]?s[2].length:0,r=r.slice(0,s.index+i)+"["+"a".repeat(s[0].length-i-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let c=!1,d="";for(;e;){c||(d=""),c=!1;let v;if(this.options.extensions?.inline?.some(f=>(v=f.call({lexer:this},e,n))?(e=e.substring(v.raw.length),n.push(v),!0):!1))continue;if(v=this.tokenizer.escape(e)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.tag(e)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.link(e)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(v.raw.length);let f=n.at(-1);v.type==="text"&&f?.type==="text"?(f.raw+=v.raw,f.text+=v.text):n.push(v);continue}if(v=this.tokenizer.emStrong(e,r,d)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.codespan(e)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.br(e)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.del(e)){e=e.substring(v.raw.length),n.push(v);continue}if(v=this.tokenizer.autolink(e)){e=e.substring(v.raw.length),n.push(v);continue}if(!this.state.inLink&&(v=this.tokenizer.url(e))){e=e.substring(v.raw.length),n.push(v);continue}let p=e;if(this.options.extensions?.startInline){let f=1/0,_=e.slice(1),h;this.options.extensions.startInline.forEach(m=>{h=m.call({lexer:this},_),typeof h=="number"&&h>=0&&(f=Math.min(f,h))}),f<1/0&&f>=0&&(p=e.substring(0,f+1))}if(v=this.tokenizer.inlineText(p)){e=e.substring(v.raw.length),v.raw.slice(-1)!=="_"&&(d=v.raw.slice(-1)),c=!0;let f=n.at(-1);f?.type==="text"?(f.raw+=v.raw,f.text+=v.text):n.push(v);continue}if(e){let f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return n}},Yn=class{options;parser;constructor(t){this.options=t||en}space(t){return""}code({text:t,lang:e,escaped:n}){let r=(e||"").match(Ht.notSpaceStart)?.[0],s=t.replace(Ht.endingNewline,"")+`
`;return r?'<pre><code class="language-'+wa(r)+'">'+(n?s:wa(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:wa(s,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,r="";for(let c=0;c<t.items.length;c++){let d=t.items[c];r+=this.listitem(d)}let s=e?"ol":"ul",i=e&&n!==1?' start="'+n+'"':"";return"<"+s+i+`>
`+r+"</"+s+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let s=0;s<t.header.length;s++)n+=this.tablecell(t.header[s]);e+=this.tablerow({text:n});let r="";for(let s=0;s<t.rows.length;s++){let i=t.rows[s];n="";for(let c=0;c<i.length;c++)n+=this.tablecell(i[c]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${wa(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let r=this.parser.parseInline(n),s=fr(t);if(s===null)return r;t=s;let i='<a href="'+t+'"';return e&&(i+=' title="'+wa(e)+'"'),i+=">"+r+"</a>",i}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));let s=fr(t);if(s===null)return wa(n);t=s;let i=`<img src="${t}" alt="${n}"`;return e&&(i+=` title="${wa(e)}"`),i+=">",i}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:wa(t.text)}},Xs=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},da=class ys{options;renderer;textRenderer;constructor(e){this.options=e||en,this.options.renderer=this.options.renderer||new Yn,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Xs}static parse(e,n){return new ys(n).parse(e)}static parseInline(e,n){return new ys(n).parseInline(e)}parse(e){let n="";for(let r=0;r<e.length;r++){let s=e[r];if(this.options.extensions?.renderers?.[s.type]){let c=s,d=this.options.extensions.renderers[c.type].call({parser:this},c);if(d!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(c.type)){n+=d||"";continue}}let i=s;switch(i.type){case"space":{n+=this.renderer.space(i);break}case"hr":{n+=this.renderer.hr(i);break}case"heading":{n+=this.renderer.heading(i);break}case"code":{n+=this.renderer.code(i);break}case"table":{n+=this.renderer.table(i);break}case"blockquote":{n+=this.renderer.blockquote(i);break}case"list":{n+=this.renderer.list(i);break}case"checkbox":{n+=this.renderer.checkbox(i);break}case"html":{n+=this.renderer.html(i);break}case"def":{n+=this.renderer.def(i);break}case"paragraph":{n+=this.renderer.paragraph(i);break}case"text":{n+=this.renderer.text(i);break}default:{let c='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return n}parseInline(e,n=this.renderer){let r="";for(let s=0;s<e.length;s++){let i=e[s];if(this.options.extensions?.renderers?.[i.type]){let d=this.options.extensions.renderers[i.type].call({parser:this},i);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){r+=d||"";continue}}let c=i;switch(c.type){case"escape":{r+=n.text(c);break}case"html":{r+=n.html(c);break}case"link":{r+=n.link(c);break}case"image":{r+=n.image(c);break}case"checkbox":{r+=n.checkbox(c);break}case"strong":{r+=n.strong(c);break}case"em":{r+=n.em(c);break}case"codespan":{r+=n.codespan(c);break}case"br":{r+=n.br(c);break}case"del":{r+=n.del(c);break}case"text":{r+=n.text(c);break}default:{let d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return r}},mn=class{options;block;constructor(t){this.options=t||en}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?ua.lex:ua.lexInline}provideParser(){return this.block?da.parse:da.parseInline}},Uc=class{defaults=Is();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=da;Renderer=Yn;TextRenderer=Xs;Lexer=ua;Tokenizer=Gn;Hooks=mn;constructor(...t){this.use(...t)}walkTokens(t,e){let n=[];for(let r of t)switch(n=n.concat(e.call(this,r)),r.type){case"table":{let s=r;for(let i of s.header)n=n.concat(this.walkTokens(i.tokens,e));for(let i of s.rows)for(let c of i)n=n.concat(this.walkTokens(c.tokens,e));break}case"list":{let s=r;n=n.concat(this.walkTokens(s.items,e));break}default:{let s=r;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(i=>{let c=s[i].flat(1/0);n=n.concat(this.walkTokens(c,e))}):s.tokens&&(n=n.concat(this.walkTokens(s.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let i=e.renderers[s.name];i?e.renderers[s.name]=function(...c){let d=s.renderer.apply(this,c);return d===!1&&(d=i.apply(this,c)),d}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=e[s.level];i?i.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),r.extensions=e),n.renderer){let s=this.defaults.renderer||new Yn(this.defaults);for(let i in n.renderer){if(!(i in s))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;let c=i,d=n.renderer[c],v=s[c];s[c]=(...p)=>{let f=d.apply(s,p);return f===!1&&(f=v.apply(s,p)),f||""}}r.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Gn(this.defaults);for(let i in n.tokenizer){if(!(i in s))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let c=i,d=n.tokenizer[c],v=s[c];s[c]=(...p)=>{let f=d.apply(s,p);return f===!1&&(f=v.apply(s,p)),f}}r.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new mn;for(let i in n.hooks){if(!(i in s))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;let c=i,d=n.hooks[c],v=s[c];mn.passThroughHooks.has(i)?s[c]=p=>{if(this.defaults.async&&mn.passThroughHooksRespectAsync.has(i))return(async()=>{let _=await d.call(s,p);return v.call(s,_)})();let f=d.call(s,p);return v.call(s,f)}:s[c]=(...p)=>{if(this.defaults.async)return(async()=>{let _=await d.apply(s,p);return _===!1&&(_=await v.apply(s,p)),_})();let f=d.apply(s,p);return f===!1&&(f=v.apply(s,p)),f}}r.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,i=n.walkTokens;r.walkTokens=function(c){let d=[];return d.push(i.call(this,c)),s&&(d=d.concat(s.call(this,c))),d}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return ua.lex(t,e??this.defaults)}parser(t,e){return da.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{let r={...n},s={...this.defaults,...r},i=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&r.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=t),s.async)return(async()=>{let c=s.hooks?await s.hooks.preprocess(e):e,d=await(s.hooks?await s.hooks.provideLexer():t?ua.lex:ua.lexInline)(c,s),v=s.hooks?await s.hooks.processAllTokens(d):d;s.walkTokens&&await Promise.all(this.walkTokens(v,s.walkTokens));let p=await(s.hooks?await s.hooks.provideParser():t?da.parse:da.parseInline)(v,s);return s.hooks?await s.hooks.postprocess(p):p})().catch(i);try{s.hooks&&(e=s.hooks.preprocess(e));let c=(s.hooks?s.hooks.provideLexer():t?ua.lex:ua.lexInline)(e,s);s.hooks&&(c=s.hooks.processAllTokens(c)),s.walkTokens&&this.walkTokens(c,s.walkTokens);let d=(s.hooks?s.hooks.provideParser():t?da.parse:da.parseInline)(c,s);return s.hooks&&(d=s.hooks.postprocess(d)),d}catch(c){return i(c)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let r="<p>An error occurred:</p><pre>"+wa(n.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(n);throw n}}},Wa=new Uc;function ut(t,e){return Wa.parse(t,e)}ut.options=ut.setOptions=function(t){return Wa.setOptions(t),ut.defaults=Wa.defaults,ui(ut.defaults),ut};ut.getDefaults=Is;ut.defaults=en;ut.use=function(...t){return Wa.use(...t),ut.defaults=Wa.defaults,ui(ut.defaults),ut};ut.walkTokens=function(t,e){return Wa.walkTokens(t,e)};ut.parseInline=Wa.parseInline;ut.Parser=da;ut.parser=da.parse;ut.Renderer=Yn;ut.TextRenderer=Xs;ut.Lexer=ua;ut.lexer=ua.lex;ut.Tokenizer=Gn;ut.Hooks=mn;ut.parse=ut;ut.options;ut.setOptions;ut.use;ut.walkTokens;ut.parseInline;da.parse;ua.lex;var Gc=b('<span class="author"> </span>'),Yc=b('<span class="date"> </span>'),Xc=b('<span class="tag-badge svelte-187zyvb"> </span>'),Jc=b('<div class="tags-row svelte-187zyvb"></div>'),Wc=b('<img class="svelte-187zyvb"/>'),Hc=b('<div class="attachment-card svelte-187zyvb"><!> <a target="_blank" rel="noreferrer" class="svelte-187zyvb"> </a></div>'),Zc=b('<div class="attachments svelte-187zyvb"><h3 class="svelte-187zyvb">Attachments</h3> <div class="grid svelte-187zyvb"></div></div>'),Vc=b('<a target="_blank" rel="noreferrer" class="note-attachment-link svelte-187zyvb"> </a>'),Qc=b('<div class="note-attachments svelte-187zyvb"><strong class="svelte-187zyvb">Attachments:</strong> <!></div>'),Kc=b('<div class="note-card svelte-187zyvb"><div class="note-header svelte-187zyvb"><span> </span> <span class="note-author svelte-187zyvb"> </span> <span class="note-date svelte-187zyvb"> </span> <span> </span></div> <p class="note-text svelte-187zyvb"> </p> <!></div>'),ev=b('<div class="notes-section svelte-187zyvb"><h3 class="svelte-187zyvb">Notes</h3> <div class="notes-list svelte-187zyvb"></div></div>'),tv=b('<div class="document-view"><h2 class="svelte-187zyvb"> </h2> <div class="meta svelte-187zyvb"><span> </span> <span> </span> <span class="date"> </span> <!> <!></div> <!> <div class="content markdown-body svelte-187zyvb"><!></div> <!> <!></div>');function av(t,e){ot(e,!0);let n=Ze(()=>e.document&&e.document.content?ut.parse(e.document.content):"<p>No content available.</p>");var r=tv(),s=l(r),i=l(s),c=o(s,2),d=l(c),v=l(d),p=o(d,2),f=l(p),_=o(p,2),h=l(_),m=o(_,2);{var x=R=>{var X=Gc(),Z=l(X);G(()=>q(Z,`By ${e.document.author??""}`)),g(R,X)};L(m,R=>{e.document?.author&&R(x)})}var S=o(m,2);{var w=R=>{var X=Yc(),Z=l(X);G(()=>q(Z,`Done: ${e.document.done_date??""}`)),g(R,X)};L(S,R=>{e.document?.done_date&&R(w)})}var k=o(c,2);{var z=R=>{var X=Jc();Ae(X,21,()=>e.document.tags,Fe,(Z,J)=>{var O=Xc(),re=l(O);G(()=>q(re,`#${a(J).name??""}`)),g(Z,O)}),g(R,X)};L(k,R=>{e.document?.tags?.length>0&&R(z)})}var E=o(k,2),P=l(E);Ul(P,()=>a(n));var M=o(E,2);{var D=R=>{var X=Zc(),Z=o(l(X),2);Ae(Z,21,()=>e.document.attachments,Fe,(J,O)=>{var re=Hc(),ie=l(re);{var de=_e=>{var ge=Wc();G(()=>{Qe(ge,"src",a(O).file_path),Qe(ge,"alt",a(O).filename)}),g(_e,ge)};L(ie,_e=>{a(O).media_type&&a(O).media_type.startsWith("image/")&&_e(de)})}var ve=o(ie,2),le=l(ve);G(()=>{Qe(ve,"href",a(O).file_path),q(le,a(O).filename)}),g(J,re)}),g(R,X)};L(M,R=>{e.document?.attachments?.length>0&&R(D)})}var H=o(M,2);{var Y=R=>{var X=ev(),Z=o(l(X),2);Ae(Z,21,()=>e.document.journal_entries,Fe,(J,O)=>{var re=Kc(),ie=l(re),de=l(ie),ve=l(de),le=o(de,2),_e=l(le),ge=o(le,2),Pe=l(ge),ke=o(ge,2),$=l(ke),A=o(ie,2),U=l(A),ne=o(A,2);{var ee=oe=>{var qe=Qc(),ye=o(l(qe),2);Ae(ye,17,()=>a(O).attachments,Fe,(Oe,fe)=>{var Se=Vc(),pe=l(Se);G(()=>{Qe(Se,"href",a(fe).file_path),q(pe,`📎 ${a(fe).filename??""}`)}),g(Oe,Se)}),g(oe,qe)};L(ne,oe=>{a(O).attachments?.length>0&&oe(ee)})}G(()=>{$e(de,1,`note-badge ${a(O).type??""}`,"svelte-187zyvb"),q(ve,a(O).type),q(_e,a(O).author||"Unknown"),q(Pe,a(O).created_at),$e(ke,1,`note-status ${a(O).status??""}`,"svelte-187zyvb"),q($,a(O).status),q(U,a(O).text)}),g(J,re)}),g(R,X)};L(H,R=>{e.document?.journal_entries?.length>0&&R(Y)})}G(R=>{q(i,e.document?.name),$e(d,1,`badge ${e.document?.type??""}`,"svelte-187zyvb"),q(v,e.document?.type),$e(p,1,`badge status-${e.document?.status??""}`,"svelte-187zyvb"),q(f,R),q(h,e.document?.registration_date)},[()=>e.document?.status.replace("_"," ")]),g(t,r),ct()}var nv=b('<input type="text" class="edit-input svelte-1b0y5ne"/>'),sv=b('<button class="btn-icon svelte-1b0y5ne" title="Save">✓</button> <button class="btn-icon svelte-1b0y5ne" title="Cancel">✕</button>',1),rv=b('<button class="btn-icon svelte-1b0y5ne" title="Edit">✏️</button> <button class="btn-icon delete svelte-1b0y5ne" title="Delete">🗑️</button>',1),iv=b('<tr class="svelte-1b0y5ne"><td class="svelte-1b0y5ne"><!></td><td class="svelte-1b0y5ne"><!></td></tr>'),lv=b('<div class="empty-state svelte-1b0y5ne">No materials yet. Add one above.</div>'),ov=b('<div class="modal-overlay svelte-1b0y5ne"><div class="modal-content svelte-1b0y5ne"><div class="modal-header svelte-1b0y5ne"><h3 class="svelte-1b0y5ne">Material Library</h3> <button class="close-btn svelte-1b0y5ne">&times;</button></div> <div class="modal-body svelte-1b0y5ne"><div class="add-section svelte-1b0y5ne"><input type="text" placeholder="New material name..." class="svelte-1b0y5ne"/> <button class="btn-add svelte-1b0y5ne">Add</button></div> <table class="materials-table svelte-1b0y5ne"><thead><tr><th class="svelte-1b0y5ne">Name</th><th class="svelte-1b0y5ne">Actions</th></tr></thead><tbody></tbody></table> <!></div></div></div>');function cv(t,e){ot(e,!0);let n=y(Ne([])),r=y(""),s=y(null),i=y("");async function c(){e.isOpen&&u(n,await Va(),!0)}Ft(()=>{c()});async function d(){if(a(r).trim())try{await To({name:a(r).trim()}),u(r,""),await c()}catch(S){console.error(S),alert("Failed to add material")}}function v(S){u(s,S.id,!0),u(i,S.name,!0)}async function p(){if(!(!a(i).trim()||a(s)===null))try{await Eo(a(s),a(i).trim()),u(s,null),u(i,""),await c()}catch(S){console.error(S),alert("Failed to update material")}}function f(){u(s,null),u(i,"")}async function _(S){if(confirm("Delete this material?"))try{await jo(S),await c()}catch(w){console.error(w),alert("Failed to delete material")}}var h=lt(),m=je(h);{var x=S=>{var w=ov();w.__click=function(...J){e.close?.apply(this,J)};var k=l(w);k.__click=J=>J.stopPropagation();var z=l(k),E=o(l(z),2);E.__click=function(...J){e.close?.apply(this,J)};var P=o(z,2),M=l(P),D=l(M);D.__keydown=J=>J.key==="Enter"&&d();var H=o(D,2);H.__click=d;var Y=o(M,2),R=o(l(Y));Ae(R,21,()=>a(n),J=>J.id,(J,O)=>{var re=iv(),ie=l(re),de=l(ie);{var ve=$=>{var A=nv();js(A),A.__keydown=U=>{U.key==="Enter"&&p(),U.key==="Escape"&&f()},Ce(A,()=>a(i),U=>u(i,U)),g($,A)},le=$=>{var A=ii();G(()=>q(A,a(O).name)),g($,A)};L(de,$=>{a(s)===a(O).id?$(ve):$(le,!1)})}var _e=o(ie),ge=l(_e);{var Pe=$=>{var A=sv(),U=je(A);U.__click=p;var ne=o(U,2);ne.__click=f,g($,A)},ke=$=>{var A=rv(),U=je(A);U.__click=()=>v(a(O));var ne=o(U,2);ne.__click=()=>_(a(O).id),g($,A)};L(ge,$=>{a(s)===a(O).id?$(Pe):$(ke,!1)})}g(J,re)});var X=o(Y,2);{var Z=J=>{var O=lv();g(J,O)};L(X,J=>{a(n).length===0&&J(Z)})}Ce(D,()=>a(r),J=>u(r,J)),g(S,w)};L(m,S=>{e.isOpen&&S(x)})}g(t,h),ct()}gt(["click","keydown"]);var vv=b('<input type="text" class="edit-input svelte-1w6q42o"/>'),uv=b('<button class="btn-icon svelte-1w6q42o" title="Save">✓</button> <button class="btn-icon svelte-1w6q42o" title="Cancel">✕</button>',1),dv=b('<button class="btn-icon svelte-1w6q42o" title="Edit">✏️</button> <button class="btn-icon delete svelte-1w6q42o" title="Delete">🗑️</button>',1),fv=b('<tr class="svelte-1w6q42o"><td class="svelte-1w6q42o"><!></td><td class="svelte-1w6q42o"><!></td></tr>'),pv=b('<div class="empty-state svelte-1w6q42o">No assignees yet. Add one above.</div>'),hv=b('<div class="modal-overlay svelte-1w6q42o"><div class="modal-content svelte-1w6q42o"><div class="modal-header svelte-1w6q42o"><h3 class="svelte-1w6q42o">Assignee Library</h3> <button class="close-btn svelte-1w6q42o">&times;</button></div> <div class="modal-body svelte-1w6q42o"><div class="add-section svelte-1w6q42o"><input type="text" placeholder="New assignee name..." class="svelte-1w6q42o"/> <button class="btn-add svelte-1w6q42o">Add</button></div> <table class="assignees-table svelte-1w6q42o"><thead><tr><th class="svelte-1w6q42o">Name</th><th class="svelte-1w6q42o">Actions</th></tr></thead><tbody></tbody></table> <!></div></div></div>');function ki(t,e){ot(e,!0);let n=y(Ne([])),r=y(""),s=y(null),i=y("");async function c(){e.isOpen&&u(n,await En(),!0)}Ft(()=>{c()});async function d(){if(a(r).trim())try{await Oo({name:a(r).trim()}),u(r,""),await c()}catch(S){console.error(S),alert("Failed to add assignee")}}function v(S){u(s,S.id,!0),u(i,S.name,!0)}async function p(){if(!(!a(i).trim()||a(s)===null))try{await Io(a(s),a(i).trim()),u(s,null),u(i,""),await c()}catch(S){console.error(S),alert("Failed to update assignee")}}function f(){u(s,null),u(i,"")}async function _(S){if(confirm("Delete this assignee?"))try{await Lo(S),await c()}catch(w){console.error(w),alert("Failed to delete assignee")}}var h=lt(),m=je(h);{var x=S=>{var w=hv();w.__click=function(...J){e.close?.apply(this,J)};var k=l(w);k.__click=J=>J.stopPropagation();var z=l(k),E=o(l(z),2);E.__click=function(...J){e.close?.apply(this,J)};var P=o(z,2),M=l(P),D=l(M);D.__keydown=J=>J.key==="Enter"&&d();var H=o(D,2);H.__click=d;var Y=o(M,2),R=o(l(Y));Ae(R,21,()=>a(n),J=>J.id,(J,O)=>{var re=fv(),ie=l(re),de=l(ie);{var ve=$=>{var A=vv();js(A),A.__keydown=U=>{U.key==="Enter"&&p(),U.key==="Escape"&&f()},Ce(A,()=>a(i),U=>u(i,U)),g($,A)},le=$=>{var A=ii();G(()=>q(A,a(O).name)),g($,A)};L(de,$=>{a(s)===a(O).id?$(ve):$(le,!1)})}var _e=o(ie),ge=l(_e);{var Pe=$=>{var A=uv(),U=je(A);U.__click=p;var ne=o(U,2);ne.__click=f,g($,A)},ke=$=>{var A=dv(),U=je(A);U.__click=()=>v(a(O));var ne=o(U,2);ne.__click=()=>_(a(O).id),g($,A)};L(ge,$=>{a(s)===a(O).id?$(Pe):$(ke,!1)})}g(J,re)});var X=o(Y,2);{var Z=J=>{var O=pv();g(J,O)};L(X,J=>{a(n).length===0&&J(Z)})}Ce(D,()=>a(r),J=>u(r,J)),g(S,w)};L(m,S=>{e.isOpen&&S(x)})}g(t,h),ct()}gt(["click","keydown"]);var _v=b("<option> </option>"),gv=b('<div class="part-item svelte-1iwbfq1"><span class="part-name svelte-1iwbfq1"> </span> <span class="part-qty svelte-1iwbfq1"> </span></div>'),mv=b('<div class="form-group svelte-1iwbfq1"><label class="svelte-1iwbfq1">Associated Parts</label> <div class="parts-list svelte-1iwbfq1"></div></div>'),bv=b("<option> </option>"),yv=b('<div class="modal-overlay svelte-1iwbfq1"><div class="modal-content svelte-1iwbfq1"><div class="modal-header svelte-1iwbfq1"><h3 class="svelte-1iwbfq1"> </h3> <button class="close-btn svelte-1iwbfq1">&times;</button></div> <form class="modal-body svelte-1iwbfq1"><div class="form-group svelte-1iwbfq1"><label for="name" class="svelte-1iwbfq1">Task Name</label> <input id="name" type="text" placeholder="Enter task name..." required class="svelte-1iwbfq1"/></div> <div class="form-group svelte-1iwbfq1"><label for="material" class="svelte-1iwbfq1">Material</label> <div class="material-row svelte-1iwbfq1"><select id="material" class="material-select svelte-1iwbfq1"><option>-- No Material --</option><!></select> <button type="button" class="btn-library svelte-1iwbfq1" title="Edit Material Library">📚</button></div></div> <div class="form-group svelte-1iwbfq1"><label for="gnc_path" class="svelte-1iwbfq1">GNC File Path</label> <input id="gnc_path" type="text" placeholder="e.g. Z:\\Sidra\\Part1.gnc" class="svelte-1iwbfq1"/></div> <!> <div class="form-group svelte-1iwbfq1"><label for="assignee" class="svelte-1iwbfq1">Assignee</label> <div class="material-row svelte-1iwbfq1"><select id="assignee" class="material-select svelte-1iwbfq1"><option>-- No Assignee --</option><!></select> <button type="button" class="btn-library svelte-1iwbfq1" title="Edit Assignee Library">👥</button></div></div> <div class="actions svelte-1iwbfq1"><button type="button" class="btn-secondary svelte-1iwbfq1">Cancel</button> <button type="submit" class="btn-primary svelte-1iwbfq1"> </button></div></form></div></div>'),wv=b("<!> <!> <!>",1);function kv(t,e){ot(e,!0);let n=bt(e,"task",3,null),r=y(""),s=y(""),i=y(null),c=y(""),d=y(!1),v=y(Ne([])),p=y(Ne([])),f=y(!1),_=y(!1);async function h(){u(v,await Va(),!0)}async function m(){u(p,await En(),!0)}Ft(()=>{e.isOpen&&(console.log("TaskModal Opened. Task:",n()),n()?(u(r,n().name,!0),u(s,n().assignee||"",!0),u(i,n().material_id||(n().material?n().material.id:null),!0),u(c,n().gnc_file_path||"",!0)):(u(s,localStorage.getItem("task_assignee")||"",!0),u(r,""),u(i,null),u(c,"")),h(),m())});async function x(Y){if(Y.preventDefault(),!!a(r)){u(d,!0);try{a(s)&&!n()&&localStorage.setItem("task_assignee",a(s)),await e.onSubmit({id:n()?n().id:void 0,name:a(r),assignee:a(s),material_id:a(i),gnc_file_path:a(c)}),e.close()}catch(R){console.error(R),alert("Failed to add task")}finally{u(d,!1)}}}function S(){u(f,!0)}function w(){u(f,!1),h()}function k(){u(_,!0)}function z(){u(_,!1),m()}var E=wv(),P=je(E);{var M=Y=>{var R=yv();R.__click=function(...te){e.close?.apply(this,te)};var X=l(R);X.__click=te=>te.stopPropagation();var Z=l(X),J=l(Z),O=l(J),re=o(J,2);re.__click=function(...te){e.close?.apply(this,te)};var ie=o(Z,2),de=l(ie),ve=o(l(de),2);js(ve);var le=o(de,2),_e=o(l(le),2),ge=l(_e),Pe=l(ge);Pe.value=(Pe.__value=null)??"";var ke=o(Pe);Ae(ke,17,()=>a(v),Fe,(te,j)=>{var B=_v(),W=l(B),se={};G(()=>{q(W,a(j).name),se!==(se=a(j).id)&&(B.value=(B.__value=a(j).id)??"")}),g(te,B)});var $=o(ge,2);$.__click=S;var A=o(le,2),U=o(l(A),2),ne=o(A,2);{var ee=te=>{var j=mv(),B=o(l(j),2);Ae(B,21,()=>n().part_associations,Fe,(W,se)=>{var ce=gv(),ue=l(ce),C=l(ue),T=o(ue,2),Q=l(T);G(()=>{Qe(ue,"title",a(se).part.name),q(C,a(se).part.name),q(Q,`x${a(se).quantity??""}`)}),g(W,ce)}),g(te,j)};L(ne,te=>{n()&&n().part_associations&&n().part_associations.length>0&&te(ee)})}var oe=o(ne,2),qe=o(l(oe),2),ye=l(qe),Oe=l(ye);Oe.value=Oe.__value="";var fe=o(Oe);Ae(fe,17,()=>a(p),Fe,(te,j)=>{var B=bv(),W=l(B),se={};G(()=>{q(W,a(j).name),se!==(se=a(j).name)&&(B.value=(B.__value=a(j).name)??"")}),g(te,B)});var Se=o(ye,2);Se.__click=k;var pe=o(oe,2),I=l(pe);I.__click=function(...te){e.close?.apply(this,te)};var V=o(I,2),ae=l(V);G(()=>{q(O,n()?"Edit Task":"Add Task"),V.disabled=a(d),q(ae,a(d)?n()?"Saving...":"Adding...":n()?"Save Changes":"Add Task")}),ha("submit",ie,x),Ce(ve,()=>a(r),te=>u(r,te)),Et(ge,()=>a(i),te=>u(i,te)),Ce(U,()=>a(c),te=>u(c,te)),Et(ye,()=>a(s),te=>u(s,te)),g(Y,R)};L(P,Y=>{e.isOpen&&Y(M)})}var D=o(P,2);cv(D,{get isOpen(){return a(f)},close:w});var H=o(D,2);ki(H,{get isOpen(){return a(_)},close:z}),g(t,E),ct()}gt(["click"]);var xv=b('<div class="material-group-header svelte-ty272s"><span class="material-group-name svelte-ty272s"> </span> <span class="material-group-count svelte-ty272s"> </span></div>'),Sv=b("<option> </option>"),Tv=b('<span class="material-badge svelte-ty272s"> </span>'),qv=b('<div class="task-item svelte-ty272s"><div class="task-line-1 svelte-ty272s"><span> </span> <div class="task-right-group svelte-ty272s"><select><option>Planned</option><option>Pending</option><option>Done</option></select> <div class="task-actions svelte-ty272s"><button class="edit-btn svelte-ty272s" title="Edit">✎</button> <button class="delete-btn svelte-ty272s" title="Delete">×</button></div></div></div> <div class="task-line-2 svelte-ty272s"><div class="assignee-container svelte-ty272s"><select class="assignee-select svelte-ty272s"><option>Assignee</option><!></select> <button class="assignee-add-btn svelte-ty272s" title="Manage Assignees">+</button></div> <!></div></div>'),Ev=b("<!> <!>",1),jv=b('<div class="empty-tasks svelte-ty272s"> </div>'),Av=b('<div class="embedded-tasks svelte-ty272s"><div class="tasks-header svelte-ty272s"><h4 class="svelte-ty272s">Tasks</h4> <div class="header-actions svelte-ty272s"><button class="group-toggle-btn svelte-ty272s"> </button> <select class="filter-select svelte-ty272s"><option>Hide Done</option><option>Show All</option><option>Pending</option></select> <button class="add-task-btn svelte-ty272s">+ Add</button></div></div> <div class="tasks-list svelte-ty272s"><!> <!></div></div> <!> <!>',1);function Pv(t,e){ot(e,!0);let n=bt(e,"filterAssignee",3,""),r=bt(e,"partSearch",3,""),s=y(Ne(e.document.tasks||[]));Ft(()=>{u(s,e.document.tasks||[],!0)});let i=y("hide_done"),c=y(!1),d=y(null),v=y(!0),p=y(Ne([])),f=y(!1);Jt(async()=>{u(p,await En(),!0)});async function _(){u(p,await En(),!0)}let h=Ze(()=>[...a(s)].sort((A,U)=>A.status==="done"&&U.status!=="done"?1:A.status!=="done"&&U.status==="done"?-1:0)),m=Ze(()=>a(h).filter(A=>{if(a(i)==="hide_done"&&A.status==="done"||a(i)==="pending"&&A.status!=="pending")return!1;if(a(i)==="all"){if(n()&&n().trim()){const U=(A.assignee||"").toLowerCase(),ne=n().toLowerCase();return U.includes(ne)}return!0}if(n()&&n().trim()){const U=(A.assignee||"").toLowerCase(),ne=n().toLowerCase();if(!U.includes(ne))return!1}if(r()&&r().trim()){if(!A.part_associations||A.part_associations.length===0)return!1;const U=r().toLowerCase();if(!A.part_associations.some(ee=>{const oe=ee.part;return oe?oe.name&&oe.name.toLowerCase().includes(U)||oe.registration_number&&oe.registration_number.toLowerCase().includes(U):!1}))return!1}return!0})),x=Ze(()=>()=>{if(!a(v))return{"All Tasks":a(m)};const A={};a(m).forEach(ee=>{const oe=ee.material?ee.material.name:"(No Material)";A[oe]||(A[oe]=[]),A[oe].push(ee)});const U={};return Object.keys(A).sort((ee,oe)=>ee==="(No Material)"?1:oe==="(No Material)"?-1:ee.localeCompare(oe)).forEach(ee=>{U[ee]=A[ee]}),U});async function S(A,U){try{A.status=U,await Ln(A.id,{status:U}),e.refresh()}catch(ne){console.error(ne)}}async function w(A,U){try{await Ln(A.id,{assignee:U})}catch(ne){console.error(ne)}}async function k(A){if(confirm("Delete task?"))try{await ko(A),u(s,a(s).filter(U=>U.id!==A),!0),e.refresh()}catch(U){console.error(U)}}async function z(A){try{if(A.id){const U=await Ln(A.id,{name:A.name,assignee:A.assignee,material_id:A.material_id,gnc_file_path:A.gnc_file_path});u(s,a(s).map(ne=>ne.id===A.id?{...ne,...U}:ne),!0),e.refresh()}else{const U=await yo(e.document.id,{name:A.name,assignee:A.assignee,status:"planned",material_id:A.material_id,gnc_file_path:A.gnc_file_path});u(s,[...a(s),U],!0),e.refresh()}}catch(U){throw console.error(U),U}}function E(){u(f,!0)}function P(){u(f,!1),_()}function M(){console.log("Opening Add Modal"),u(d,null),u(c,!0)}function D(A){console.log("Opening Edit Modal for:",A),u(d,A,!0),u(c,!0)}var H=Av(),Y=je(H),R=l(Y),X=o(l(R),2),Z=l(X);Z.__click=()=>u(v,!a(v));var J=l(Z),O=o(Z,2),re=l(O);re.value=re.__value="hide_done";var ie=o(re);ie.value=ie.__value="all";var de=o(ie);de.value=de.__value="pending";var ve=o(O,2);ve.__click=M;var le=o(R,2),_e=l(le);Ae(_e,17,()=>Object.entries(a(x)()),([A,U])=>A,(A,U)=>{var ne=Ze(()=>xn(a(U),2));let ee=()=>a(ne)[0],oe=()=>a(ne)[1];var qe=Ev(),ye=je(qe);{var Oe=Se=>{var pe=xv(),I=l(pe),V=l(I),ae=o(I,2),te=l(ae);G(()=>{q(V,ee()),q(te,`(${oe().length??""})`)}),g(Se,pe)};L(ye,Se=>{a(v)&&Object.keys(a(x)()).length>1&&Se(Oe)})}var fe=o(ye,2);Ae(fe,17,oe,Se=>Se.id,(Se,pe)=>{var I=qv(),V=l(I),ae=l(V),te=l(ae),j=o(ae,2),B=l(j);B.__change=F=>S(a(pe),F.currentTarget.value);var W=l(B);W.value=W.__value="planned";var se=o(W);se.value=se.__value="pending";var ce=o(se);ce.value=ce.__value="done";var ue;qn(B);var C=o(B,2),T=l(C);T.__click=()=>D(a(pe));var Q=o(T,2);Q.__click=()=>k(a(pe).id);var me=o(V,2),Me=l(me),Be=l(Me);Be.__change=F=>w(a(pe),F.currentTarget.value);var Ge=l(Be);Ge.value=Ge.__value="";var et=o(Ge);Ae(et,17,()=>a(p),Fe,(F,be)=>{var Ie=Sv(),tt=l(Ie),at={};G(()=>{q(tt,a(be).name),at!==(at=a(be).name)&&(Ie.value=(Ie.__value=a(be).name)??"")}),g(F,Ie)});var xe;qn(Be);var Le=o(Be,2);Le.__click=E;var he=o(Me,2);{var Ye=F=>{var be=Tv(),Ie=l(be);G(()=>{Qe(be,"title",`Material: ${a(pe).material.name??""}`),q(Ie,`📦 ${a(pe).material.name??""}`)}),g(F,be)};L(he,F=>{a(pe).material&&F(Ye)})}G(()=>{$e(ae,1,`task-name ${a(pe).status==="done"?"done-text":""}`,"svelte-ty272s"),Qe(ae,"title",a(pe).name),q(te,a(pe).name),$e(B,1,`status-select ${a(pe).status??""}`,"svelte-ty272s"),ue!==(ue=a(pe).status)&&(B.value=(B.__value=a(pe).status)??"",vn(B,a(pe).status)),xe!==(xe=a(pe).assignee||"")&&(Be.value=(Be.__value=a(pe).assignee||"")??"",vn(Be,a(pe).assignee||""))}),g(Se,I)}),g(A,qe)});var ge=o(_e,2);{var Pe=A=>{var U=jv(),ne=l(U);G(()=>q(ne,a(s).length>0?"No tasks match filter.":"No tasks yet.")),g(A,U)};L(ge,A=>{a(m).length===0&&A(Pe)})}var ke=o(Y,2);kv(ke,{get isOpen(){return a(c)},close:()=>u(c,!1),onSubmit:z,get task(){return a(d)}});var $=o(ke,2);ki($,{get isOpen(){return a(f)},close:P}),G(()=>{Qe(Z,"title",a(v)?"Show flat list":"Group by material"),q(J,a(v)?"📦":"📋")}),Et(O,()=>a(i),A=>u(i,A)),g(t,H),ct()}gt(["click","change"]);var Cv=b('<p class="upload-status svelte-1yijx0t">Uploading...</p>'),Rv=b('<div class="attachment-item svelte-1yijx0t"><span class="attachment-name svelte-1yijx0t"> </span> <button type="button" class="remove-btn svelte-1yijx0t">×</button></div>'),zv=b('<div class="attachments-list svelte-1yijx0t"></div>'),Mv=b('<div class="modal-overlay svelte-1yijx0t"><div class="modal-content svelte-1yijx0t"><div class="modal-header svelte-1yijx0t"><h3 class="svelte-1yijx0t"> </h3> <button class="close-btn svelte-1yijx0t">&times;</button></div> <form class="modal-body svelte-1yijx0t"><div class="form-group svelte-1yijx0t"><label for="author" class="svelte-1yijx0t">Author</label> <input id="author" type="text" placeholder="Your Name" class="svelte-1yijx0t"/></div> <div class="form-group svelte-1yijx0t"><label for="type" class="svelte-1yijx0t">Type</label> <select id="type" class="svelte-1yijx0t"><option>Info</option><option>Warning</option><option>Error</option></select></div> <div class="form-group svelte-1yijx0t"><label for="text" class="svelte-1yijx0t">Message</label> <textarea id="text" required rows="4" class="svelte-1yijx0t"></textarea></div> <div class="form-group svelte-1yijx0t"><label for="attachments" class="svelte-1yijx0t">Attachments</label> <div class="file-upload-wrapper svelte-1yijx0t"><input id="attachments" type="file" multiple class="svelte-1yijx0t"/> <!></div> <!></div> <div class="actions svelte-1yijx0t"><button type="button" class="btn-secondary svelte-1yijx0t">Cancel</button> <button type="submit" class="btn-primary svelte-1yijx0t"> </button></div></form></div></div>');function xi(t,e){ot(e,!0);let n=bt(e,"entry",3,null),r=y(""),s=y("info"),i=y(""),c=y(!1),d=y(Ne([])),v=y(!1);Ft(()=>{e.isOpen&&(n()?(u(r,n().text||"",!0),u(s,n().type||"info",!0),u(i,n().author||"",!0),u(d,n().attachments||[],!0)):(u(i,localStorage.getItem("journal_author")||"",!0),u(r,""),u(s,"info"),u(d,[],!0)))});async function p(S){const w=Array.from(S.target.files);if(w.length!==0){u(v,!0);try{for(const k of w){const z=await Ds(k);a(d).push({file_path:z.file_path,filename:z.filename,media_type:z.media_type})}}catch(k){console.error("Upload failed",k),alert("Failed to upload attachment")}finally{u(v,!1),S.target.value=""}}}function f(S){a(d).splice(S,1)}async function _(S){S.preventDefault(),u(c,!0),a(i)&&localStorage.setItem("journal_author",a(i));try{const w={text:a(r),type:a(s),status:n()?.status||"pending",author:a(i),document_id:e.documentId,attachments:a(d)};n()?await Os(n().id,w):await oi(w),window.dispatchEvent(new CustomEvent("journal-entries-updated")),e.close()}catch(w){console.error(w),alert(n()?"Failed to update note":"Failed to create note")}finally{u(c,!1)}}var h=lt(),m=je(h);{var x=S=>{var w=Mv();w.__click=function(...ee){e.close?.apply(this,ee)};var k=l(w);k.__click=ee=>ee.stopPropagation();var z=l(k),E=l(z),P=l(E),M=o(E,2);M.__click=function(...ee){e.close?.apply(this,ee)};var D=o(z,2),H=l(D),Y=o(l(H),2),R=o(H,2),X=o(l(R),2),Z=l(X);Z.value=Z.__value="info";var J=o(Z);J.value=J.__value="warning";var O=o(J);O.value=O.__value="error";var re=o(R,2),ie=o(l(re),2),de=o(re,2),ve=o(l(de),2),le=l(ve);le.__change=p;var _e=o(le,2);{var ge=ee=>{var oe=Cv();g(ee,oe)};L(_e,ee=>{a(v)&&ee(ge)})}var Pe=o(ve,2);{var ke=ee=>{var oe=zv();Ae(oe,21,()=>a(d),Fe,(qe,ye,Oe)=>{var fe=Rv(),Se=l(fe),pe=l(Se),I=o(Se,2);I.__click=()=>f(Oe),G(()=>q(pe,a(ye).filename)),g(qe,fe)}),g(ee,oe)};L(Pe,ee=>{a(d).length>0&&ee(ke)})}var $=o(de,2),A=l($);A.__click=function(...ee){e.close?.apply(this,ee)};var U=o(A,2),ne=l(U);G(()=>{q(P,n()?"Edit Note":`Add Note to ${e.documentName}`),le.disabled=a(v),U.disabled=a(c),q(ne,a(c)?"Saving...":n()?"Update Note":"Add Note")}),ha("submit",D,_),Ce(Y,()=>a(i),ee=>u(i,ee)),Et(X,()=>a(s),ee=>u(s,ee)),Ce(ie,()=>a(r),ee=>u(r,ee)),g(S,w)};L(m,S=>{e.isOpen&&S(x)})}g(t,h),ct()}gt(["click","change"]);var Nv=b('<img class="svelte-jm2ier"/>'),Dv=b('<div class="file-placeholder svelte-jm2ier"><span> </span> <a target="_blank" rel="noreferrer">Download</a></div>'),Ov=b('<div class="image-wrapper svelte-jm2ier"><!></div>'),Iv=b('<div class="modal-overlay svelte-jm2ier"><div class="modal-content svelte-jm2ier"><button class="close-btn svelte-jm2ier">&times;</button> <div class="gallery svelte-jm2ier"></div></div></div>');function Si(t,e){var n=lt(),r=je(n);{var s=i=>{var c=Iv();c.__click=function(...f){e.close?.apply(this,f)};var d=l(c);d.__click=f=>f.stopPropagation();var v=l(d);v.__click=function(...f){e.close?.apply(this,f)};var p=o(v,2);Ae(p,21,()=>e.attachments,Fe,(f,_)=>{var h=Ov(),m=l(h);{var x=w=>{var k=Nv();G(()=>{Qe(k,"src",a(_).file_path),Qe(k,"alt",a(_).filename)}),g(w,k)},S=w=>{var k=Dv(),z=l(k),E=l(z),P=o(z,2);G(()=>{q(E,`📄 ${a(_).filename??""}`),Qe(P,"href",a(_).file_path)}),g(w,k)};L(m,w=>{a(_).media_type&&a(_).media_type.startsWith("image/")?w(x):w(S,!1)})}g(f,h)}),g(i,c)};L(r,i=>{e.isOpen&&i(s)})}g(t,n)}gt(["click"]);var Lv=b("<option> </option>"),$v=b("<option> </option>"),Fv=b('<div class="modal-overlay svelte-12q38jy"><div class="modal-content svelte-12q38jy"><div class="modal-header svelte-12q38jy"><h3 class="svelte-12q38jy">🔍 Filter Documents</h3> <button class="close-btn svelte-12q38jy">&times;</button></div> <div class="modal-body svelte-12q38jy"><div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Document Type</h4> <select class="filter-input svelte-12q38jy"><option>All Types</option><option>Plan</option><option>Mail</option><option>Other</option></select></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Status</h4> <select class="filter-input svelte-12q38jy"><option>All Statuses</option><option>In Progress</option><option>Done</option></select></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Tag</h4> <input type="text" placeholder="Filter by tag..." class="filter-input svelte-12q38jy"/></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Part Number / Name</h4> <input type="text" placeholder="Search for parts..." class="filter-input svelte-12q38jy"/></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Assignee</h4> <select class="filter-input svelte-12q38jy"><option>All Assignees</option><!></select></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Material</h4> <select class="filter-input svelte-12q38jy"><option>All Materials</option><!></select></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Task Types (Show documents with these task types)</h4> <div class="checkbox-group svelte-12q38jy"><label class="checkbox-label svelte-12q38jy"><input type="checkbox" class="svelte-12q38jy"/> <span class="checkbox-text svelte-12q38jy">Planned</span></label> <label class="checkbox-label svelte-12q38jy"><input type="checkbox" class="svelte-12q38jy"/> <span class="checkbox-text svelte-12q38jy">Pending</span></label> <label class="checkbox-label svelte-12q38jy"><input type="checkbox" class="svelte-12q38jy"/> <span class="checkbox-text svelte-12q38jy">Done</span></label></div></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Date Range</h4> <select class="filter-input svelte-12q38jy"><option>Registration Date</option><option>Done Date</option></select> <div class="date-range svelte-12q38jy"><input type="date" class="filter-input svelte-12q38jy" placeholder="Start Date"/> <span class="date-separator svelte-12q38jy">to</span> <input type="date" class="filter-input svelte-12q38jy" placeholder="End Date"/></div></div> <div class="filter-section svelte-12q38jy"><h4 class="svelte-12q38jy">Sort By</h4> <div class="sort-controls svelte-12q38jy"><select class="filter-input svelte-12q38jy"><option>Date</option><option>Name</option><option>Author</option><option>Status</option><option>Done Date</option></select> <button class="sort-order-btn svelte-12q38jy" title="Toggle sort order"> </button></div></div></div> <div class="modal-footer svelte-12q38jy"><button class="btn-secondary svelte-12q38jy">Reset All</button> <button class="btn-primary svelte-12q38jy">Apply Filters</button></div></div></div>');function Bv(t,e){ot(e,!0);let n=y(Ne({filterType:"",filterStatus:"",filterTag:"",filterAssignee:"",partSearch:"",filterMaterial:"",filterTaskTypes:[],startDate:"",endDate:"",dateField:"registration_date",sortBy:"registration_date",sortOrder:"desc"})),r=y(Ne([])),s=y(Ne([])),i=!1;Ft(()=>{e.isOpen&&!i&&(e.filters&&(u(n,{...e.filters},!0),Array.isArray(a(n).filterTaskTypes)||(a(n).filterTaskTypes=[])),c(),d()),i=e.isOpen});async function c(){try{u(r,await Va(),!0)}catch(x){console.error("Failed to load materials",x)}}async function d(){try{u(s,await En(),!0)}catch(x){console.error("Failed to load assignees",x)}}function v(){e.onApply(a(n)),e.close()}function p(){u(n,{filterType:"",filterStatus:"",filterTag:"",filterAssignee:"",partSearch:"",filterMaterial:"",filterTaskTypes:[],startDate:"",endDate:"",dateField:"registration_date",sortBy:"registration_date",sortOrder:"desc"},!0)}function f(x){a(n).filterTaskTypes.includes(x)?a(n).filterTaskTypes=a(n).filterTaskTypes.filter(S=>S!==x):a(n).filterTaskTypes=[...a(n).filterTaskTypes,x]}var _=lt(),h=je(_);{var m=x=>{var S=Fv();S.__click=function(...he){e.close?.apply(this,he)};var w=l(S);w.__click=he=>he.stopPropagation();var k=l(w),z=o(l(k),2);z.__click=function(...he){e.close?.apply(this,he)};var E=o(k,2),P=l(E),M=o(l(P),2),D=l(M);D.value=D.__value="";var H=o(D);H.value=H.__value="plan";var Y=o(H);Y.value=Y.__value="mail";var R=o(Y);R.value=R.__value="other";var X=o(P,2),Z=o(l(X),2),J=l(Z);J.value=J.__value="";var O=o(J);O.value=O.__value="in_progress";var re=o(O);re.value=re.__value="done";var ie=o(X,2),de=o(l(ie),2),ve=o(ie,2),le=o(l(ve),2),_e=o(ve,2),ge=o(l(_e),2),Pe=l(ge);Pe.value=Pe.__value="";var ke=o(Pe);Ae(ke,17,()=>a(s),Fe,(he,Ye)=>{var F=Lv(),be=l(F),Ie={};G(()=>{q(be,a(Ye).name),Ie!==(Ie=a(Ye).name)&&(F.value=(F.__value=a(Ye).name)??"")}),g(he,F)});var $=o(_e,2),A=o(l($),2),U=l(A);U.value=U.__value="";var ne=o(U);Ae(ne,17,()=>a(r),Fe,(he,Ye)=>{var F=$v(),be=l(F),Ie={};G(()=>{q(be,a(Ye).name),Ie!==(Ie=a(Ye).id)&&(F.value=(F.__value=a(Ye).id)??"")}),g(he,F)});var ee=o($,2),oe=o(l(ee),2),qe=l(oe),ye=l(qe);ye.__change=()=>f("planned");var Oe=o(qe,2),fe=l(Oe);fe.__change=()=>f("pending");var Se=o(Oe,2),pe=l(Se);pe.__change=()=>f("done");var I=o(ee,2),V=o(l(I),2),ae=l(V);ae.value=ae.__value="registration_date";var te=o(ae);te.value=te.__value="done_date";var j=o(V,2),B=l(j),W=o(B,4),se=o(I,2),ce=o(l(se),2),ue=l(ce),C=l(ue);C.value=C.__value="registration_date";var T=o(C);T.value=T.__value="name";var Q=o(T);Q.value=Q.__value="author";var me=o(Q);me.value=me.__value="status";var Me=o(me);Me.value=Me.__value="done_date";var Be=o(ue,2);Be.__click=()=>a(n).sortOrder=a(n).sortOrder==="desc"?"asc":"desc";var Ge=l(Be),et=o(E,2),xe=l(et);xe.__click=p;var Le=o(xe,2);Le.__click=v,G((he,Ye,F)=>{ns(ye,he),ns(fe,Ye),ns(pe,F),q(Ge,a(n).sortOrder==="desc"?"↓ Desc":"↑ Asc")},[()=>a(n).filterTaskTypes.includes("planned"),()=>a(n).filterTaskTypes.includes("pending"),()=>a(n).filterTaskTypes.includes("done")]),Et(M,()=>a(n).filterType,he=>a(n).filterType=he),Et(Z,()=>a(n).filterStatus,he=>a(n).filterStatus=he),Ce(de,()=>a(n).filterTag,he=>a(n).filterTag=he),Ce(le,()=>a(n).partSearch,he=>a(n).partSearch=he),Et(ge,()=>a(n).filterAssignee,he=>a(n).filterAssignee=he),Et(A,()=>a(n).filterMaterial,he=>a(n).filterMaterial=he),Et(V,()=>a(n).dateField,he=>a(n).dateField=he),Ce(B,()=>a(n).startDate,he=>a(n).startDate=he),Ce(W,()=>a(n).endDate,he=>a(n).endDate=he),Et(ue,()=>a(n).sortBy,he=>a(n).sortBy=he),g(x,S)};L(h,x=>{e.isOpen&&x(m)})}g(t,_),ct()}gt(["click","change"]);var Uv=b('<span class="tag-chip svelte-1qsxu3n"> <button type="button" class="svelte-1qsxu3n">&times;</button></span>'),Gv=b('<li class="svelte-1qsxu3n"> </li>'),Yv=b('<ul class="suggestions svelte-1qsxu3n"></ul>'),Xv=b('<div class="tag-input-container svelte-1qsxu3n"><!> <div class="input-wrapper svelte-1qsxu3n"><input type="text" class="svelte-1qsxu3n"/> <!></div></div>');function Jv(t,e){ot(e,!0);let n=bt(e,"selectedTags",31,()=>Ne([])),r=bt(e,"placeholder",3,"Add tag..."),s=y(""),i=y(Ne([])),c=y(Ne([])),d=y(!1),v;Jt(async()=>{try{u(i,await co(),!0)}catch(E){console.error("Failed to fetch tags",E)}});function p(E){if(u(s,E.target.value,!0),a(s).includes(",")){const P=a(s).split(",");for(let M of P)M=M.trim(),M&&(n().includes(M)||n([...n(),M]));u(s,""),u(d,!1);return}a(s)?(u(c,a(i).filter(P=>P.name.toLowerCase().includes(a(s).toLowerCase())&&!n().includes(P.name)),!0),u(d,!0)):u(d,!1)}function f(E){E&&!n().includes(E)&&n([...n(),E]),u(s,""),u(d,!1),v.focus()}function _(E){n(n().filter(P=>P!==E))}function h(E){E.key==="Enter"?(E.preventDefault(),a(s).trim()&&f(a(s).trim())):E.key==="Backspace"&&!a(s)&&n().length>0&&_(n()[n().length-1])}var m=Xv(),x=l(m);Ae(x,17,n,Fe,(E,P)=>{var M=Uv(),D=l(M),H=o(D);H.__click=()=>_(a(P)),G(()=>q(D,`${a(P)??""} `)),g(E,M)});var S=o(x,2),w=l(S);w.__input=p,w.__keydown=h,Ns(w,E=>v=E,()=>v);var k=o(w,2);{var z=E=>{var P=Yv();Ae(P,21,()=>a(c),Fe,(M,D)=>{var H=Gv();H.__click=()=>f(a(D).name);var Y=l(H);G(()=>q(Y,a(D).name)),g(M,H)}),g(E,P)};L(k,E=>{a(d)&&a(c).length>0&&E(z)})}G(()=>Qe(w,"placeholder",r())),ha("blur",w,()=>setTimeout(()=>u(d,!1),200)),ha("focus",w,()=>a(s)&&u(d,!0)),Ce(w,()=>a(s),E=>u(s,E)),g(t,m),ct()}gt(["click","input","keydown"]);var Wv=b('<span class="filter-badge svelte-s90sg6">●</span>'),Hv=b('<div class="card-desc svelte-s90sg6"> </div>'),Zv=b('<span class="tag-badge svelte-s90sg6"> </span>'),Vv=b('<button class="icon-badge attachment-badge svelte-s90sg6" title="View Attachments"> </button>'),Qv=b('<span class="icon-badge task-planned svelte-s90sg6" title="Planned Tasks"> </span>'),Kv=b('<span class="icon-badge task-pending svelte-s90sg6" title="Pending Tasks"> </span>'),eu=b('<span class="icon-badge task-done svelte-s90sg6" title="Completed Tasks"> </span>'),tu=b("<!> <!> <!>",1),au=b('<span class="icon-badge journal-info svelte-s90sg6" title="Info Notes"> </span>'),nu=b('<span class="icon-badge journal-warning svelte-s90sg6" title="Warnings"> </span>'),su=b('<span class="icon-badge journal-error svelte-s90sg6" title="Errors"> </span>'),ru=b("<!> <!> <!>",1),iu=b('<div class="badges-tags-row svelte-s90sg6"><!> <!> <!> <!></div>'),lu=b('<div class="meta-item svelte-s90sg6"><span class="label svelte-s90sg6">Done:</span> <span class="value"> </span></div>'),ou=b('<button class="note-attachment-btn svelte-s90sg6"> </button>'),cu=b('<div><div class="note-header svelte-s90sg6"><span> </span> <span class="note-author svelte-s90sg6"> </span> <span class="note-date svelte-s90sg6"> </span> <!> <button class="note-edit-btn svelte-s90sg6" title="Edit note">✏️</button> <button> </button></div> <p class="note-text svelte-s90sg6"> </p></div>'),vu=b('<div class="embedded-notes svelte-s90sg6"><h4 class="svelte-s90sg6">Notes</h4> <div class="notes-list svelte-s90sg6"></div></div>'),uu=b('<button class="action-btn primary-btn svelte-s90sg6" title="Register Document"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Register</button>'),du=b('<button class="action-btn primary-btn svelte-s90sg6" title="View Content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> View</button>'),fu=b('<button class="dropdown-item svelte-s90sg6">📦 Download Zip</button> <button class="dropdown-item svelte-s90sg6">⚙️ Edit in GNC Editor</button>',1),pu=b('<div class="dropdown-menu svelte-s90sg6"><button class="dropdown-item svelte-s90sg6">📝 Add Note</button> <button class="dropdown-item svelte-s90sg6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Edit</button> <!> <button class="dropdown-item delete-item svelte-s90sg6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> Delete</button></div>'),hu=b('<div class="card svelte-s90sg6"><div class="card-header svelte-s90sg6"><div class="title-group svelte-s90sg6"><h3 class="svelte-s90sg6"> </h3> <span class="badge badge-type svelte-s90sg6"> </span></div> <select><option>Unregistered</option><option>In Progress</option><option>Done</option></select></div> <!> <!> <div class="card-meta svelte-s90sg6"><div class="meta-item svelte-s90sg6"><span class="label svelte-s90sg6">Author:</span> <span class="value"> </span></div> <div class="meta-item svelte-s90sg6"><span class="label svelte-s90sg6">Date:</span> <span class="value"> </span></div> <!></div> <!> <!> <div class="card-actions svelte-s90sg6"><!> <div class="dropdown-container svelte-s90sg6"><button class="action-btn dropdown-btn svelte-s90sg6" title="More actions"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg></button> <!></div></div></div>'),_u=b('<div class="empty-state svelte-s90sg6"><p>No documents found.</p></div>'),gu=b('<div class="list-container svelte-s90sg6"><div class="filters-bar svelte-s90sg6"><div class="main-filters svelte-s90sg6"><div class="search-box svelte-s90sg6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon svelte-s90sg6"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> <input type="text" placeholder="Search documents..." class="svelte-s90sg6"/></div> <button class="filter-btn svelte-s90sg6" title="Filter &amp; Sort"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg> Filters <!></button></div></div> <div class="cards-wrapper svelte-s90sg6"><!> <!></div> <!> <!> <!> <!></div>');function mu(t,e){ot(e,!0);let n=y(Ne([])),r=y(""),s=y(""),i=y(""),c=y(""),d=y(""),v=y(""),p=y(""),f=y(Ne([])),_=y(""),h=y(""),m=y("registration_date"),x=y(Ne([])),S=y(null),w=y(null),k=y(null),z=y(null),E=y(!1),P=y("registration_date"),M=y("desc"),D=y(null);async function H(){let C=await li(a(r),a(i),a(c),a(P),a(M),a(d),a(_),a(h),a(m),a(v),a(s));a(f)&&a(f).length>0&&(C=C.filter(T=>!T.tasks||T.tasks.length===0?!1:T.tasks.some(Q=>a(f).includes(Q.status)))),a(p)&&(C=C.filter(T=>!T.tasks||T.tasks.length===0?!1:T.tasks.some(Q=>Q.material_id&&Q.material_id.toString()===a(p).toString()))),u(n,C,!0)}async function Y(){u(x,await So(),!0)}Jt(()=>{const C=new URLSearchParams(window.location.search);C.has("part_search")&&u(s,C.get("part_search"),!0),H(),Y()});async function R(C,T){await fo(C.id,T),H()}async function X(C){confirm("Are you sure you want to delete this document?")&&(await _o(C),H())}function Z(){H()}function J(C){u(S,C,!0)}function O(){u(S,null)}function re(C){u(w,C,!0),u(k,null)}function ie(C,T){u(w,C,!0),u(k,T,!0)}function de(){u(w,null),u(k,null),H()}async function ve(C,T){const Q=T==="pending"?"done":"pending";try{await Os(C,{status:Q}),H(),window.dispatchEvent(new CustomEvent("journal-entries-updated"))}catch(me){console.error("Failed to update note status",me)}}function le(C){u(z,C,!0)}function _e(){u(z,null)}function ge(C){if(!C)return null;const T={planned:0,pending:0,done:0};return C.forEach(Q=>{T[Q.status]!==void 0&&T[Q.status]++}),T}function Pe(C){if(!C)return null;const T={info:0,warning:0,error:0};return C.forEach(Q=>{T[Q.type]!==void 0&&T[Q.type]++}),T}function ke(){u(E,!0)}function $(){u(E,!1)}function A(C){u(i,C.filterType,!0),u(c,C.filterStatus,!0),u(d,C.filterTag,!0),u(v,C.filterAssignee,!0),u(s,C.partSearch||"",!0),u(p,C.filterMaterial||"",!0),u(f,C.filterTaskTypes||[],!0),u(_,C.startDate,!0),u(h,C.endDate,!0),u(m,C.dateField,!0),u(P,C.sortBy,!0),u(M,C.sortOrder,!0),H()}function U(C){u(D,a(D)===C?null:C,!0)}function ne(){u(D,null)}async function ee(C){try{await ho(C.id,C.name)}catch(T){console.error(T),alert("Failed to download zip. Ensure the source folder exists on the server.")}}var oe={refresh:H},qe=gu(),ye=l(qe),Oe=l(ye),fe=l(Oe),Se=o(l(fe),2);Se.__input=Z;var pe=o(fe,2);pe.__click=ke;var I=o(l(pe),2);{var V=C=>{var T=Wv();g(C,T)};L(I,C=>{(a(i)||a(c)||a(d)||a(v)||a(_)||a(h)||a(f)&&a(f).length>0)&&C(V)})}var ae=o(ye,2),te=l(ae);Ae(te,17,()=>a(n),C=>C.id,(C,T)=>{const Q=Ze(()=>ge(a(T).tasks)),me=Ze(()=>Pe(a(T).journal_entries));var Me=hu(),Be=l(Me),Ge=l(Be),et=l(Ge),xe=l(et),Le=o(et,2),he=l(Le),Ye=o(Ge,2);Ye.__change=Ee=>R(a(T),Ee.currentTarget.value);var F=l(Ye);F.value=F.__value="unregistered";var be=o(F);be.value=be.__value="in_progress";var Ie=o(be);Ie.value=Ie.__value="done";var tt;qn(Ye);var at=o(Be,2);{var yt=Ee=>{var He=Hv(),rt=l(He);G(()=>q(rt,a(T).description)),g(Ee,He)};L(at,Ee=>{a(T).description&&Ee(yt)})}var wt=o(at,2);{var Bt=Ee=>{var He=iu(),rt=l(He);{var qt=De=>{var Je=lt(),pt=je(Je);Ae(pt,17,()=>a(T).tags,Fe,(ht,St)=>{var Nt=Zv(),Yt=l(Nt);G(()=>q(Yt,`#${a(St).name??""}`)),g(ht,Nt)}),g(De,Je)};L(rt,De=>{a(T).tags&&a(T).tags.length>0&&De(qt)})}var Xe=o(rt,2);{var mt=De=>{var Je=Vv();Je.__click=()=>le(a(T).attachments);var pt=l(Je);G(()=>q(pt,`📷 ${a(T).attachments.length??""}`)),g(De,Je)};L(Xe,De=>{a(T).attachments&&a(T).attachments.length>0&&De(mt)})}var vt=o(Xe,2);{var Ct=De=>{var Je=tu(),pt=je(Je);{var ht=it=>{var ft=Qv(),It=l(ft);G(()=>q(It,`📅 ${a(Q).planned??""}`)),g(it,ft)};L(pt,it=>{a(Q).planned>0&&it(ht)})}var St=o(pt,2);{var Nt=it=>{var ft=Kv(),It=l(ft);G(()=>q(It,`⏳ ${a(Q).pending??""}`)),g(it,ft)};L(St,it=>{a(Q).pending>0&&it(Nt)})}var Yt=o(St,2);{var ca=it=>{var ft=eu(),It=l(ft);G(()=>q(It,`✅ ${a(Q).done??""}`)),g(it,ft)};L(Yt,it=>{a(Q).done>0&&it(ca)})}g(De,Je)};L(vt,De=>{a(Q)&&De(Ct)})}var Ot=o(vt,2);{var Gt=De=>{var Je=ru(),pt=je(Je);{var ht=it=>{var ft=au(),It=l(ft);G(()=>q(It,`ℹ️ ${a(me).info??""}`)),g(it,ft)};L(pt,it=>{a(me).info>0&&it(ht)})}var St=o(pt,2);{var Nt=it=>{var ft=nu(),It=l(ft);G(()=>q(It,`⚠️ ${a(me).warning??""}`)),g(it,ft)};L(St,it=>{a(me).warning>0&&it(Nt)})}var Yt=o(St,2);{var ca=it=>{var ft=su(),It=l(ft);G(()=>q(It,`❌ ${a(me).error??""}`)),g(it,ft)};L(Yt,it=>{a(me).error>0&&it(ca)})}g(De,Je)};L(Ot,De=>{a(me)&&De(Gt)})}g(Ee,He)};L(wt,Ee=>{(a(T).tags&&a(T).tags.length>0||a(T).attachments&&a(T).attachments.length>0||a(Q)||a(me))&&Ee(Bt)})}var Rt=o(wt,2),N=l(Rt),K=o(l(N),2),we=l(K),Ue=o(N,2),zt=o(l(Ue),2),Ve=l(zt),Te=o(Ue,2);{var dt=Ee=>{var He=lu(),rt=o(l(He),2),qt=l(rt);G(()=>q(qt,a(T).done_date)),g(Ee,He)};L(Te,Ee=>{a(T).done_date&&Ee(dt)})}var jt=o(Rt,2);Pv(jt,{get document(){return a(T)},refresh:H,get filterAssignee(){return a(v)},get partSearch(){return a(s)}});var At=o(jt,2);{var Pt=Ee=>{var He=vu(),rt=o(l(He),2);Ae(rt,21,()=>a(T).journal_entries,Fe,(qt,Xe)=>{var mt=cu(),vt=l(mt),Ct=l(vt),Ot=l(Ct),Gt=o(Ct,2),De=l(Gt),Je=o(Gt,2),pt=l(Je),ht=o(Je,2);{var St=It=>{var La=ou();La.__click=()=>le(a(Xe).attachments);var Kn=l(La);G(()=>{Qe(La,"title",`View attachments (${a(Xe).attachments.length??""})`),q(Kn,`📎 ${a(Xe).attachments.length??""}`)}),g(It,La)};L(ht,It=>{a(Xe).attachments&&a(Xe).attachments.length>0&&It(St)})}var Nt=o(ht,2);Nt.__click=()=>ie(a(T),a(Xe));var Yt=o(Nt,2);Yt.__click=()=>ve(a(Xe).id,a(Xe).status);var ca=l(Yt),it=o(vt,2),ft=l(it);G(()=>{$e(mt,1,`note-item ${a(Xe).type??""}`,"svelte-s90sg6"),$e(Ct,1,`note-badge ${a(Xe).type??""}`,"svelte-s90sg6"),q(Ot,a(Xe).type),q(De,a(Xe).author||"Unknown"),q(pt,a(Xe).created_at),$e(Yt,1,`note-status-btn ${a(Xe).status??""}`,"svelte-s90sg6"),Qe(Yt,"title",a(Xe).status==="pending"?"Click to mark as done":"Click to mark as pending"),q(ca,a(Xe).status),q(ft,a(Xe).text)}),g(qt,mt)}),g(Ee,He)};L(At,Ee=>{a(T).journal_entries&&a(T).journal_entries.length>0&&Ee(Pt)})}var _t=o(At,2),na=l(_t);{var sa=Ee=>{var He=uu();He.__click=()=>e.onEdit(a(T)),g(Ee,He)},oa=Ee=>{var He=du();He.__click=()=>J(a(T)),g(Ee,He)};L(na,Ee=>{a(T).status==="unregistered"?Ee(sa):Ee(oa,!1)})}var Wt=o(na,2),Ut=l(Wt);Ut.__click=()=>U(a(T).id);var Mt=o(Ut,2);{var xt=Ee=>{var He=pu(),rt=l(He);rt.__click=()=>{re(a(T)),ne()};var qt=o(rt,2);qt.__click=()=>{e.onEdit(a(T)),ne()};var Xe=o(qt,2);{var mt=Ct=>{var Ot=fu(),Gt=je(Ot);Gt.__click=()=>{ee(a(T)),ne()};var De=o(Gt,2);De.__click=()=>{Ja(`/gnc?orderId=${a(T).id}`),ne()},g(Ct,Ot)};L(Xe,Ct=>{a(T).type==="order"&&Ct(mt)})}var vt=o(Xe,2);vt.__click=()=>{X(a(T).id),ne()},g(Ee,He)};L(Mt,Ee=>{a(D)===a(T).id&&Ee(xt)})}G(()=>{q(xe,a(T).name),q(he,a(T).type),$e(Ye,1,`status-select ${a(T).status??""}`,"svelte-s90sg6"),F.disabled=a(T).status!=="unregistered",tt!==(tt=a(T).status)&&(Ye.value=(Ye.__value=a(T).status)??"",vn(Ye,a(T).status)),q(we,a(T).author||"-"),q(Ve,a(T).registration_date)}),g(C,Me)});var j=o(te,2);{var B=C=>{var T=_u();g(C,T)};L(j,C=>{a(n).length===0&&C(B)})}var W=o(ae,2);{let C=Ze(()=>!!a(S));vi(W,{get isOpen(){return a(C)},close:O,maxWidth:"800px",children:(T,Q)=>{av(T,{get document(){return a(S)}})},$$slots:{default:!0}})}var se=o(W,2);{let C=Ze(()=>!!a(w)),T=Ze(()=>a(w)?.id),Q=Ze(()=>a(w)?.name);xi(se,{get isOpen(){return a(C)},close:de,get documentId(){return a(T)},get documentName(){return a(Q)},get entry(){return a(k)}})}var ce=o(se,2);{let C=Ze(()=>!!a(z)),T=Ze(()=>a(z)||[]);Si(ce,{get isOpen(){return a(C)},close:_e,get attachments(){return a(T)}})}var ue=o(ce,2);{let C=Ze(()=>({filterType:a(i),filterStatus:a(c),filterTag:a(d),filterAssignee:a(v),filterMaterial:a(p),filterTaskTypes:a(f),startDate:a(_),endDate:a(h),dateField:a(m),sortBy:a(P),sortOrder:a(M)}));Bv(ue,{get isOpen(){return a(E)},close:$,get filters(){return a(C)},onApply:A})}return Ce(Se,()=>a(r),C=>u(r,C)),g(t,qe),ct(oe)}gt(["input","click","change"]);var bu=b('<button type="button" class="btn-outline svelte-f0yvr0">📷 View Gallery</button>'),yu=b('<p class="info-text svelte-f0yvr0">Uploading...</p>'),wu=b('<p class="error-text svelte-f0yvr0"> </p>'),ku=b('<div class="attachment-item svelte-f0yvr0"><span class="file-name svelte-f0yvr0"> </span> <button type="button" class="remove-btn svelte-f0yvr0">❌</button></div>'),xu=b('<div class="attachment-item new svelte-f0yvr0"><span class="file-name svelte-f0yvr0"> </span> <button type="button" class="remove-btn svelte-f0yvr0">❌</button></div>'),Su=b('<div class="attachments-list svelte-f0yvr0"><!> <!></div>'),Tu=b('<span class="part-dims svelte-f0yvr0"> </span>'),qu=b('<li class="part-item-li svelte-f0yvr0"><span class="part-name svelte-f0yvr0"> </span> <span class="part-reg svelte-f0yvr0"> </span> <!></li>'),Eu=b('<ul class="parts-list svelte-f0yvr0"></ul>'),ju=b('<p class="no-parts svelte-f0yvr0">No linked parts found in GNC.</p>'),Au=b('<details class="task-item svelte-f0yvr0"><summary class="svelte-f0yvr0"><span class="task-icon">⚙️</span> <span class="task-name svelte-f0yvr0"> </span> <span> </span></summary> <div class="task-details svelte-f0yvr0"><div class="task-meta svelte-f0yvr0"><div class="meta-item svelte-f0yvr0"><span class="label svelte-f0yvr0">Assignee:</span> <span> </span></div> <div class="meta-item svelte-f0yvr0"><span class="label svelte-f0yvr0">Material:</span> <span> </span></div> <div class="meta-item svelte-f0yvr0"><span class="label svelte-f0yvr0">GNC Path:</span> <span class="path svelte-f0yvr0"> </span></div></div> <div class="linked-parts-section svelte-f0yvr0"><h5 class="svelte-f0yvr0"> </h5> <!></div></div></details>'),Pu=b('<div class="form-section svelte-f0yvr0"><h4 class="svelte-f0yvr0"> </h4> <div class="task-list svelte-f0yvr0"></div></div>'),Cu=b('<div class="form-group svelte-f0yvr0"><button type="button" class="btn-gnc svelte-f0yvr0">✂️ Edit in GNC</button></div>'),Ru=b('<div class="form-container svelte-f0yvr0"><h3 class="svelte-f0yvr0"> </h3> <form><div class="form-section upload-section svelte-f0yvr0"><h4 class="svelte-f0yvr0">Files & Scanning</h4> <div class="upload-buttons"><div class="upload-btn-wrapper svelte-f0yvr0"><button type="button" class="btn-outline svelte-f0yvr0">📄 Add Attachments</button> <input type="file" multiple title="Add Attachments (No Scan)" class="svelte-f0yvr0"/></div> <!></div> <!> <!> <!></div> <div class="form-group svelte-f0yvr0"><label for="name" class="svelte-f0yvr0">Name</label> <input id="name" type="text" required placeholder="e.g. Project Alpha Specs" class="svelte-f0yvr0"/></div> <div class="form-group svelte-f0yvr0"><label for="description" class="svelte-f0yvr0">Description</label> <textarea id="description" rows="3" placeholder="Brief description of the document..." class="svelte-f0yvr0"></textarea></div> <!> <div class="form-group svelte-f0yvr0"><label for="tags" class="svelte-f0yvr0">Tags</label> <!></div> <div class="form-group svelte-f0yvr0"><label for="content" class="svelte-f0yvr0">Recognized Content (Markdown)</label> <textarea id="content" rows="10" placeholder="Recognized document content will appear here..." class="svelte-f0yvr0"></textarea></div> <div class="row svelte-f0yvr0"><div class="form-group half svelte-f0yvr0"><label for="type" class="svelte-f0yvr0">Type</label> <select id="type" class="svelte-f0yvr0"><option>Plan</option><option>Mail</option><option>Order</option><option>Other</option></select></div> <div class="form-group half svelte-f0yvr0"><label for="status" class="svelte-f0yvr0">Status</label> <select id="status" class="svelte-f0yvr0"><option>In Progress</option><option>Done</option></select></div></div> <!> <div class="row svelte-f0yvr0"><div class="form-group half svelte-f0yvr0"><label for="date" class="svelte-f0yvr0">Registration Date</label> <input id="date" type="date" class="svelte-f0yvr0"/></div> <div class="form-group half svelte-f0yvr0"><label for="done_date" class="svelte-f0yvr0">Done Date</label> <input id="done_date" type="date" class="svelte-f0yvr0"/></div></div> <div class="form-group svelte-f0yvr0"><label for="author" class="svelte-f0yvr0">Author</label> <input id="author" type="text" placeholder="Your Name" class="svelte-f0yvr0"/></div> <div class="actions svelte-f0yvr0"><button type="button" class="btn-secondary svelte-f0yvr0">Cancel</button> <button type="submit" class="btn-primary svelte-f0yvr0"> </button></div></form> <!></div>');function zu(t,e){ot(e,!0);let n=bt(e,"document",3,null),r=y(""),s=y(""),i=y("plan"),c=y("in_progress"),d=y(""),v=y(""),p=y(""),f=y(""),_=y(Ne([])),h=y(Ne([])),m=y(Ne([]));Ft(()=>{if(n())u(r,n().name||"",!0),u(s,n().description||"",!0),u(i,n().type||"plan",!0),u(c,n().status||"in_progress",!0),u(d,n().registration_date||"",!0),u(v,n().content||"",!0),u(p,n().author||"",!0),u(f,n().done_date||"",!0),u(_,n().attachments||[],!0),n().tags?u(m,n().tags.map(F=>typeof F=="string"?F:F.name),!0):u(m,[],!0);else{const F=typeof localStorage<"u"?localStorage.getItem("doc_author"):"";F&&u(p,F,!0)}});let x=y(!1),S=y(!1),w=y(""),k=y(null);Jt(()=>{if(a(c)==="unregistered"&&u(c,"in_progress"),!n()){const F=localStorage.getItem("doc_author");F&&u(p,F,!0)}}),Ft(()=>{a(c)==="done"&&!a(f)&&u(f,new Date().toISOString().split("T")[0],!0)});async function z(F){const be=Array.from(F.target.files);if(be.length!==0){u(x,!0);try{for(const Ie of be){const tt=await Ds(Ie);a(h).push({file_path:tt.file_path,filename:tt.filename,media_type:tt.media_type})}}catch(Ie){console.error("Upload failed",Ie),alert("Failed to upload attachment")}finally{u(x,!1),F.target.value=""}}}function E(){u(k,[...a(_),...a(h)],!0)}async function P(F,be){if(be)a(h).splice(F,1);else{if(!confirm("Permanently delete this attachment?"))return;const Ie=a(_)[F];try{await xo(Ie.id),a(_).splice(F,1)}catch(tt){console.error("Failed to delete attachment",tt),alert("Failed to delete attachment")}}}async function M(F){F.preventDefault(),u(S,!0),u(w,"");try{a(p)&&localStorage.setItem("doc_author",a(p));const be={name:a(r),description:a(s),type:a(i),status:a(c),registration_date:a(d)||void 0,content:a(v),author:a(p),done_date:a(f)||void 0,attachments:a(h),tags:a(m)};n()?await po(n().id,be):await uo(be),n()||(u(r,""),u(s,""),u(i,"plan"),u(c,"in_progress"),u(d,""),u(v,""),u(p,localStorage.getItem("doc_author")||"",!0),u(f,""),u(h,[],!0),u(m,[],!0)),e.onDocumentCreated()}catch(be){console.error("Failed to save document:",be),u(w,"Failed to save document. Please try again.")}finally{u(S,!1)}}var D=Ru(),H=l(D),Y=l(H),R=o(H,2),X=l(R),Z=o(l(X),2),J=l(Z),O=o(l(J),2);O.__change=z;var re=o(J,2);{var ie=F=>{var be=bu();be.__click=E,g(F,be)};L(re,F=>{(a(_).length>0||a(h).length>0)&&F(ie)})}var de=o(Z,2);{var ve=F=>{var be=yu();g(F,be)};L(de,F=>{a(x)&&F(ve)})}var le=o(de,2);{var _e=F=>{var be=wu(),Ie=l(be);G(()=>q(Ie,a(w))),g(F,be)};L(le,F=>{a(w)&&F(_e)})}var ge=o(le,2);{var Pe=F=>{var be=Su(),Ie=l(be);Ae(Ie,17,()=>a(_),Fe,(at,yt,wt)=>{var Bt=ku(),Rt=l(Bt),N=l(Rt),K=o(Rt,2);K.__click=()=>P(wt,!1),G(()=>{Qe(Rt,"title",a(yt).filename),q(N,a(yt).filename)}),g(at,Bt)});var tt=o(Ie,2);Ae(tt,17,()=>a(h),Fe,(at,yt,wt)=>{var Bt=xu(),Rt=l(Bt),N=l(Rt),K=o(Rt,2);K.__click=()=>P(wt,!0),G(()=>{Qe(Rt,"title",a(yt).filename),q(N,`(New) ${a(yt).filename??""}`)}),g(at,Bt)}),g(F,be)};L(ge,F=>{(a(_).length>0||a(h).length>0)&&F(Pe)})}var ke=o(X,2),$=o(l(ke),2),A=o(ke,2),U=o(l(A),2),ne=o(A,2);{var ee=F=>{var be=Pu(),Ie=l(be),tt=l(Ie),at=o(Ie,2);Ae(at,21,()=>n().tasks,Fe,(yt,wt)=>{var Bt=Au(),Rt=l(Bt),N=o(l(Rt),2),K=l(N),we=o(N,2),Ue=l(we),zt=o(Rt,2),Ve=l(zt),Te=l(Ve),dt=o(l(Te),2),jt=l(dt),At=o(Te,2),Pt=o(l(At),2),_t=l(Pt),na=o(At,2),sa=o(l(na),2),oa=l(sa),Wt=o(Ve,2),Ut=l(Wt),Mt=l(Ut),xt=o(Ut,2);{var Ee=rt=>{var qt=Eu();Ae(qt,21,()=>a(wt).parts,Fe,(Xe,mt)=>{var vt=qu(),Ct=l(vt),Ot=l(Ct),Gt=o(Ct,2),De=l(Gt),Je=o(Gt,2);{var pt=ht=>{var St=Tu(),Nt=l(St);G((Yt,ca)=>q(Nt,`${Yt??""} x ${ca??""}`),[()=>Math.round(a(mt).width),()=>Math.round(a(mt).height)]),g(ht,St)};L(Je,ht=>{(a(mt).width||a(mt).height)&&ht(pt)})}G(()=>{q(Ot,a(mt).name),q(De,`[${a(mt).registration_number??""}]`)}),g(Xe,vt)}),g(rt,qt)},He=rt=>{var qt=ju();g(rt,qt)};L(xt,rt=>{a(wt).parts?.length>0?rt(Ee):rt(He,!1)})}G(()=>{q(K,a(wt).name),$e(we,1,`task-status-badge ${a(wt).status??""}`,"svelte-f0yvr0"),q(Ue,a(wt).status),q(jt,a(wt).assignee||"Unassigned"),q(_t,a(wt).material?.name||"Unknown"),Qe(sa,"title",a(wt).gnc_file_path),q(oa,a(wt).gnc_file_path||"N/A"),q(Mt,`Linked Parts (${(a(wt).parts?.length||0)??""})`)}),g(yt,Bt)}),G(()=>q(tt,`Tasks (${n().tasks.length??""})`)),g(F,be)};L(ne,F=>{n()?.tasks?.length>0&&F(ee)})}var oe=o(ne,2),qe=o(l(oe),2);Jv(qe,{get selectedTags(){return a(m)},set selectedTags(F){u(m,F,!0)}});var ye=o(oe,2),Oe=o(l(ye),2),fe=o(ye,2),Se=l(fe),pe=o(l(Se),2),I=l(pe);I.value=I.__value="plan";var V=o(I);V.value=V.__value="mail";var ae=o(V);ae.value=ae.__value="order";var te=o(ae);te.value=te.__value="other";var j=o(Se,2),B=o(l(j),2),W=l(B);W.value=W.__value="in_progress";var se=o(W);se.value=se.__value="done";var ce=o(fe,2);{var ue=F=>{var be=Cu(),Ie=l(be);Ie.__click=()=>window.location.hash=`#/gnc?orderId=${n().id}`,g(F,be)};L(ce,F=>{n()&&a(i)==="order"&&F(ue)})}var C=o(ce,2),T=l(C),Q=o(l(T),2),me=o(T,2),Me=o(l(me),2),Be=o(C,2),Ge=o(l(Be),2),et=o(Be,2),xe=l(et);xe.__click=function(...F){e.onCancel?.apply(this,F)};var Le=o(xe,2),he=l(Le),Ye=o(R,2);{let F=Ze(()=>!!a(k)),be=Ze(()=>a(k)||[]);Si(Ye,{get isOpen(){return a(F)},close:()=>u(k,null),get attachments(){return a(be)}})}G(()=>{q(Y,n()?"Edit Document":"New Document"),Me.disabled=a(c)!=="done",Le.disabled=a(S)||a(x),q(he,a(S)?"Saving...":n()?"Save Changes":"Register Document")}),ha("submit",R,M),Ce($,()=>a(r),F=>u(r,F)),Ce(U,()=>a(s),F=>u(s,F)),Ce(Oe,()=>a(v),F=>u(v,F)),Et(pe,()=>a(i),F=>u(i,F)),Et(B,()=>a(c),F=>u(c,F)),Ce(Q,()=>a(d),F=>u(d,F)),Ce(Me,()=>a(f),F=>u(f,F)),Ce(Ge,()=>a(p),F=>u(p,F)),g(t,D),ct()}gt(["change","click"]);var Mu=b('<div class="page-container svelte-14q2aho"><!> <!></div>');function Nu(t,e){ot(e,!0);let n=y(!1),r=y(null),s=y(null);function i(){u(r,null),u(n,!0)}function c(m){u(r,m,!0),u(n,!0)}function d(){u(n,!1),u(r,null)}function v(){a(s)&&a(s).refresh&&a(s).refresh()}function p(){d(),v()}Jt(()=>(Qa([{label:"Documents",items:[{label:"New Document",action:i},{label:"Refresh",action:v}]}]),()=>{Ka()}));var f=Mu(),_=l(f);Ns(mu(_,{onEdit:c}),m=>u(s,m,!0),()=>a(s));var h=o(_,2);vi(h,{get isOpen(){return a(n)},close:d,children:(m,x)=>{zu(m,{onDocumentCreated:p,onCancel:d,get document(){return a(r)}})},$$slots:{default:!0}}),g(t,f),ct()}var Du=b('<span class="att-badge svelte-v5qqzx"> </span>'),Ou=b('<div class="attachments-preview svelte-v5qqzx"></div>'),Iu=b('<div class="entry-form svelte-v5qqzx"><input type="text" placeholder="Author" class="author-input svelte-v5qqzx"/> <select class="svelte-v5qqzx"><option>Info</option><option>Warning</option><option>Error</option></select> <textarea placeholder="Message..." class="svelte-v5qqzx"></textarea> <div class="file-input-group svelte-v5qqzx"><input type="file" multiple class="svelte-v5qqzx"/> <!></div> <button>Save</button></div>'),Lu=b("<p>Loading...</p>"),$u=b('<p class="empty">No entries found.</p>'),Fu=b('<span class="doc-ref svelte-v5qqzx"> </span>'),Bu=b('<a target="_blank" class="svelte-v5qqzx"><img class="svelte-v5qqzx"/></a>'),Uu=b('<a target="_blank" class="svelte-v5qqzx"> </a>'),Gu=b('<div class="attachment-thumb svelte-v5qqzx"><!></div>'),Yu=b('<div class="entry-attachments svelte-v5qqzx"></div>'),Xu=b('<div><div class="entry-header svelte-v5qqzx"><span> </span> <span class="author svelte-v5qqzx"> </span> <span class="date"> </span> <!> <div class="actions svelte-v5qqzx"><button class="edit-btn svelte-v5qqzx">✏️ Edit</button> <button class="status-btn svelte-v5qqzx"> </button> <button class="delete-btn svelte-v5qqzx">🗑</button></div></div> <p class="text svelte-v5qqzx"> </p> <!></div>'),Ju=b('<div class="journal-container svelte-v5qqzx"><div class="toolbar svelte-v5qqzx"><div class="filters svelte-v5qqzx"><select class="svelte-v5qqzx"><option>All Types</option><option>Info</option><option>Warning</option><option>Error</option></select> <select class="svelte-v5qqzx"><option>All Statuses</option><option>Pending</option><option>Done</option></select></div></div> <!> <div class="entries-list svelte-v5qqzx"><!></div> <!></div>');function Wu(t,e){ot(e,!0);let n=y(Ne([])),r=y(!1),s=y(null),i=y(""),c=y(""),d=y(!1),v=y(""),p=y("info"),f=y(""),_=y(Ne([]));async function h(){u(r,!0);try{u(n,await go(a(i),a(c)),!0)}catch($){console.error($)}finally{u(r,!1)}}function m(){u(d,!a(d))}Jt(()=>{u(f,localStorage.getItem("journal_author")||"",!0),h();const $=()=>{h()};return window.addEventListener("journal-entries-updated",$),Qa([{label:"Journal",items:[{label:"New Entry",action:m},{label:"Refresh",action:h}]}]),()=>{window.removeEventListener("journal-entries-updated",$),Ka()}});async function x($){const A=Array.from($.target.files);if(A.length!==0){for(const U of A)try{const ne=await Ds(U);a(_).push(ne)}catch(ne){console.error("Upload failed",ne),alert("Upload failed for "+U.name)}$.target.value=""}}async function S(){if(!(!a(v)&&a(_).length===0)){a(f)&&localStorage.setItem("journal_author",a(f));try{await oi({text:a(v),type:a(p),status:"pending",author:a(f),attachments:a(_)}),u(v,""),u(_,[],!0),u(d,!1),h()}catch($){console.error("Failed to add entry",$)}}}async function w($){const A=$.status==="pending"?"done":"pending";try{await Os($.id,{status:A}),h()}catch(U){console.error(U)}}async function k($){if(confirm("Are you sure?"))try{await mo($),h()}catch(A){console.error(A)}}function z($){u(s,$,!0)}function E(){u(s,null),h()}Ft(()=>{h()});var P=Ju(),M=l(P),D=l(M),H=l(D);H.__change=h;var Y=l(H);Y.value=Y.__value="";var R=o(Y);R.value=R.__value="info";var X=o(R);X.value=X.__value="warning";var Z=o(X);Z.value=Z.__value="error";var J=o(H,2);J.__change=h;var O=l(J);O.value=O.__value="";var re=o(O);re.value=re.__value="pending";var ie=o(re);ie.value=ie.__value="done";var de=o(M,2);{var ve=$=>{var A=Iu(),U=l(A),ne=o(U,2),ee=l(ne);ee.value=ee.__value="info";var oe=o(ee);oe.value=oe.__value="warning";var qe=o(oe);qe.value=qe.__value="error";var ye=o(ne,2),Oe=o(ye,2),fe=l(Oe);fe.__change=x;var Se=o(fe,2);{var pe=V=>{var ae=Ou();Ae(ae,21,()=>a(_),Fe,(te,j)=>{var B=Du(),W=l(B);G(()=>q(W,a(j).filename)),g(te,B)}),g(V,ae)};L(Se,V=>{a(_).length>0&&V(pe)})}var I=o(Oe,2);I.__click=S,Ce(U,()=>a(f),V=>u(f,V)),Et(ne,()=>a(p),V=>u(p,V)),Ce(ye,()=>a(v),V=>u(v,V)),g($,A)};L(de,$=>{a(d)&&$(ve)})}var le=o(de,2),_e=l(le);{var ge=$=>{var A=Lu();g($,A)},Pe=$=>{var A=lt(),U=je(A);{var ne=oe=>{var qe=$u();g(oe,qe)},ee=oe=>{var qe=lt(),ye=je(qe);Ae(ye,17,()=>a(n),Fe,(Oe,fe)=>{var Se=Xu(),pe=l(Se),I=l(pe),V=l(I),ae=o(I,2),te=l(ae),j=o(ae,2),B=l(j),W=o(j,2);{var se=et=>{var xe=Fu(),Le=l(xe);G(()=>q(Le,`Ref: Doc #${a(fe).document_id??""}`)),g(et,xe)};L(W,et=>{a(fe).document_id&&et(se)})}var ce=o(W,2),ue=l(ce);ue.__click=()=>z(a(fe));var C=o(ue,2);C.__click=()=>w(a(fe));var T=l(C),Q=o(C,2);Q.__click=()=>k(a(fe).id);var me=o(pe,2),Me=l(me),Be=o(me,2);{var Ge=et=>{var xe=Yu();Ae(xe,21,()=>a(fe).attachments,Fe,(Le,he)=>{var Ye=Gu(),F=l(Ye);{var be=tt=>{var at=Bu(),yt=l(at);G(()=>{Qe(at,"href",a(he).file_path),Qe(yt,"src",a(he).file_path),Qe(yt,"alt",a(he).filename)}),g(tt,at)},Ie=tt=>{var at=Uu(),yt=l(at);G(()=>{Qe(at,"href",a(he).file_path),q(yt,`📄 ${a(he).filename??""}`)}),g(tt,at)};L(F,tt=>{a(he).media_type&&a(he).media_type.startsWith("image/")?tt(be):tt(Ie,!1)})}g(Le,Ye)}),g(et,xe)};L(Be,et=>{a(fe).attachments&&a(fe).attachments.length>0&&et(Ge)})}G(()=>{$e(Se,1,`entry-card ${a(fe).type??""} ${a(fe).status??""}`,"svelte-v5qqzx"),$e(I,1,`badge ${a(fe).type??""}`,"svelte-v5qqzx"),q(V,a(fe).type),q(te,a(fe).author||"Unknown"),q(B,a(fe).created_at),q(T,a(fe).status==="pending"?"☑ Mark Done":"↩ Reopen"),q(Me,a(fe).text)}),g(Oe,Se)}),g(oe,qe)};L(U,oe=>{a(n).length===0?oe(ne):oe(ee,!1)},!0)}g($,A)};L(_e,$=>{a(r)?$(ge):$(Pe,!1)})}var ke=o(le,2);{let $=Ze(()=>!!a(s)),A=Ze(()=>a(s)?.document_id);xi(ke,{get isOpen(){return a($)},close:E,get documentId(){return a(A)},documentName:"Journal Entry",get entry(){return a(s)}})}Et(H,()=>a(i),$=>u(i,$)),Et(J,()=>a(c),$=>u(c,$)),g(t,P),ct()}gt(["change","click"]);var Hu=b('<div class="loading-state svelte-g0byll">Loading tasks...</div>'),Zu=b('<div class="empty-state svelte-g0byll">Enter an assignee name above to view their tasks.</div>'),Vu=b('<div class="empty-state svelte-g0byll">No pending or planned tasks found for this assignee.</div>'),Qu=b('<div><div class="task-info svelte-g0byll"><span> </span> <button class="btn-done svelte-g0byll" title="Mark as done">✓</button> <span class="task-name svelte-g0byll"> </span></div></div>'),Ku=b('<div class="material-group svelte-g0byll"><div class="material-header svelte-g0byll"><span class="material-name svelte-g0byll"> </span> <span class="task-count svelte-g0byll"> </span></div> <div class="tasks-list svelte-g0byll"></div></div>'),ed=b('<div class="doc-group svelte-g0byll"><div class="doc-header svelte-g0byll"><h3 class="svelte-g0byll"> </h3> <span> </span></div> <!></div>'),td=b('<div class="documents-list svelte-g0byll"></div>'),ad=b('<div class="job-view svelte-g0byll"><div class="assignee-filter svelte-g0byll"><label for="assignee" class="svelte-g0byll">Assignee:</label> <input id="assignee" type="text" placeholder="Enter assignee name..." class="svelte-g0byll"/> <button class="btn-load svelte-g0byll"> </button></div> <!></div>');function nd(t,e){ot(e,!0);let n=y(Ne([])),r=y(""),s=y(!1);Jt(()=>(u(r,localStorage.getItem("job_assignee")||"",!0),a(r)&&i(),Qa([{label:"Job",items:[{label:"Refresh",action:i}]}]),()=>{Ka()}));async function i(){if(!a(r).trim()){u(n,[],!0);return}u(s,!0);try{const k=await li();u(n,k.map(z=>({...z,tasks:(z.tasks||[]).filter(E=>E.assignee&&E.assignee.toLowerCase().includes(a(r).toLowerCase())&&(E.status==="pending"||E.status==="planned"))})).filter(z=>z.tasks.length>0),!0)}catch(k){console.error(k)}finally{u(s,!1)}}function c(){localStorage.setItem("job_assignee",a(r)),i()}async function d(k){try{await Ln(k,{status:"done"}),await i()}catch(z){console.error(z),alert("Failed to update task status")}}function v(k){const E=[...k.tasks||[]].sort((M,D)=>M.status==="pending"&&D.status!=="pending"?-1:M.status!=="pending"&&D.status==="pending"?1:0),P={};return E.forEach(M=>{const D=M.material?M.material.name:"(No Material)";P[D]||(P[D]=[]),P[D].push(M)}),P}var p=ad(),f=l(p),_=o(l(f),2);_.__change=c;var h=o(_,2);h.__click=i;var m=l(h),x=o(f,2);{var S=k=>{var z=Hu();g(k,z)},w=k=>{var z=lt(),E=je(z);{var P=D=>{var H=Zu();g(D,H)},M=D=>{var H=lt(),Y=je(H);{var R=Z=>{var J=Vu();g(Z,J)},X=Z=>{var J=td();Ae(J,21,()=>a(n),O=>O.id,(O,re)=>{const ie=Ze(()=>v(a(re)));var de=ed(),ve=l(de),le=l(ve),_e=l(le),ge=o(le,2),Pe=l(ge),ke=o(ve,2);Ae(ke,17,()=>Object.entries(a(ie)),Fe,($,A)=>{var U=Ze(()=>xn(a(A),2));let ne=()=>a(U)[0],ee=()=>a(U)[1];var oe=Ku(),qe=l(oe),ye=l(qe),Oe=l(ye),fe=o(ye,2),Se=l(fe),pe=o(qe,2);Ae(pe,21,ee,I=>I.id,(I,V)=>{var ae=Qu(),te=l(ae),j=l(te),B=l(j),W=o(j,2);W.__click=()=>d(a(V).id);var se=o(W,2),ce=l(se);G(()=>{$e(ae,1,`task-row ${a(V).status??""}`,"svelte-g0byll"),$e(j,1,`task-status-badge ${a(V).status??""}`,"svelte-g0byll"),q(B,a(V).status),q(ce,a(V).name)}),g(I,ae)}),G(()=>{q(Oe,`📦 ${ne()??""}`),q(Se,`${ee().length??""} task${ee().length!==1?"s":""}`)}),g($,oe)}),G(()=>{q(_e,a(re).name),$e(ge,1,`doc-badge ${a(re).type??""}`,"svelte-g0byll"),q(Pe,a(re).type)}),g(O,de)}),g(Z,J)};L(Y,Z=>{a(n).length===0?Z(R):Z(X,!1)},!0)}g(D,H)};L(E,D=>{a(r).trim()?D(M,!1):D(P)},!0)}g(k,z)};L(x,k=>{a(s)?k(S):k(w,!1)})}G(k=>{h.disabled=k,q(m,a(s)?"Loading...":"Load")},[()=>a(s)||!a(r).trim()]),Ce(_,()=>a(r),k=>u(r,k)),g(t,p),ct()}gt(["change","click"]);var sd=b('<img class="thumbnail-img svelte-10wfxqz"/>'),rd=b('<div class="thumbnail card svelte-10wfxqz" role="button" tabindex="0"><div class="preview svelte-10wfxqz"><!> <div class="placeholder-geo svelte-10wfxqz"><span>⚙️</span></div> <div class="overlay-actions svelte-10wfxqz"><button class="action-btn svelte-10wfxqz" title="Edit Part">✏️</button> <button class="action-btn svelte-10wfxqz" title="Preview">👁️</button> <button class="action-btn svelte-10wfxqz" title="Add to Order">+</button> <button class="action-btn svelte-10wfxqz" title="Filter in Docs">🔍</button></div></div> <div class="info svelte-10wfxqz"><h4 class="name svelte-10wfxqz"> </h4> <div class="card-meta svelte-10wfxqz"><div class="meta-item svelte-10wfxqz"><span class="label svelte-10wfxqz">Registration:</span> <span class="value svelte-10wfxqz"> </span></div> <div class="meta-item svelte-10wfxqz"><span class="label svelte-10wfxqz">Dimensions:</span> <span class="value svelte-10wfxqz"> </span></div> <div class="meta-item svelte-10wfxqz"><span class="label svelte-10wfxqz">Material:</span> <span class="value svelte-10wfxqz"> </span></div></div></div></div>');function id(t,e){ot(e,!0);let n=Ze(()=>e.part.material?e.part.material.name:"Unknown Material"),r=Ze(()=>`${e.part.width||"?"} x ${e.part.height||"?"}`);function s(O){O.stopPropagation(),e.onedit&&e.onedit(e.part)}function i(O){O.stopPropagation(),e.onpreview&&e.onpreview(e.part)}var c=rd();c.__click=function(...O){e.onclick?.apply(this,O)},c.__keydown=O=>O.key==="Enter"&&e.onclick&&e.onclick();var d=l(c),v=l(d);{var p=O=>{var re=sd();G(()=>{Qe(re,"src",`/uploads/thumbnails/${(e.part.registration_number||e.part.id)??""}.svg`),Qe(re,"alt",e.part.name)}),ha("error",re,ie=>{ie.currentTarget.style.display="none"}),g(O,re)};L(v,O=>{e.part.gnc_file_path&&O(p)})}var f=o(v,2),_=o(f,2),h=l(_);h.__click=s;var m=o(h,2);m.__click=i;var x=o(m,2);x.__click=O=>{O.stopPropagation(),e.onclick&&e.onclick()};var S=o(x,2);S.__click=O=>{O.stopPropagation(),e.onfilter&&e.onfilter(e.part)};var w=o(d,2),k=l(w),z=l(k),E=o(k,2),P=l(E),M=o(l(P),2),D=l(M),H=o(P,2),Y=o(l(H),2),R=l(Y),X=o(H,2),Z=o(l(X),2),J=l(Z);G(()=>{cn(f,e.part.gnc_file_path?"display: none;":""),Qe(k,"title",e.part.name),q(z,e.part.name),q(D,e.part.registration_number||"-"),q(R,`${a(r)??""} mm`),q(J,a(n))}),g(t,c),ct()}gt(["click","keydown"]);var ld=b('<div class="tray-item svelte-15dteus"><img class="thumb svelte-15dteus"/> <div class="details svelte-15dteus"><span class="name svelte-15dteus"> </span> <div class="qty-controls svelte-15dteus"><button class="svelte-15dteus">-</button> <span class="qty svelte-15dteus"> </span> <button class="svelte-15dteus">+</button></div></div> <button class="remove-btn svelte-15dteus" title="Remove">🗑️</button></div>'),od=b('<div class="empty svelte-15dteus">Tray is empty. Add parts from the library.</div>'),cd=b('<div class="tray-backdrop svelte-15dteus"></div> <aside class="tray-panel svelte-15dteus"><header class="svelte-15dteus"><h3 class="svelte-15dteus">Order Tray</h3> <button class="close-btn svelte-15dteus">&times;</button></header> <div class="items svelte-15dteus"><!> <!></div> <footer class="svelte-15dteus"><div class="input-group svelte-15dteus"><label for="order-name" class="svelte-15dteus">Order Name</label> <input id="order-name" type="text" placeholder="e.g. ORDER-2024-001" class="svelte-15dteus"/></div> <div class="actions svelte-15dteus"><button class="clear-btn svelte-15dteus">Clear</button> <button class="create-btn svelte-15dteus"> </button></div></footer></aside>',1);function vd(t,e){ot(e,!0);let n=y(!1),r=y("");async function s(){if(kt.partTray.length!==0){if(!a(r))return alert("Please enter an Order Name");u(n,!0);try{const v=kt.partTray.map(p=>({id:p.part.id,qty:p.quantity}));await qo(v,a(r)),cr(),is(),alert("Order created successfully!")}catch(v){console.error(v),alert("Failed to create order: "+v.message)}finally{u(n,!1)}}}var i=lt(),c=je(i);{var d=v=>{var p=cd(),f=je(p);f.__click=function(...R){is?.apply(this,R)};var _=o(f,2),h=l(_),m=o(l(h),2);m.__click=function(...R){is?.apply(this,R)};var x=o(h,2),S=l(x);Ae(S,17,()=>kt.partTray,R=>R.part.id,(R,X)=>{var Z=ld(),J=l(Z),O=o(J,2),re=l(O),ie=l(re),de=o(re,2),ve=l(de);ve.__click=()=>or(a(X).part.id,-1);var le=o(ve,2),_e=l(le),ge=o(le,2);ge.__click=()=>or(a(X).part.id,1);var Pe=o(O,2);Pe.__click=()=>ci(a(X).part.id),G(()=>{Qe(J,"src",a(X).part.thumbnail_url||"/placeholder.png"),Qe(J,"alt",a(X).part.name),q(ie,a(X).part.name),ve.disabled=a(X).quantity<=1,q(_e,a(X).quantity)}),g(R,Z)});var w=o(S,2);{var k=R=>{var X=od();g(R,X)};L(w,R=>{kt.partTray.length===0&&R(k)})}var z=o(x,2),E=l(z),P=o(l(E),2),M=o(E,2),D=l(M);D.__click=function(...R){cr?.apply(this,R)};var H=o(D,2);H.__click=s;var Y=l(H);G(()=>{D.disabled=kt.partTray.length===0,H.disabled=kt.partTray.length===0||a(n)||!a(r),q(Y,a(n)?"Creating...":"Create Order")}),Ce(P,()=>a(r),R=>u(r,R)),g(v,p)};L(c,v=>{kt.trayVisible&&v(d)})}g(t,i),ct()}gt(["click"]);var ud=b('<div class="message svelte-1y39gna"> </div>'),dd=b('<div class="modal-overlay svelte-1y39gna"><div class="modal svelte-1y39gna"><h2 class="svelte-1y39gna">Scanning Library</h2> <div class="progress-container svelte-1y39gna"><div class="progress-bar svelte-1y39gna"><div class="progress-fill svelte-1y39gna"></div></div> <span class="progress-text svelte-1y39gna"> </span></div> <div class="status svelte-1y39gna"><strong>Status:</strong> </div> <!> <div class="actions svelte-1y39gna"><button class="svelte-1y39gna"> </button></div></div></div>');function fd(t,e){ot(e,!0);const n=no();let r=bt(e,"show",15,!1),s=bt(e,"progress",3,0),i=bt(e,"status",3,""),c=bt(e,"message",3,"");function d(){i()!=="scanning"&&(r(!1),n("close"))}var v=lt(),p=je(v);{var f=_=>{var h=dd();h.__click=d;var m=l(h);m.__click=X=>X.stopPropagation();var x=o(l(m),2),S=l(x),w=l(S),k=o(S,2),z=l(k),E=o(x,2),P=o(l(E)),M=o(E,2);{var D=X=>{var Z=ud(),J=l(Z);G(()=>q(J,c())),g(X,Z)};L(M,X=>{c()&&X(D)})}var H=o(M,2),Y=l(H);Y.__click=d;var R=l(Y);G(()=>{cn(w,`width: ${s()??""}%`),q(z,`${s()??""}%`),q(P,` ${i()??""}`),Y.disabled=i()==="scanning",q(R,i()==="scanning"?"Scanning...":"Close")}),g(_,h)};L(p,_=>{r()&&_(f)})}g(t,v),ct()}gt(["click"]);var pd=b("<option> </option>"),hd=b('<div class="modal-overlay svelte-1fna2hh"><div class="modal svelte-1fna2hh"><h2 class="svelte-1fna2hh">Edit Part</h2> <div class="form svelte-1fna2hh"><div class="field svelte-1fna2hh"><label for="name" class="svelte-1fna2hh">Name</label> <input id="name" type="text" class="svelte-1fna2hh"/></div> <div class="field svelte-1fna2hh"><label for="reg" class="svelte-1fna2hh">Registration Number</label> <input id="reg" type="text" class="svelte-1fna2hh"/></div> <div class="field svelte-1fna2hh"><label for="width" class="svelte-1fna2hh">Width (mm)</label> <input id="width" type="number" step="0.01" class="svelte-1fna2hh"/></div> <div class="field svelte-1fna2hh"><label for="height" class="svelte-1fna2hh">Height (mm)</label> <input id="height" type="number" step="0.01" class="svelte-1fna2hh"/></div> <div class="field svelte-1fna2hh"><label for="material" class="svelte-1fna2hh">Material</label> <select id="material" class="svelte-1fna2hh"><option>No Material</option><!></select></div></div> <div class="actions svelte-1fna2hh"><button class="secondary svelte-1fna2hh">Cancel</button> <button class="primary svelte-1fna2hh">Save</button></div></div></div>');function _d(t,e){ot(e,!0);let n=bt(e,"show",15,!1),r=bt(e,"part",3,null),s=y(Ne([])),i=y(Ne({name:"",registration_number:"",width:0,height:0,material_id:null}));Ft(()=>{n()&&r()&&(u(i,{name:r().name||"",registration_number:r().registration_number||"",width:r().width||0,height:r().height||0,material_id:r().material_id||null},!0),c())});async function c(){try{u(s,await Va(),!0)}catch(h){console.error("Failed to load materials:",h)}}function d(){n(!1)}function v(){e.onsave&&e.onsave(a(i)),d()}var p=lt(),f=je(p);{var _=h=>{var m=hd();m.__click=d;var x=l(m);x.__click=ie=>ie.stopPropagation();var S=o(l(x),2),w=l(S),k=o(l(w),2),z=o(w,2),E=o(l(z),2),P=o(z,2),M=o(l(P),2),D=o(P,2),H=o(l(D),2),Y=o(D,2),R=o(l(Y),2),X=l(R);X.value=(X.__value=null)??"";var Z=o(X);Ae(Z,17,()=>a(s),Fe,(ie,de)=>{var ve=pd(),le=l(ve),_e={};G(()=>{q(le,a(de).name),_e!==(_e=a(de).id)&&(ve.value=(ve.__value=a(de).id)??"")}),g(ie,ve)});var J=o(S,2),O=l(J);O.__click=d;var re=o(O,2);re.__click=v,Ce(k,()=>a(i).name,ie=>a(i).name=ie),Ce(E,()=>a(i).registration_number,ie=>a(i).registration_number=ie),Ce(M,()=>a(i).width,ie=>a(i).width=ie),Ce(H,()=>a(i).height,ie=>a(i).height=ie),Et(R,()=>a(i).material_id,ie=>a(i).material_id=ie),g(h,m)};L(f,h=>{n()&&h(_)})}g(t,p),ct()}gt(["click"]);var gd=b('<img class="preview-img svelte-17z6zdn"/>'),md=b('<div class="no-preview svelte-17z6zdn">No preview available</div>'),bd=b('<div class="modal-backdrop svelte-17z6zdn"><div class="modal svelte-17z6zdn"><header class="svelte-17z6zdn"><h3 class="svelte-17z6zdn"> </h3> <button class="close-btn svelte-17z6zdn">&times;</button></header> <div class="content svelte-17z6zdn"><!> <div class="details svelte-17z6zdn"><p><strong>Registration:</strong> </p> <p><strong>Dimensions:</strong> </p></div></div></div></div>');function yd(t,e){ot(e,!0);let n=bt(e,"show",15,!1);function r(){n(!1)}function s(v){v.key==="Escape"&&r()}var i=lt();ha("keydown",fs,s);var c=je(i);{var d=v=>{var p=bd();p.__click=r;var f=l(p);f.__click=Y=>Y.stopPropagation();var _=l(f),h=l(_),m=l(h),x=o(h,2);x.__click=r;var S=o(_,2),w=l(S);{var k=Y=>{var R=gd();G(()=>{Qe(R,"src",`/uploads/thumbnails/${(e.part.registration_number||e.part.id)??""}.svg`),Qe(R,"alt",e.part.name)}),g(Y,R)},z=Y=>{var R=md();g(Y,R)};L(w,Y=>{e.part.gnc_file_path?Y(k):Y(z,!1)})}var E=o(w,2),P=l(E),M=o(l(P)),D=o(P,2),H=o(l(D));G(()=>{q(m,e.part.name),q(M,` ${(e.part.registration_number||"-")??""}`),q(H,` ${(e.part.width||"?")??""} x ${(e.part.height||"?")??""} mm`)}),g(v,p)};L(c,v=>{n()&&e.part&&v(d)})}g(t,i),ct()}gt(["click"]);var wd=b("<option> </option>"),kd=b('<div class="loading svelte-xfu7xu">Loading parts...</div>'),xd=b('<div class="empty svelte-xfu7xu">No parts found matching filters.</div>'),Sd=b("<div></div>"),Td=b('<div class="parts-layout svelte-xfu7xu"><aside class="sidebar svelte-xfu7xu"><h3 class="svelte-xfu7xu">Filters</h3> <div class="filter-group svelte-xfu7xu"><label for="search" class="svelte-xfu7xu">Search</label> <input id="search" type="text" placeholder="Name or Reg #" class="svelte-xfu7xu"/></div> <div class="filter-group svelte-xfu7xu"><label for="material" class="svelte-xfu7xu">Material</label> <select id="material" class="svelte-xfu7xu"><option>All Materials</option><!></select></div> <div class="filter-group svelte-xfu7xu"><span class="filter-label svelte-xfu7xu">Width (mm)</span> <div class="range svelte-xfu7xu"><input type="number" placeholder="Min" class="svelte-xfu7xu"/> <span>-</span> <input type="number" placeholder="Max" class="svelte-xfu7xu"/></div></div> <div class="filter-group svelte-xfu7xu"><span class="filter-label svelte-xfu7xu">Height (mm)</span> <div class="range svelte-xfu7xu"><input type="number" placeholder="Min" class="svelte-xfu7xu"/> <span>-</span> <input type="number" placeholder="Max" class="svelte-xfu7xu"/></div></div> <button class="reset-btn svelte-xfu7xu">Reset Filters</button></aside> <main class="content svelte-xfu7xu"><header class="svelte-xfu7xu"><div class="title-row svelte-xfu7xu"><h2 class="svelte-xfu7xu">Parts Library</h2></div></header> <!></main> <!> <!> <!> <!></div>');function qd(t,e){ot(e,!0);let n=y(Ne([])),r=y(Ne([])),s=y(""),i=y(""),c=y(""),d=y(""),v=y(""),p=y(""),f=y(!1),_=y(0);const h=50;let m=y(!1),x=y(0),S=y(""),w=y(""),k=y(!1),z=y(null),E=y(!1),P=y(null);async function M(){u(f,!0);try{const j={};a(s)&&(j.search=a(s)),a(i)&&(j.material_id=a(i)),a(c)&&(j.min_width=a(c)),a(d)&&(j.max_width=a(d)),a(v)&&(j.min_height=a(v)),a(p)&&(j.max_height=a(p));const[B,W]=await Promise.all([Ao(a(_)*h,h,j),a(r).length===0?Va():Promise.resolve(a(r))]);u(n,B,!0),a(r).length===0&&u(r,W,!0)}catch(j){console.error(j),alert("Failed to load parts")}finally{u(f,!1)}}function D(){u(_,0),M()}let H;function Y(){clearTimeout(H),H=setTimeout(()=>{D()},500)}async function R(){u(m,!0),u(x,0),u(S,"starting"),u(w,"Initializing scan...");try{await No(j=>{u(x,j.percent||0,!0),u(S,j.status||"",!0),u(w,j.message||"",!0)}),a(S)==="complete"&&await M()}catch(j){console.error("Scan error:",j),u(S,"error"),u(w,`Scan failed: ${j.message}`)}}function X(j){u(z,j,!0),u(k,!0)}function Z(j){u(P,j,!0),u(E,!0)}function J(j){Ja(`/documents?part_search=${encodeURIComponent(j.name)}`)}async function O(j){try{await Do(a(z).id,j),await M(),alert("Part updated successfully"),u(k,!1)}catch(B){console.error("Update error:",B),alert("Failed to update part")}}Jt(()=>(M(),Qa([{label:"Parts",items:[{label:"Rescan Library",action:R},{label:"Refresh",action:M}]}]),()=>{Ka()}));var re=Td(),ie=l(re),de=o(l(ie),2),ve=o(l(de),2);ve.__input=Y;var le=o(de,2),_e=o(l(le),2);_e.__change=D;var ge=l(_e);ge.value=ge.__value="";var Pe=o(ge);Ae(Pe,17,()=>a(r),Fe,(j,B)=>{var W=wd(),se=l(W),ce={};G(()=>{q(se,a(B).name),ce!==(ce=a(B).id)&&(W.value=(W.__value=a(B).id)??"")}),g(j,W)});var ke=o(le,2),$=o(l(ke),2),A=l($);A.__change=D;var U=o(A,4);U.__change=D;var ne=o(ke,2),ee=o(l(ne),2),oe=l(ee);oe.__change=D;var qe=o(oe,4);qe.__change=D;var ye=o(ne,2);ye.__click=()=>{u(s,""),u(i,""),u(c,""),u(d,""),u(v,""),u(p,""),D()};var Oe=o(ie,2),fe=o(l(Oe),2);{var Se=j=>{var B=kd();g(j,B)},pe=j=>{var B=lt(),W=je(B);{var se=ue=>{var C=xd();g(ue,C)},ce=ue=>{var C=Sd();$e(C,1,"grid grid svelte-xfu7xu"),Ae(C,21,()=>a(n),T=>T.id,(T,Q)=>{id(T,{get part(){return a(Q)},onclick:()=>Jo(a(Q)),onedit:X,onpreview:Z,onfilter:J})}),g(ue,C)};L(W,ue=>{a(n).length===0?ue(se):ue(ce,!1)},!0)}g(j,B)};L(fe,j=>{a(f)?j(Se):j(pe,!1)})}var I=o(Oe,2);fd(I,{get status(){return a(S)},get message(){return a(w)},get progress(){return a(x)},get show(){return a(m)},set show(j){u(m,j,!0)}});var V=o(I,2);_d(V,{get part(){return a(z)},onsave:O,get show(){return a(k)},set show(j){u(k,j,!0)}});var ae=o(V,2);yd(ae,{get part(){return a(P)},get show(){return a(E)},set show(j){u(E,j,!0)}});var te=o(ae,2);vd(te,{}),Ce(ve,()=>a(s),j=>u(s,j)),Et(_e,()=>a(i),j=>u(i,j)),Ce(A,()=>a(c),j=>u(c,j)),Ce(U,()=>a(d),j=>u(d,j)),Ce(oe,()=>a(v),j=>u(v,j)),Ce(qe,()=>a(p),j=>u(p,j)),g(t,re),ct()}gt(["input","change","click"]);var Ed=b('<div class="canvas-container svelte-1eph566"><div class="toolbar svelte-1eph566"><button title="Navigate (Pan)">✋</button> <button title="Select">↖</button> <button title="Define Nesting Area">🎯</button></div>  <canvas class="svelte-1eph566"></canvas> <div class="zoom-controls svelte-1eph566"><button title="Reset Zoom" class="svelte-1eph566">⟲</button> <span class="zoom-level svelte-1eph566"> </span></div></div>');function jd(t,e){ot(e,!0);let n=bt(e,"sheet",3,null),r=bt(e,"width",3,800),s=bt(e,"height",3,600),i=bt(e,"onselect",3,null),c=bt(e,"onAreaChange",3,null),d=bt(e,"showDebug",3,!1),v=bt(e,"nestingMode",3,"hull"),p=y(void 0),f=y(null),_=y(1),h=y(0),m=y(0),x=y(!1),S=y(0),w=y(0),k=y("navigate"),z=y(!1),E=y(null),P=y(null),M=y(null),D=y(null);const H=Ze(()=>n()?R(n()):{minX:0,minY:0,maxX:100,maxY:100}),Y=Ze(()=>{const I=a(H).maxX-a(H).minX,V=a(H).maxY-a(H).minY;if(I===0&&V===0)return{scale:1,startX:0,startY:0,bounds:a(H)};const ae=20,te=r()-ae*2,j=s()-ae*2,B=te/I,W=j/V,ce=Math.min(B,W)*.95*a(_),ue=I*ce,C=V*ce;return{scale:ce,startX:(r()-ue)/2+a(h),startY:(s()-C)/2+a(m),bounds:a(H)}});Ft(()=>{a(p)&&a(Y)&&Z()}),Jt(()=>{a(p)&&(u(f,a(p).getContext("2d"),!0),Z())});function R(I){let V=1/0,ae=1/0,te=-1/0,j=-1/0,B=!1;I.program_width&&I.program_height&&(V=0,ae=0,te=I.program_width,j=I.program_height,B=!0);for(const W of I.parts){W.x,W.y;let se=0,ce=0;for(const ue of W.contours)for(const C of ue.commands)if(C.x!==void 0&&(se=C.x),C.y!==void 0&&(ce=C.y),C.x!==void 0||C.y!==void 0){B=!0;const T=W.x-(W.minX||0)+se,Q=W.y-(W.minY||0)+ce;T<V&&(V=T),T>te&&(te=T),Q<ae&&(ae=Q),Q>j&&(j=Q)}}return B?{minX:V,minY:ae,maxX:te,maxY:j}:{minX:0,minY:0,maxX:100,maxY:100}}function X(I,V){return{x:(I-a(Y).startX)/a(Y).scale+a(Y).bounds.minX,y:(s()-V-a(Y).startY)/a(Y).scale+a(Y).bounds.minY}}function Z(){if(!a(f)||!n()||!a(Y))return;a(f).fillStyle="#1e1e1e",a(f).fillRect(0,0,r(),s());const{scale:I,startX:V,startY:ae,bounds:te}=a(Y),j=(W,se=0)=>V+(W+se-te.minX)*I,B=(W,se=0)=>s()-(ae+(W+se-te.minY)*I);if(n().program_width&&n().program_height&&(a(f).strokeStyle="#444",a(f).lineWidth=2,a(f).setLineDash([5,5]),a(f).strokeRect(j(0),B(n().program_height),n().program_width*I,n().program_height*I),a(f).setLineDash([])),n().nestingArea&&(a(f).strokeStyle="rgba(0, 255, 0, 0.5)",a(f).lineWidth=2,a(f).setLineDash([10,5]),a(f).strokeRect(j(n().nestingArea.x),B(n().nestingArea.y+n().nestingArea.height),n().nestingArea.width*I,n().nestingArea.height*I),a(f).fillStyle="rgba(0, 255, 0, 0.05)",a(f).fillRect(j(n().nestingArea.x),B(n().nestingArea.y+n().nestingArea.height),n().nestingArea.width*I,n().nestingArea.height*I),a(f).setLineDash([])),a(z)&&a(E)&&a(P)){const W=Math.min(a(E).x,a(P).x),se=Math.min(a(E).y,a(P).y),ce=Math.max(a(E).x,a(P).x),ue=Math.max(a(E).y,a(P).y);a(f).strokeStyle="rgba(0, 255, 0, 0.8)",a(f).lineWidth=2,a(f).strokeRect(j(W),B(ue),(ce-W)*I,(ue-se)*I)}n().parts.forEach((W,se)=>{const ce=se*137%360,ue=(W.x||0)-(W.minX||0),C=(W.y||0)-(W.minY||0);W.contours.forEach(T=>{const Q=`${W.id}-${T.id}`,me=a(M)===Q,Me=a(D)===Q;a(f).beginPath(),a(f).strokeStyle=me?"#ffffff":Me?"#fbbf24":`hsl(${ce}, 70%, 60%)`,a(f).lineWidth=me||Me?3:1.5,a(f).shadowBlur=me?10:Me?5:0,a(f).shadowColor=me?"#ffffff":Me?"#fbbf24":"transparent";let Be=null,Ge=null,et=!1;T.commands.forEach(xe=>{const Le=Be,he=Ge;if(xe.x!==void 0&&(Be=xe.x),xe.y!==void 0&&(Ge=xe.y),!(Be===null||Ge===null)){if(xe.type==="G00"||xe.command==="G"&&xe.value===0)a(f).moveTo(j(Be,ue),B(Ge,C)),et=!0;else if(xe.type==="G01"||xe.command==="G"&&xe.value===1||xe.type==="MODAL"||xe.type==="G41"||xe.type==="G40")et?a(f).lineTo(j(Be,ue),B(Ge,C)):(a(f).moveTo(j(Be,ue),B(Ge,C)),et=!0);else if((xe.type==="G02"||xe.type==="G03"||xe.command==="G"&&(xe.value===2||xe.value===3))&&xe.i!==void 0&&xe.j!==void 0&&Le!==null&&he!==null){const Ye=xe.i,F=xe.j,be=Le+Ye,Ie=he+F,tt=Math.sqrt(Ye*Ye+F*F),at=j(be,ue),yt=B(Ie,C),wt=tt*I,Bt=Math.atan2(B(he,C)-yt,j(Le,ue)-at),Rt=Math.atan2(B(Ge,C)-yt,j(Be,ue)-at),N=xe.type==="G02"||xe.command==="G"&&xe.value===2;a(f).arc(at,yt,wt,Bt,Rt,N)}}}),a(f).stroke(),a(f).shadowBlur=0})}),d()&&n().parts.forEach(W=>{const se=W.x||0,ce=W.y||0;(v()==="bbox"||!W.polygon)&&(a(f).strokeStyle="rgba(255, 0, 0, 0.8)",a(f).lineWidth=1,a(f).setLineDash([2,2]),a(f).strokeRect(j(0,se),B(W.height||0,ce),(W.width||0)*I,(W.height||0)*I)),v()==="hull"&&W.polygon&&(a(f).beginPath(),a(f).strokeStyle="rgba(0, 255, 255, 0.8)",a(f).lineWidth=1,a(f).setLineDash([]),W.polygon.forEach((ue,C)=>{const T=j(ue.x,se),Q=B(ue.y,ce);C===0?a(f).moveTo(T,Q):a(f).lineTo(T,Q)}),a(f).closePath(),a(f).stroke(),a(f).fillStyle="rgba(0, 255, 255, 0.2)",a(f).fill()),a(f).setLineDash([])})}function J(I,V){if(!n())return null;const ae=a(p).getBoundingClientRect(),te=I-ae.left,j=V-ae.top,B=X(te,j),W=B.x,se=B.y,ce=5/a(Y).scale;let ue=null,C=null,T=1/0;for(const Q of n().parts){const me=(Q.x||0)-(Q.minX||0),Me=(Q.y||0)-(Q.minY||0);for(const Be of Q.contours){let Ge=null,et=null,xe=1/0;for(const Le of Be.commands){const he=Le.x!==void 0?Le.x:Ge,Ye=Le.y!==void 0?Le.y:et;let F=1/0;if(Ge!==null&&et!==null&&he!==null&&Ye!==null){if(Le.type==="G01"||Le.command==="G"&&Le.value===1||Le.type==="MODAL"||Le.type==="G41"||Le.type==="G40")F=re(W,se,Ge+me,et+Me,he+me,Ye+Me);else if(Le.type==="G02"||Le.type==="G03"||Le.command==="G"&&(Le.value===2||Le.value===3)){const be=Le.i||0,Ie=Le.j||0,tt=Ge+be+me,at=et+Ie+Me,yt=Math.sqrt(be*be+Ie*Ie),wt=Math.sqrt((W-tt)**2+(se-at)**2);F=Math.abs(wt-yt);const Bt=Math.atan2(et+Me-at,Ge+me-tt),Rt=Math.atan2(Ye+Me-at,he+me-tt),N=Math.atan2(se-at,W-tt),K=Le.type==="G02"||Le.command==="G"&&Le.value===2;ge(N,Bt,Rt,K)||(F=1/0)}}F<xe&&(xe=F),Ge=he,et=Ye}xe<ce&&xe<T&&(T=xe,ue=Be,C=Q)}}return ue?{contour:ue,part:C}:null}function O(I){const V=J(I.clientX,I.clientY);V?(u(M,`${V.part.id}-${V.contour.id}`),i()&&i()(V)):(u(M,null),i()&&i()(null)),Z()}function re(I,V,ae,te,j,B){const W=I-ae,se=V-te,ce=j-ae,ue=B-te,C=W*ce+se*ue,T=ce*ce+ue*ue;let Q=-1;T!=0&&(Q=C/T);let me,Me;Q<0?(me=ae,Me=te):Q>1?(me=j,Me=B):(me=ae+Q*ce,Me=te+Q*ue);const Be=I-me,Ge=V-Me;return Math.sqrt(Be*Be+Ge*Ge)}function ie(I){I.preventDefault();const V=a(p).getBoundingClientRect(),ae=I.clientX-V.left,te=I.clientY-V.top,j=X(ae,te),B=I.deltaY>0?.9:1.1,W=Math.max(.1,Math.min(10,a(_)*B));if(a(Y).scale===0||a(_)===0)return;const ce=a(Y).scale/a(_)*W,ue=a(Y).bounds.maxX-a(Y).bounds.minX,C=a(Y).bounds.maxY-a(Y).bounds.minY,T=ue*ce,Q=C*ce,me=ae-(j.x-a(Y).bounds.minX)*ce,Me=s()-te-(j.y-a(Y).bounds.minY)*ce;u(h,me-(r()-T)/2),u(m,Me-(s()-Q)/2),u(_,W,!0),Z()}function de(I){u(S,I.clientX,!0),u(w,I.clientY,!0);const V=a(p).getBoundingClientRect();a(k)==="navigate"?u(x,!0):a(k)==="nestArea"&&(u(z,!0),u(E,X(I.clientX-V.left,I.clientY-V.top),!0),u(P,a(E),!0))}function ve(I){if(a(k)==="navigate"&&a(x)){const V=I.clientX-a(S),ae=I.clientY-a(w);u(h,a(h)+V),u(m,a(m)-ae),u(S,I.clientX,!0),u(w,I.clientY,!0),Z()}else if(a(k)==="select"){const V=J(I.clientX,I.clientY),ae=V?`${V.part.id}-${V.contour.id}`:null;ae!==a(D)&&(u(D,ae,!0),Z())}else if(a(k)==="nestArea"&&a(z)){const V=a(p).getBoundingClientRect();u(P,X(I.clientX-V.left,I.clientY-V.top),!0),Z()}}function le(){a(D)!==null&&(u(D,null),Z()),a(x)&&u(x,!1)}function _e(I){const V=Math.abs(I.clientX-a(S)),ae=Math.abs(I.clientY-a(w)),te=V<5&&ae<5;if(a(k)==="navigate")u(x,!1);else if(a(k)==="select")te&&O(I);else if(a(k)==="nestArea"&&a(z)){u(z,!1);const j=Math.min(a(E).x,a(P).x),B=Math.min(a(E).y,a(P).y),W=Math.max(a(E).x,a(P).x),se=Math.max(a(E).y,a(P).y),ce={x:j,y:B,width:W-j,height:se-B};ce.width>5&&ce.height>5&&c()&&c()(ce),Z()}}function ge(I,V,ae,te){const j=Math.PI*2,B=(I%j+j)%j,W=(V%j+j)%j,se=(ae%j+j)%j;if(te){const ce=(W-se+j)%j;return(W-B+j)%j<=ce}else{const ce=(se-W+j)%j;return(B-W+j)%j<=ce}}function Pe(){u(_,1),u(h,0),u(m,0),Z()}var ke=Ed(),$=l(ke),A=l($);A.__click=()=>u(k,"navigate");let U;var ne=o(A,2);ne.__click=()=>u(k,"select");let ee;var oe=o(ne,2);oe.__click=()=>u(k,"nestArea");let qe;var ye=o($,2);ye.__mousedown=de,ye.__mousemove=ve,ye.__mouseup=_e,Ns(ye,I=>u(p,I),()=>a(p));var Oe=o(ye,2),fe=l(Oe);fe.__click=Pe;var Se=o(fe,2),pe=l(Se);G(I=>{cn(ke,`width: ${r()??""}px; height: ${s()??""}px;`),U=$e(A,1,"svelte-1eph566",null,U,{active:a(k)==="navigate"}),ee=$e(ne,1,"svelte-1eph566",null,ee,{active:a(k)==="select"}),qe=$e(oe,1,"svelte-1eph566",null,qe,{active:a(k)==="nestArea"}),Qe(ye,"width",r()),Qe(ye,"height",s()),cn(ye,`cursor: ${a(k)==="navigate"?a(x)?"grabbing":"grab":"default"}`),q(pe,`${I??""}%`)},[()=>Math.round(a(_)*100)]),ha("wheel",ye,ie),ha("mouseleave",ye,le),g(t,ke),ct()}gt(["click","mousedown","mousemove","mouseup"]);var Ad=b('<span class="filename"> </span>'),Pd=b('<div><button class="sheet-tab svelte-57krl6"> </button> <button class="close-tab svelte-57krl6">×</button></div>'),Cd=b('<div class="loading svelte-57krl6">Processing...</div>'),Rd=b('<div class="placeholder svelte-57krl6"><p>No sheet active.</p> <button class="btn-primary svelte-57krl6">Create Blank Sheet</button></div>'),zd=b('<p class="hint-text">Select or create a sheet.</p>'),Md=b("<option> </option>"),Nd=b('<h3>Sheet Properties</h3> <div class="prop-group svelte-57krl6"><span class="label">Sheet Name:</span> <input type="text" placeholder="Sheet Name" class="svelte-57krl6"/></div> <div class="prop-group svelte-57krl6"><span class="label">Program Size (mm):</span> <div class="inline-inputs svelte-57krl6"><input type="number" step="0.1" class="svelte-57krl6"/> <span>×</span> <input type="number" step="0.1" class="svelte-57krl6"/></div></div> <div class="prop-group svelte-57krl6"><span class="label">Thickness (mm):</span> <input type="number" step="0.1" class="svelte-57krl6"/></div> <div class="prop-group svelte-57krl6"><span class="label">Cut Count:</span> <input type="number" min="1" class="svelte-57krl6"/></div> <div class="prop-group svelte-57krl6"><span class="label">Material:</span> <select class="svelte-57krl6"><option>Select Material</option><!></select></div> <div class="prop-group svelte-57krl6"><span class="label">Total Parts:</span> <span class="value"> </span></div>',1),Dd=b("<option> </option>"),Od=b('<div class="prop-group svelte-57krl6"><span class="label">Part Name:</span> <span class="value"> </span></div> <div class="prop-group svelte-57krl6"><span class="label">Contours:</span> <span class="value"> </span></div>',1),Id=b('<h3>Part Properties</h3> <div class="prop-group svelte-57krl6"><span class="label">Select Part:</span> <select class="svelte-57krl6"></select></div> <!> <button class="delete-btn svelte-57krl6">Remove Part</button>',1),Ld=b('<div><div class="info svelte-57krl6"><span class="name svelte-57krl6"> </span> <span class="stats svelte-57krl6"> </span></div> <button class="add-btn svelte-57krl6">+</button></div>'),$d=b('<p class="empty-text">No matching tasks.</p>'),Fd=b('<button class="lib-item svelte-57krl6"> </button>'),Bd=b('<p class="empty-text">No matching library parts.</p>'),Ud=b('<div class="pagination-controls svelte-57krl6"><button class="page-btn svelte-57krl6">←</button> <span class="page-info svelte-57krl6"> </span> <button class="page-btn svelte-57krl6">→</button></div>'),Gd=b('<h3>Inventory</h3> <div class="search-bar svelte-57krl6"><input type="text" placeholder="Search parts..." class="svelte-57krl6"/></div> <div class="inventory-list"><!> <!></div> <h4 class="section-title svelte-57krl6">Library Parts</h4> <div class="library-grid svelte-57krl6"><!> <!></div> <!>',1),Yd=b('<div class="prop-field"><label> </label> <input type="text" class="svelte-57krl6"/></div>'),Xd=b('<p class="empty-props">No parameters found.</p>'),Jd=b('<div class="prop-group svelte-57krl6"><span class="label">Contour ID:</span> <span class="value"> </span></div> <h4 class="section-title svelte-57krl6">P-Codes</h4> <div class="p-codes-list"><!></div>',1),Wd=b("<h3>Contour Properties</h3> <!>",1),Hd=b('<div class="view-container"><div class="header"><input type="file" id="gnc-upload-input" accept=".gnc,.nc" class="hidden-input svelte-57krl6"/> <!> <div class="nest-controls svelte-57krl6"><select class="nest-mode-select svelte-57krl6"><option>Precise Hull</option><option>Bounding Box</option></select> <label class="debug-toggle svelte-57krl6"><input type="checkbox" class="svelte-57krl6"/> Debug</label></div></div> <div class="sheet-tabs svelte-57krl6"><!> <button class="add-sheet-btn svelte-57krl6">+ Add Sheet</button></div> <div class="workspace svelte-57krl6"><div class="canvas-area svelte-57krl6"><!></div> <div class="properties-panel svelte-57krl6"><div class="mode-selector svelte-57krl6"><button>Sheet</button> <button>Part</button> <button>Contour</button> <button>Inventory</button></div> <!></div></div></div>');function Zd(t,e){ot(e,!0);let n=bt(e,"documentId",3,null),r=bt(e,"orderId",7,null),s=y(Ne([])),i=y(0),c=Ze(()=>a(s)[a(i)]||null),d=y(null),v=y(""),p=y(!1),f=y(!1),_=y(Ne([])),h=y(Ne([])),m=y(Ne([])),x=y(Ne([])),S=y("sheet"),w=y(null),k=y(24),z=y(""),E=y(1),P=y("hull");const M=Ze(()=>a(h).filter(N=>N.name.toLowerCase().includes(a(z).toLowerCase()))),D=Ze(()=>a(m).filter(N=>N.name.toLowerCase().includes(a(z).toLowerCase()))),H=Ze(()=>Math.ceil(a(D).length/a(k))),Y=Ze(()=>a(D).slice((a(E)-1)*a(k),a(E)*a(k)));Ft(()=>{a(z),u(E,1)});async function R(){if(r()||n())try{r()?(u(_,await Fo(r()),!0),await X()):u(_,await bo(n()),!0),O()}catch(K){console.error("Failed to load tasks",K)}}async function X(){if(r())try{u(p,!0);const N=await Uo(r());N&&N.sheets&&(u(s,N.sheets.map(K=>({...K.data,name:K.name,task_id:K.data.task_id||null})),!0),a(s).length>0&&u(i,0))}catch(N){console.warn("No existing nesting project found for this order, starting fresh.",N)}finally{u(p,!1)}}async function Z(N){const K=N.target?N.target.files[0]:N;if(K){u(v,K.name,!0),u(p,!0),u(s,[],!0),u(i,0),u(d,null);try{const we=await zo(K);if(u(s,[we],!0),O(),we?.parts?.length>0&&u(w,we.parts[0].id,!0),$){const Ue=JSON.parse(JSON.stringify(we));$.postMessage({type:"ANALYZE_SHEET",payload:{sheet:Ue}})}}catch(we){alert("Error parsing GNC file"),console.error(we)}finally{u(p,!1)}}}function J(){document.getElementById("gnc-upload-input").click()}function O(){if(!a(_)||a(_).length===0){u(h,[],!0);return}const N={};a(s).forEach(K=>{K.parts.forEach(we=>{const Ue=we.taskId;Ue&&(N[Ue]=(N[Ue]||0)+1)})}),u(h,a(_).map(K=>{const we=K.quantity||1,Ue=N[K.id]||0;return{...K,placed:Ue,total:we,remaining:Math.max(0,we-Ue)}}),!0)}function re(N=null){const K={parts:[],metadata:{},total_parts:0,total_contours:0,program_width:N?.width||3e3,program_height:N?.height||1500,thickness:0,cut_count:1,material:N?.material||"Steel",name:N?.name||`Sheet ${a(s).length+1}`,task_id:N?.task_id||null};u(s,[...a(s),K],!0),u(i,a(s).length-1),le()}function ie(N){a(s).length<=1||(u(s,a(s).filter((K,we)=>we!==N),!0),a(i)>=a(s).length&&u(i,a(s).length-1),le(),O())}let de=y(Ne([])),ve=y(-1);function le(){if(a(s).length===0)return;const N=JSON.parse(JSON.stringify(a(s)));a(ve)<a(de).length-1&&u(de,a(de).slice(0,a(ve)+1),!0),a(de).push(N),tn(ve),a(de).length>50&&(a(de).shift(),tn(ve,-1))}function _e(){a(ve)>0&&(tn(ve,-1),u(s,JSON.parse(JSON.stringify(a(de)[a(ve)])),!0),O())}function ge(){a(ve)<a(de).length-1&&(tn(ve),u(s,JSON.parse(JSON.stringify(a(de)[a(ve)])),!0),O())}async function Pe(N){if(!a(c)){alert("Please create or load a sheet first.");return}if(!(N.remaining<=0&&!a(h).find(K=>K.id===N.id))){if(N.remaining<=0){alert("All instances of this task are already placed.");return}}try{le();let K=null;if(N.part_associations&&N.part_associations.length>0)K=N.part_associations[0].part_id;else if(N.id&&!N.document_id)K=N.id;else{alert("This task is not linked to a part geometry.");return}const we=await lr(K);if(!we||!we.parts||we.parts.length===0){alert("No geometry found for this part.");return}console.log("Placed Part GNC Data:",{partId:K,totalPartsInGnc:we.parts.length,firstPartContours:we.parts[0].contours.length,allParts:we.parts.map(_t=>({name:_t.name,contours:_t.contours.length}))});let Ue=we.parts.find(_t=>_t.name&&(_t.name.includes(N.name)||N.name.includes(_t.name)));Ue||(console.warn(`Could not find geometry matching name "${N.name}", defaulting to first part.`),Ue=we.parts[0]);const zt=Math.max(...a(s).flatMap(_t=>_t.parts).map(_t=>_t.id),0)+1,Ve=50,Te=a(c).program_width||2e3,dt=a(c).program_height||1e3,jt=Ve+Math.random()*Math.max(0,Te-Ve*2-200),At=Ve+Math.random()*Math.max(0,dt-Ve*2-200),Pt={...Ue,id:zt,name:N.name,taskId:N.id,metadata:{...Ue.metadata||{},source_part_id:K},x:jt,y:At};if(a(c).parts=[...a(c).parts,Pt],a(c).total_parts=a(c).parts.length,a(c).total_parts=a(c).parts.length,O(),$){const _t=JSON.parse(JSON.stringify(a(c)));$.postMessage({type:"ANALYZE_SHEET",payload:{sheet:_t}})}}catch(K){console.error(K),alert("Failed to place part.")}}function ke(N){a(c)&&(le(),a(c).parts=a(c).parts.filter(K=>K.id!==N),a(c).total_parts=a(c).parts.length,a(w)===N&&(u(w,null),u(S,"sheet")),O())}let $=null,A=y(!1),U=y(0);Ft(()=>{(r()||n())&&R()}),Jt(()=>($o().then(N=>u(m,N,!0)).catch(console.error),Va().then(N=>u(x,N,!0)).catch(console.error),va("gnc_library_page_size").then(N=>{N.value&&u(k,parseInt(N.value),!0)}).catch(()=>{}),window.Worker&&($=new Worker(new URL("/assets/NestingWorker-D-7XhhTZ.js",import.meta.url),{type:"module"}),$.onmessage=N=>{const{type:K,payload:we}=N.data;if(K==="PROGRESS")u(U,we,!0);else if(K==="COMPLETE"){u(A,!1),console.log("COMPLETE payload",we);const{sheets:Ue}=we;u(s,Ue,!0),O(),le(),alert("Nesting complete!")}else if(K==="STOPPED")u(A,!1);else if(K==="ANALYSIS_COMPLETE"){const{sheetId:Ue,parts:zt}=we,Ve=a(s).findIndex(Te=>Te.id===Ue||Te.id===void 0&&Ue===void 0);Ve!==-1&&(a(s)[Ve].parts=zt,a(i)===Ve&&u(s,[...a(s)],!0),console.log("Analysis complete for sheet",Ue))}}),Qa([{label:"File",items:[{label:"Open File",action:J},{label:"Save Changes",action:qe},{label:"Save as New Order",action:ye}]},{label:"Edit",items:[{label:"Undo",action:_e},{label:"Redo",action:ge}]},{label:"Nesting",items:[{label:"Auto Nest",action:()=>ee(!1)},{label:"Re-nest All",action:()=>ee(!0)},{label:"Unplace All",action:ne}]}]),()=>{Ka(),$&&$.terminate()}));function ne(){a(c)&&(le(),a(c).parts=[],O())}async function ee(N=!1){if(!$||a(s).length===0)return;if(a(A)){$.postMessage({type:"STOP_NESTING"});return}let K=[];N?(K=JSON.parse(JSON.stringify(a(h))).map(Te=>(Te.remaining=Te.total,Te)),a(s).forEach(Te=>{Te.parts.forEach(dt=>{if(!a(h).some(At=>At.id===dt.taskId)){let At=K.find(Pt=>Pt.id===(dt.taskId||dt.id));At?(At.remaining++,At.total++):K.push({...dt,id:dt.taskId||dt.id,total:1,remaining:1,isLibraryPart:!0})}})}),le(),a(s).forEach(Te=>{Te.parts=[]}),O()):K=JSON.parse(JSON.stringify(a(h).filter(Te=>Te.remaining>0))),u(A,!0),u(U,0),console.log(`GncView: Preparing geometries for ${K.length} items (isReNest: ${N})`);for(let Te of K){if(Te.contours&&Te.contours.length>0)continue;let dt=null;if(Te.part_associations&&Te.part_associations.length>0?dt=Te.part_associations[0].part_id:Te.id&&!Te.document_id&&(dt=Te.id),dt)try{const jt=await lr(dt);if(jt?.parts?.length>0){let At=jt.parts.find(Pt=>Pt.name&&(Pt.name.includes(Te.name)||Te.name.includes(Pt.name)))||jt.parts[0];Te.contours=At.contours,Te.taskId=Te.id}}catch(jt){console.error(`GncView: Failed to fetch geometry for ${Te.name}`,jt)}}let we=4,Ue=10,zt=5;try{const[Te,dt,jt]=await Promise.all([va("nesting_rotations").catch(()=>({value:"4"})),va("nesting_population").catch(()=>({value:"10"})),va("nesting_spacing").catch(()=>({value:"5"}))]);we=parseInt(Te.value)||4,Ue=parseInt(dt.value)||10,zt=parseFloat(jt.value)||5}catch(Te){console.warn("Using default nesting settings",Te)}const Ve={rotations:we,population:Ue,spacing:zt,multiSheet:!0,nestingMode:a(P)};$.postMessage({type:"START_NESTING",payload:{sheets:JSON.parse(JSON.stringify(a(s))),inventory:JSON.parse(JSON.stringify(K)),stock:[],config:Ve}})}function oe(N){if(!N){u(d,null);return}N.contour&&(u(d,N.contour,!0),N.part?(u(w,N.part.id,!0),a(S)==="sheet"&&u(S,"contour")):u(S,"contour"))}async function qe(){if(a(s).length!==0)try{u(p,!0);const N={order_id:r(),name:a(v)||"Nesting Project",sheets:a(s).map((K,we)=>({id:we,name:K.name||`Sheet ${we+1}`,data:K})),inventory:a(_),stock:[]};r()?await Bo(N):await Mo(a(c),a(v),!0),alert("Project saved successfully!")}catch(N){alert("Failed to save project: "+N.message)}finally{u(p,!1)}}async function ye(){if(a(s).length===0)return;const N=prompt("Enter name for the new Order:");if(N)try{const K=a(s).map((Ue,zt)=>({name:Ue.metadata?.program_name||`Sheet ${zt+1}`,data:Ue})),we=await wo(N,K,n());alert(`New Order "${we.name}" created successfully!`),Ja(`/gnc?orderId=${we.id}`),r(we.id),R()}catch(K){console.error(K),alert("Failed to save as new order: "+K.message)}}function Oe(N,K){a(d)&&a(d).metadata&&(a(d).metadata[N]=K)}function fe(N,K){a(c)&&(a(c)[N]=K)}let Se=Ze(()=>a(c)?.parts?.find(N=>N.id===a(w)));var pe=Hd(),I=l(pe),V=l(I);V.__change=Z;var ae=o(V,2);{var te=N=>{var K=Ad(),we=l(K);G(()=>q(we,a(v))),g(N,K)};L(ae,N=>{a(v)&&N(te)})}var j=o(ae,2),B=l(j),W=l(B);W.value=W.__value="hull";var se=o(W);se.value=se.__value="bbox";var ce=o(B,2),ue=l(ce),C=o(I,2),T=l(C);Ae(T,17,()=>a(s),Fe,(N,K,we)=>{var Ue=Pd();let zt;var Ve=l(Ue);Ve.__click=()=>u(i,we,!0);var Te=l(Ve),dt=o(Ve,2);dt.__click=()=>ie(we),G(()=>{zt=$e(Ue,1,"tab-wrapper svelte-57krl6",null,zt,{active:a(i)===we}),q(Te,a(K).name||`Sheet ${we+1}`)}),g(N,Ue)});var Q=o(T,2);Q.__click=()=>re();var me=o(C,2),Me=l(me),Be=l(Me);{var Ge=N=>{var K=Cd();g(N,K)},et=N=>{var K=lt(),we=je(K);{var Ue=Ve=>{jd(Ve,{get sheet(){return a(c)},get showDebug(){return a(f)},get nestingMode(){return a(P)},width:800,height:600,onselect:oe,onAreaChange:Te=>{a(c).nestingArea=Te,le()}})},zt=Ve=>{var Te=Rd(),dt=o(l(Te),2);dt.__click=()=>re(),g(Ve,Te)};L(we,Ve=>{a(c)?Ve(Ue):Ve(zt,!1)},!0)}g(N,K)};L(Be,N=>{a(p)?N(Ge):N(et,!1)})}var xe=o(Me,2),Le=l(xe),he=l(Le);he.__click=()=>u(S,"sheet");let Ye;var F=o(he,2);F.__click=()=>u(S,"part");let be;var Ie=o(F,2);Ie.__click=()=>u(S,"contour");let tt;var at=o(Ie,2);at.__click=()=>u(S,"inventory");let yt;var wt=o(Le,2);{var Bt=N=>{var K=zd();g(N,K)},Rt=N=>{var K=lt(),we=je(K);{var Ue=Ve=>{var Te=Nd(),dt=o(je(Te),2),jt=o(l(dt),2);jt.__input=vt=>fe("name",vt.currentTarget.value);var At=o(dt,2),Pt=o(l(At),2),_t=l(Pt);_t.__input=vt=>fe("program_width",parseFloat(vt.currentTarget.value));var na=o(_t,4);na.__input=vt=>fe("program_height",parseFloat(vt.currentTarget.value));var sa=o(At,2),oa=o(l(sa),2);oa.__input=vt=>fe("thickness",parseFloat(vt.currentTarget.value));var Wt=o(sa,2),Ut=o(l(Wt),2);Ut.__input=vt=>fe("cut_count",parseInt(vt.currentTarget.value));var Mt=o(Wt,2),xt=o(l(Mt),2);xt.__change=vt=>fe("material",vt.currentTarget.value);var Ee=l(xt);Ee.value=Ee.__value="";var He=o(Ee);Ae(He,17,()=>a(x),Fe,(vt,Ct)=>{var Ot=Md(),Gt=l(Ot),De={};G(()=>{q(Gt,a(Ct).name),De!==(De=a(Ct).name)&&(Ot.value=(Ot.__value=a(Ct).name)??"")}),g(vt,Ot)});var rt;qn(xt);var qt=o(Mt,2),Xe=o(l(qt),2),mt=l(Xe);G(()=>{nn(jt,a(c).name||""),nn(_t,a(c).program_width||0),nn(na,a(c).program_height||0),nn(oa,a(c).thickness||0),nn(Ut,a(c).cut_count||1),rt!==(rt=a(c).material||"")&&(xt.value=(xt.__value=a(c).material||"")??"",vn(xt,a(c).material||"")),q(mt,a(c).total_parts)}),g(Ve,Te)},zt=Ve=>{var Te=lt(),dt=je(Te);{var jt=Pt=>{var _t=Id(),na=o(je(_t),2),sa=o(l(na),2);Ae(sa,21,()=>a(c).parts,Fe,(Mt,xt)=>{var Ee=Dd(),He=l(Ee),rt={};G(()=>{q(He,a(xt).name||`Part ${a(xt).id}`),rt!==(rt=a(xt).id)&&(Ee.value=(Ee.__value=a(xt).id)??"")}),g(Mt,Ee)});var oa=o(na,2);{var Wt=Mt=>{var xt=Od(),Ee=je(xt),He=o(l(Ee),2),rt=l(He),qt=o(Ee,2),Xe=o(l(qt),2),mt=l(Xe);G(()=>{q(rt,a(Se).name||"N/A"),q(mt,a(Se).contours.length)}),g(Mt,xt)};L(oa,Mt=>{a(Se)&&Mt(Wt)})}var Ut=o(oa,2);Ut.__click=()=>ke(a(w)),Et(sa,()=>a(w),Mt=>u(w,Mt)),g(Pt,_t)},At=Pt=>{var _t=lt(),na=je(_t);{var sa=Wt=>{var Ut=Gd(),Mt=o(je(Ut),2),xt=l(Mt),Ee=o(Mt,2),He=l(Ee);Ae(He,17,()=>a(M),Fe,(De,Je)=>{var pt=Ld();let ht;var St=l(pt),Nt=l(St),Yt=l(Nt),ca=o(Nt,2),it=l(ca),ft=o(St,2);ft.__click=()=>Pe(a(Je)),G(()=>{ht=$e(pt,1,"inventory-item svelte-57krl6",null,ht,{complete:a(Je).remaining===0}),q(Yt,a(Je).name),q(it,`${a(Je).placed??""} / ${a(Je).total??""}`),ft.disabled=a(Je).remaining<=0}),g(De,pt)});var rt=o(He,2);{var qt=De=>{var Je=$d();g(De,Je)};L(rt,De=>{a(M).length===0&&De(qt)})}var Xe=o(Ee,4),mt=l(Xe);Ae(mt,17,()=>a(Y),Fe,(De,Je)=>{var pt=Fd();pt.__click=()=>Pe(a(Je));var ht=l(pt);G(()=>q(ht,a(Je).name)),g(De,pt)});var vt=o(mt,2);{var Ct=De=>{var Je=Bd();g(De,Je)};L(vt,De=>{a(D).length===0&&De(Ct)})}var Ot=o(Xe,2);{var Gt=De=>{var Je=Ud(),pt=l(Je);pt.__click=()=>tn(E,-1);var ht=o(pt,2),St=l(ht),Nt=o(ht,2);Nt.__click=()=>tn(E),G(()=>{pt.disabled=a(E)===1,q(St,`Page ${a(E)??""} of ${a(H)??""}`),Nt.disabled=a(E)===a(H)}),g(De,Je)};L(Ot,De=>{a(H)>1&&De(Gt)})}Ce(xt,()=>a(z),De=>u(z,De)),g(Wt,Ut)},oa=Wt=>{var Ut=lt(),Mt=je(Ut);{var xt=Ee=>{var He=Wd(),rt=o(je(He),2);{var qt=Xe=>{var mt=Jd(),vt=je(mt),Ct=o(l(vt),2),Ot=l(Ct),Gt=o(vt,4),De=l(Gt);{var Je=ht=>{var St=lt(),Nt=je(St);Ae(Nt,17,()=>Object.entries(a(d).metadata),Fe,(Yt,ca)=>{var it=Ze(()=>xn(a(ca),2));let ft=()=>a(it)[0],It=()=>a(it)[1];var La=lt(),Kn=je(La);{var Ti=es=>{var Js=Yd(),ts=l(Js),qi=l(ts),as=o(ts,2);as.__input=Ei=>Oe(ft(),Ei.currentTarget.value),G(()=>{Qe(ts,"for",ft()),q(qi,ft()),Qe(as,"id",ft()),nn(as,It())}),g(es,Js)};L(Kn,es=>{ft().startsWith("P")&&es(Ti)})}g(Yt,La)}),g(ht,St)},pt=ht=>{var St=Xd();g(ht,St)};L(De,ht=>{a(d).metadata?ht(Je):ht(pt,!1)})}G(()=>q(Ot,`#${a(d).id??""}`)),g(Xe,mt)};L(rt,Xe=>{a(d)&&Xe(qt)})}g(Ee,He)};L(Mt,Ee=>{a(S)==="contour"&&Ee(xt)},!0)}g(Wt,Ut)};L(na,Wt=>{a(S)==="inventory"?Wt(sa):Wt(oa,!1)},!0)}g(Pt,_t)};L(dt,Pt=>{a(S)==="part"?Pt(jt):Pt(At,!1)},!0)}g(Ve,Te)};L(we,Ve=>{a(S)==="sheet"?Ve(Ue):Ve(zt,!1)},!0)}g(N,K)};L(wt,N=>{a(c)?N(Rt,!1):N(Bt)})}G(()=>{Ye=$e(he,1,"svelte-57krl6",null,Ye,{active:a(S)==="sheet"}),be=$e(F,1,"svelte-57krl6",null,be,{active:a(S)==="part"}),tt=$e(Ie,1,"svelte-57krl6",null,tt,{active:a(S)==="contour"}),yt=$e(at,1,"svelte-57krl6",null,yt,{active:a(S)==="inventory"})}),Et(B,()=>a(P),N=>u(P,N)),Vl(ue,()=>a(f),N=>u(f,N)),g(t,pe),ct()}gt(["change","click","input"]);var Vd=b("<option> </option>"),Qd=b('<div class="form-panel svelte-gim6qq"><h3>New Stock Item</h3> <div class="form-grid svelte-gim6qq"><div class="field svelte-gim6qq"><label class="svelte-gim6qq">Material</label> <select class="svelte-gim6qq"><option>Select Material...</option><!></select></div> <div class="field svelte-gim6qq"><label class="svelte-gim6qq">Width (mm)</label> <input type="number" min="0" class="svelte-gim6qq"/></div> <div class="field svelte-gim6qq"><label class="svelte-gim6qq">Height (mm)</label> <input type="number" min="0" class="svelte-gim6qq"/></div> <div class="field svelte-gim6qq"><label class="svelte-gim6qq">Quantity</label> <input type="number" min="0" class="svelte-gim6qq"/></div> <div class="field svelte-gim6qq"><label class="svelte-gim6qq">Location</label> <input type="text" placeholder="e.g. A-01" class="svelte-gim6qq"/></div> <div class="actions"><button class="save-btn svelte-gim6qq">Save Item</button></div></div></div>'),Kd=b('<p class="loading svelte-gim6qq">Loading stock...</p>'),ef=b('<div class="empty-state svelte-gim6qq"><p>No stock items found.</p></div>'),tf=b('<tr><td class="svelte-gim6qq"> </td><td class="svelte-gim6qq"> </td><td class="svelte-gim6qq"> </td><td class="svelte-gim6qq"> </td><td class="svelte-gim6qq"> </td><td class="svelte-gim6qq"><button class="delete-btn svelte-gim6qq">Delete</button></td></tr>'),af=b('<div class="table-container svelte-gim6qq"><table class="svelte-gim6qq"><thead><tr><th class="svelte-gim6qq">Material</th><th class="svelte-gim6qq">Dimensions</th><th class="svelte-gim6qq">Qty</th><th class="svelte-gim6qq">Reserved</th><th class="svelte-gim6qq">Location</th><th class="svelte-gim6qq">Actions</th></tr></thead><tbody></tbody></table></div>'),nf=b('<div class="view-container svelte-gim6qq"><div class="header svelte-gim6qq"><h2 class="svelte-gim6qq">Stock Management</h2></div> <!> <!></div>');function sf(t,e){ot(e,!0);let n=y(Ne([])),r=y(Ne([])),s=y(!0),i=y(!1),c=y(Ne({material_id:"",width:0,height:0,quantity:0,location:""}));async function d(){u(s,!0);try{const[k,z]=await Promise.all([Po(),Va()]);u(n,k,!0),u(r,z,!0)}catch(k){console.error(k)}finally{u(s,!1)}}function v(){u(i,!a(i))}async function p(){if(a(c).material_id)try{const k=await Co(a(c));u(n,[...a(n),k],!0),u(i,!1),u(c,{material_id:"",width:0,height:0,quantity:0,location:""},!0)}catch(k){alert("Failed to add stock item"),console.error(k)}}async function f(k){if(confirm("Are you sure you want to delete this item?"))try{await Ro(k),u(n,a(n).filter(z=>z.id!==k),!0)}catch{alert("Failed to delete item")}}Jt(()=>(d(),Qa([{label:"Stock",items:[{label:"Add Stock",action:v},{label:"Refresh",action:d}]}]),()=>{Ka()}));var _=nf(),h=o(l(_),2);{var m=k=>{var z=Qd(),E=o(l(z),2),P=l(E),M=o(l(P),2),D=l(M);D.value=D.__value="";var H=o(D);Ae(H,17,()=>a(r),Fe,(le,_e)=>{var ge=Vd(),Pe=l(ge),ke={};G(()=>{q(Pe,a(_e).name),ke!==(ke=a(_e).id)&&(ge.value=(ge.__value=a(_e).id)??"")}),g(le,ge)});var Y=o(P,2),R=o(l(Y),2),X=o(Y,2),Z=o(l(X),2),J=o(X,2),O=o(l(J),2),re=o(J,2),ie=o(l(re),2),de=o(re,2),ve=l(de);ve.__click=p,Et(M,()=>a(c).material_id,le=>a(c).material_id=le),Ce(R,()=>a(c).width,le=>a(c).width=le),Ce(Z,()=>a(c).height,le=>a(c).height=le),Ce(O,()=>a(c).quantity,le=>a(c).quantity=le),Ce(ie,()=>a(c).location,le=>a(c).location=le),g(k,z)};L(h,k=>{a(i)&&k(m)})}var x=o(h,2);{var S=k=>{var z=Kd();g(k,z)},w=k=>{var z=lt(),E=je(z);{var P=D=>{var H=ef();g(D,H)},M=D=>{var H=af(),Y=l(H),R=o(l(Y));Ae(R,21,()=>a(n),Fe,(X,Z)=>{var J=tf(),O=l(J),re=l(O),ie=o(O),de=l(ie),ve=o(ie),le=l(ve),_e=o(ve),ge=l(_e),Pe=o(_e),ke=l(Pe),$=o(Pe),A=l($);A.__click=()=>f(a(Z).id),G(()=>{q(re,a(Z).material?a(Z).material.name:"Unknown"),q(de,`${a(Z).width??""} x ${a(Z).height??""}`),q(le,a(Z).quantity),q(ge,a(Z).reserved),q(ke,a(Z).location||"-")}),g(X,J)}),g(D,H)};L(E,D=>{a(n).length===0?D(P):D(M,!1)},!0)}g(k,z)};L(x,k=>{a(s)?k(S):k(w,!1)})}g(t,_),ct()}gt(["click"]);var rf=b("<p> </p>"),lf=b(`<div class="setup-container svelte-1125czv"><div class="card svelte-1125czv"><h1 class="svelte-1125czv">Welcome to DocuFlow</h1> <p class="subtitle svelte-1125czv">Please configure the database connection.</p> <div class="field svelte-1125czv"><label for="db-path" class="svelte-1125czv">Database File Path</label> <p class="help-text svelte-1125czv">Enter the full path to the SQLite database file. For network
                sharing, use a path on the shared drive (e.g., <code>Z:\\DocuFlow\\data.db</code>).</p> <div class="input-group svelte-1125czv"><input id="db-path" type="text" placeholder="C:\\DocuFlow\\data.db" class="svelte-1125czv"/> <button class="svelte-1125czv"> </button></div> <!></div> <div class="actions"><button class="primary svelte-1125czv"> </button></div></div></div>`);function of(t,e){ot(e,!0);let n=y(""),r=y(!1),s=y(null),i=y(!1);Jt(async()=>{try{const M=await(await fetch("/api/config")).json();M.database_path&&u(n,M.database_path,!0)}catch(P){console.error(P)}});async function c(){if(a(n)){u(r,!0),u(s,null);try{const M=await(await fetch("/api/test-path",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:a(n)})})).json();u(s,{ok:M.accessible||!M.exists,message:M.accessible?"Path exists and is readable.":M.exists?"Path exists but not readable.":"File does not exist (will be created)."},!0)}catch(P){u(s,{ok:!1,message:P.message},!0)}finally{u(r,!1)}}}async function d(){u(i,!0);try{(await(await fetch("/api/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({database_path:a(n)})})).json()).ok?(alert("Configuration saved. Please restart the application (Server) to apply changes."),kt.configStatus="configured",Ja("/")):alert("Failed to save config.")}catch(P){alert("Error saving config: "+P.message)}finally{u(i,!1)}}var v=lf(),p=l(v),f=o(l(p),4),_=o(l(f),4),h=l(_),m=o(h,2);m.__click=c;var x=l(m),S=o(_,2);{var w=P=>{var M=rf(),D=l(M);G(()=>{$e(M,1,`result ${a(s).ok?"success":"warn"}`,"svelte-1125czv"),q(D,a(s).message)}),g(P,M)};L(S,P=>{a(s)&&P(w)})}var k=o(f,2),z=l(k);z.__click=d;var E=l(z);G(()=>{m.disabled=a(r),q(x,a(r)?"Testing...":"Test Path"),z.disabled=a(i)||!a(n),q(E,a(i)?"Saving...":"Save Configuration")}),Ce(h,()=>a(n),P=>u(n,P)),g(t,v),ct()}gt(["click"]);var cf=b('<p class="loading svelte-k2dnon">Loading settings...</p>'),vf=b("<span> </span>"),uf=b("<span> </span>"),df=b(`<div class="card svelte-k2dnon"><div class="field svelte-k2dnon"><label for="regex" class="svelte-k2dnon">Document Name Regex</label> <input id="regex" type="text" placeholder="Regex Pattern" class="svelte-k2dnon"/></div> <hr class="divider svelte-k2dnon"/> <h3 class="section-title svelte-k2dnon">Sync Folder Paths</h3> <p class="section-hint svelte-k2dnon">Configure paths to network folders for automatic
                            file import.</p> <div class="field path-field svelte-k2dnon"><label for="mihtav-path" class="svelte-k2dnon">Mihtav (Orders) Path</label> <div class="path-input-group svelte-k2dnon"><input id="mihtav-path" type="text" placeholder="Z:\\Mihtavim or \\\\server\\share\\orders" class="svelte-k2dnon"/> <button class="test-btn svelte-k2dnon"> </button></div> <!></div> <div class="field path-field svelte-k2dnon"><label for="sidra-path" class="svelte-k2dnon">Sidra (Parts Library) Path</label> <div class="path-input-group svelte-k2dnon"><input id="sidra-path" type="text" placeholder="Z:\\Sidra or \\\\server\\share\\parts" class="svelte-k2dnon"/> <button class="test-btn svelte-k2dnon"> </button></div> <!></div> <div class="field svelte-k2dnon"><label for="role" class="svelte-k2dnon">User Mode (Simulated)</label> <select id="role" class="svelte-k2dnon"><option class="svelte-k2dnon">Operator (Read-Only)</option><option class="svelte-k2dnon">Admin (Full Access)</option></select> <p class="hint svelte-k2dnon">Switching mode will reload the application.</p></div> <hr class="divider svelte-k2dnon"/> <h3 class="section-title svelte-k2dnon">Editor Settings</h3> <div class="field svelte-k2dnon"><label for="gnc-page-size" class="svelte-k2dnon">GNC Library Page Size</label> <input id="gnc-page-size" type="number" min="1" max="100" class="svelte-k2dnon"/> <p class="hint svelte-k2dnon">Number of parts to show per page in the GNC
                                Editor's library.</p></div></div>`),ff=b(`<div class="card svelte-k2dnon"><h3 class="section-title svelte-k2dnon">Auto-Nesting Configuration</h3> <p class="section-hint svelte-k2dnon">Adjust parameters for the nesting algorithm
                            (SVGnest).</p> <div class="field svelte-k2dnon"><label for="rotations" class="svelte-k2dnon">Rotations</label> <input id="rotations" type="number" min="1" max="360" class="svelte-k2dnon"/> <p class="hint svelte-k2dnon">Number of rotation steps (e.g., 4 = 0, 90, 180,
                                270).</p></div> <div class="field svelte-k2dnon"><label for="population" class="svelte-k2dnon">Population Size</label> <input id="population" type="number" min="5" max="100" class="svelte-k2dnon"/> <p class="hint svelte-k2dnon">Higher values check more combinations but run
                                slower.</p></div> <div class="field svelte-k2dnon"><label for="spacing" class="svelte-k2dnon">Part Spacing (mm)</label> <input id="spacing" type="number" min="0" step="0.5" class="svelte-k2dnon"/> <p class="hint svelte-k2dnon">Minimum distance between parts.</p></div></div>`),pf=b('<div class="refresh-overlay svelte-k2dnon"><div class="spinner svelte-k2dnon"></div> <p class="svelte-k2dnon">Applying changes and refreshing system...</p></div>'),hf=b(`<div class="card svelte-k2dnon"><h3 class="section-title svelte-k2dnon">Database Storage</h3> <p class="section-hint svelte-k2dnon">Configure the location of the SQLite database file.</p> <div class="field svelte-k2dnon"><label for="db-path" class="svelte-k2dnon">Database Path</label> <input id="db-path" type="text" placeholder="e.g., sql_app.db or data/production.db" class="svelte-k2dnon"/> <p class="hint svelte-k2dnon">Provide a relative or absolute path. If the
                                directory doesn't exist, it will be created.</p></div> <!></div>`),_f=b('<div class="content-wrapper svelte-k2dnon"><div class="tabs svelte-k2dnon"><button>General</button> <button>Nesting</button> <button>Database</button></div> <div class="tab-content svelte-k2dnon"><!></div></div>'),gf=b('<div class="settings-view svelte-k2dnon"><div class="page-header svelte-k2dnon"><h2 class="svelte-k2dnon">Settings</h2> <button class="save-btn svelte-k2dnon">Save Changes</button></div> <!></div>');function mf(t,e){ot(e,!0);let n=y("general"),r=y(""),s=y("admin"),i=y(""),c=y(""),d=y(""),v=y(!1),p=y(4),f=y(10),_=y(5),h=y(24),m=y(!0),x=Ne({mihtav:!1,sidra:!1}),S=Ne({mihtav:null,sidra:null});async function w(){u(m,!0);try{const[R,X,Z,J,O,re,ie,de]=await Promise.all([va("doc_name_regex").catch(()=>({value:""})),va("sync_mihtav_path").catch(()=>({value:""})),va("sync_sidra_path").catch(()=>({value:""})),va("nesting_rotations").catch(()=>({value:"4"})),va("nesting_population").catch(()=>({value:"10"})),va("nesting_spacing").catch(()=>({value:"5"})),va("gnc_library_page_size").catch(()=>({value:"24"})),Go().catch(()=>({database_path:"sql_app.db"}))]);u(r,R.value||"",!0),u(i,X.value||"",!0),u(c,Z.value||"",!0),u(p,parseInt(J.value)||4,!0),u(f,parseInt(O.value)||10,!0),u(_,parseFloat(re?.value)||5,!0),u(h,parseInt(ie?.value)||24,!0),u(d,de.database_path,!0);const ve=localStorage.getItem("user_role");ve&&u(s,ve,!0)}catch(R){console.error(R)}finally{u(m,!1)}}async function k(R){const X=a(R==="mihtav"?i:c);if(!X){S[R]={accessible:!1,error:"Path is empty"};return}x[R]=!0;try{const Z=await vo(X);S[R]={accessible:Z.ok,error:Z.error}}catch(Z){S[R]={accessible:!1,error:Z.message}}finally{x[R]=!1}}async function z(){try{await Promise.all([$a("doc_name_regex",a(r)),$a("sync_mihtav_path",a(i)),$a("sync_sidra_path",a(c)),$a("nesting_population",a(f).toString()),$a("nesting_rotations",a(p).toString()),$a("nesting_spacing",a(_).toString()),$a("gnc_library_page_size",a(h).toString()),Yo({database_path:a(d)}).then(R=>{R.ok&&(u(v,!0),setTimeout(()=>{window.location.reload()},3e3))})]),localStorage.setItem("user_role",a(s)),a(v)||window.location.reload()}catch(R){alert("Failed to save settings. Ensure you have Admin privileges."),console.error(R)}}Jt(()=>{w()});var E=gf(),P=l(E),M=o(l(P),2);M.__click=z;var D=o(P,2);{var H=R=>{var X=cf();g(R,X)},Y=R=>{var X=_f(),Z=l(X),J=l(Z);J.__click=()=>u(n,"general");let O;var re=o(J,2);re.__click=()=>u(n,"nesting");let ie;var de=o(re,2);de.__click=()=>u(n,"database");let ve;var le=o(Z,2),_e=l(le);{var ge=ke=>{var $=df(),A=l($),U=o(l(A),2),ne=o(A,8),ee=o(l(ne),2),oe=l(ee),qe=o(oe,2);qe.__click=()=>k("mihtav");var ye=l(qe),Oe=o(ee,2);{var fe=T=>{var Q=vf();let me;var Me=l(Q);G(()=>{me=$e(Q,1,"test-result svelte-k2dnon",null,me,{success:S.mihtav.accessible,error:!S.mihtav.accessible}),q(Me,S.mihtav.accessible?"✓ Path accessible":`✗ ${S.mihtav.error||"Path not accessible"}`)}),g(T,Q)};L(Oe,T=>{S.mihtav&&T(fe)})}var Se=o(ne,2),pe=o(l(Se),2),I=l(pe),V=o(I,2);V.__click=()=>k("sidra");var ae=l(V),te=o(pe,2);{var j=T=>{var Q=uf();let me;var Me=l(Q);G(()=>{me=$e(Q,1,"test-result svelte-k2dnon",null,me,{success:S.sidra.accessible,error:!S.sidra.accessible}),q(Me,S.sidra.accessible?"✓ Path accessible":`✗ ${S.sidra.error||"Path not accessible"}`)}),g(T,Q)};L(te,T=>{S.sidra&&T(j)})}var B=o(Se,2),W=o(l(B),2),se=l(W);se.value=se.__value="operator";var ce=o(se);ce.value=ce.__value="admin";var ue=o(B,6),C=o(l(ue),2);G(()=>{qe.disabled=x.mihtav,q(ye,x.mihtav?"Testing...":"Test"),V.disabled=x.sidra,q(ae,x.sidra?"Testing...":"Test")}),Ce(U,()=>a(r),T=>u(r,T)),Ce(oe,()=>a(i),T=>u(i,T)),Ce(I,()=>a(c),T=>u(c,T)),Et(W,()=>a(s),T=>u(s,T)),Ce(C,()=>a(h),T=>u(h,T)),g(ke,$)},Pe=ke=>{var $=lt(),A=je($);{var U=ee=>{var oe=ff(),qe=o(l(oe),4),ye=o(l(qe),2),Oe=o(qe,2),fe=o(l(Oe),2),Se=o(Oe,2),pe=o(l(Se),2);Ce(ye,()=>a(p),I=>u(p,I)),Ce(fe,()=>a(f),I=>u(f,I)),Ce(pe,()=>a(_),I=>u(_,I)),g(ee,oe)},ne=ee=>{var oe=lt(),qe=je(oe);{var ye=Oe=>{var fe=hf(),Se=o(l(fe),4),pe=o(l(Se),2),I=o(Se,2);{var V=ae=>{var te=pf();g(ae,te)};L(I,ae=>{a(v)&&ae(V)})}Ce(pe,()=>a(d),ae=>u(d,ae)),g(Oe,fe)};L(qe,Oe=>{a(n)==="database"&&Oe(ye)},!0)}g(ee,oe)};L(A,ee=>{a(n)==="nesting"?ee(U):ee(ne,!1)},!0)}g(ke,$)};L(_e,ke=>{a(n)==="general"?ke(ge):ke(Pe,!1)})}G(()=>{O=$e(J,1,"svelte-k2dnon",null,O,{active:a(n)==="general"}),ie=$e(re,1,"svelte-k2dnon",null,ie,{active:a(n)==="nesting"}),ve=$e(de,1,"svelte-k2dnon",null,ve,{active:a(n)==="database"})}),g(R,X)};L(D,R=>{a(m)?R(H):R(Y,!1)})}g(t,E),ct()}gt(["click"]);const bf={"/":rc,"/documents":Nu,"/journal":Wu,"/job":nd,"/parts":qd,"/gnc":Zd,"/stock":sf,"/setup":of,"/settings":mf};var yf=b('<button class="svelte-zne36e"> </button>'),wf=b('<div class="submenu-group svelte-zne36e"><div class="submenu-title svelte-zne36e"> </div> <!></div>'),kf=b('<div class="divider-vertical svelte-zne36e"></div> <div class="dynamic-actions svelte-zne36e"></div>',1),xf=b('<div class="dropdown-menu svelte-zne36e"><div class="submenu-group svelte-zne36e"><div class="submenu-title svelte-zne36e">Views</div> <button>Dashboard</button> <button>Documents</button> <button>Parts Library</button> <button>GNC Editor</button> <button>Job Processing</button> <button>Stock</button> <button>Journal</button> <div class="divider svelte-zne36e"></div> <button>Settings</button></div> <!></div>'),Sf=b('<header class="app-header svelte-zne36e"><div class="menu-container svelte-zne36e"><button class="menu-btn svelte-zne36e" aria-label="Menu"><span class="icon">☰</span></button> <!></div> <div class="logo svelte-zne36e"><span class="logo-text">DocuFlow</span></div></header>');function Tf(t,e){ot(e,!0);let n=y(!1);function r(){u(n,!a(n))}function s(){u(n,!1)}function i(){u(n,!0)}function c(){u(n,!1)}function d(x){Ja(x),s()}function v(x){x&&x(),s()}var p=Sf(),f=l(p),_=l(f);_.__click=r;var h=o(_,2);{var m=x=>{var S=xf(),w=l(S),k=o(l(w),2);k.__click=()=>d("/");let z;var E=o(k,2);E.__click=()=>d("/documents");let P;var M=o(E,2);M.__click=()=>d("/parts");let D;var H=o(M,2);H.__click=()=>d("/gnc");let Y;var R=o(H,2);R.__click=()=>d("/job");let X;var Z=o(R,2);Z.__click=()=>d("/stock");let J;var O=o(Z,2);O.__click=()=>d("/journal");let re;var ie=o(O,4);ie.__click=()=>d("/settings");let de;var ve=o(w,2);{var le=_e=>{var ge=kf(),Pe=o(je(ge),2);Ae(Pe,21,()=>kt.menuActions,Fe,(ke,$)=>{var A=wf(),U=l(A),ne=l(U),ee=o(U,2);Ae(ee,17,()=>a($).items,Fe,(oe,qe)=>{var ye=yf();ye.__click=()=>v(a(qe).action);var Oe=l(ye);G(()=>q(Oe,a(qe).label)),g(oe,ye)}),G(()=>q(ne,a($).label)),g(ke,A)}),g(_e,ge)};L(ve,_e=>{kt.menuActions&&kt.menuActions.length>0&&_e(le)})}G((_e,ge,Pe,ke,$,A,U)=>{z=$e(k,1,"svelte-zne36e",null,z,{active:ya.path==="/"}),P=$e(E,1,"svelte-zne36e",null,P,_e),D=$e(M,1,"svelte-zne36e",null,D,ge),Y=$e(H,1,"svelte-zne36e",null,Y,Pe),X=$e(R,1,"svelte-zne36e",null,X,ke),J=$e(Z,1,"svelte-zne36e",null,J,$),re=$e(O,1,"svelte-zne36e",null,re,A),de=$e(ie,1,"svelte-zne36e",null,de,U)},[()=>({active:ya.path.includes("/documents")}),()=>({active:ya.path.includes("/parts")}),()=>({active:ya.path.includes("/gnc")}),()=>({active:ya.path.includes("/job")}),()=>({active:ya.path.includes("/stock")}),()=>({active:ya.path.includes("/journal")}),()=>({active:ya.path.includes("/settings")})]),g(x,S)};L(h,x=>{a(n)&&x(m)})}ha("mouseenter",f,i),ha("mouseleave",f,c),g(t,p),ct()}gt(["click"]);var qf=b('<div class="app-container svelte-1n46o8q"><!> <main class="main-content svelte-1n46o8q"><div class="route-content svelte-1n46o8q"><!></div></main></div>');function Ef(t,e){ot(e,!1),Jt(async()=>{try{const p=await(await fetch("/api/config-check")).json();Xo(p.status),p.needs_setup&&Ja("/setup")}catch(v){console.error("Config check failed",v),Ja("/setup")}}),Ql();var n=qf(),r=l(n);{var s=v=>{Tf(v,{})};L(r,v=>{ya.path!=="/setup"&&v(s)})}var i=o(r,2),c=l(i),d=l(c);lo(d,{get routes(){return bf}}),g(t,n),ct()}window.onerror=function(t,e,n,r,s){const i=document.createElement("div");i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.background="#fee2e2",i.style.color="#991b1b",i.style.padding="20px",i.style.zIndex="999999",i.style.borderBottom="2px solid #7f1d1d",i.innerHTML=`<strong>Error:</strong> ${t}<br><small>${e}:${n}:${r}</small><pre>${s?.stack||""}</pre>`,document.body.appendChild(i)};window.onunhandledrejection=function(t){const e=document.createElement("div");e.innerHTML+=`<br><strong>Unhandled Rejection:</strong> ${t.reason}`,document.body.prepend(e)};Ol(Ef,{target:document.getElementById("app")});
